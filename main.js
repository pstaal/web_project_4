!function(){"use strict";class e{constructor(e,t){this._settings=e,this._form=document.querySelector(t),this._buttonElement=document.querySelector(t).querySelector(this._settings.submitButtonSelector),this._inputList=[...document.querySelector(t).querySelectorAll(this._settings.inputSelector)]}_hasInvalidInput(e){return e.some((e=>!e.validity.valid))}_showInputError(e,t,s){const r=e.querySelector(".".concat(t.id,"-error"));t.classList.add(this._settings.inputErrorClass),r.textContent=s,r.classList.add(this._settings.errorClass)}_hideInputError(e,t){const s=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(this._settings.inputErrorClass),s.classList.remove(this._settings.errorClass),s.textContent=""}_toggleButtonState(e,t){this._hasInvalidInput(e)?this._disableButton(t):(t.classList.remove(this._settings.inactiveButtonClass),t.disabled=!1)}_disableButton(e){e.classList.add(this._settings.inactiveButtonClass),e.disabled=!0}_toggleInputError(e,t){t.validity.valid?this._hideInputError(e,t):this._showInputError(e,t,t.validationMessage)}_setEventListeners(){this._form.addEventListener("submit",(e=>{e.preventDefault()})),this._form.addEventListener("reset",(()=>{this._disableButton(this._buttonElement),this.resetValidation()})),this._inputList.forEach((e=>{e.addEventListener("input",(()=>{this._toggleInputError(this._form,e),this._toggleButtonState(this._inputList,this._buttonElement)}))}))}resetValidation(){this._inputList.forEach((e=>{this._hideInputError(this._form,e)}))}enableValidation(){this._setEventListeners(this._form)}}class t{constructor(e){this._popup=document.querySelector(e),this._handleEscClose=this._handleEscClose.bind(this)}open(){this._popup.classList.add("popup_opened"),document.addEventListener("keydown",this._handleEscClose)}close(){this._popup.classList.remove("popup_opened"),document.removeEventListener("keydown",this._handleEscClose)}_handleEscClose(e){"Escape"===e.key&&this.close()}setEventListeners(){this._popup.querySelector(".popup__close").addEventListener("click",(()=>{this.close()})),this._popup.addEventListener("click",(e=>{e.target.classList.contains("popup")&&this.close()}))}}class s extends t{constructor(e,t){super(e),this._handleFormSubmit=t,this._inputList=this._popup.querySelectorAll(".popup__input"),this._form=this._popup.querySelector(".popup__form"),this._submitButton=this._popup.querySelector(".popup__button"),this._submitButtonText=this._submitButton.textContent}renderLoading(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Saving...";this._submitButton.textContent=e?t:this._submitButtonText}_getInputValues(){return this._formValues={},this._inputList.forEach((e=>{this._formValues[e.name]=e.value})),this._formValues}close(){super.close(),this._form.reset()}setEventListeners(){super.setEventListeners(),this._form.addEventListener("submit",(e=>{e.preventDefault(),this._handleFormSubmit(this._getInputValues())}))}}class r{constructor(e,t,s,r,n){this._text=e.text,this._imageLink=e.imageLink,this._likes=e.likes,this._cardSelector=t,this._handleCardClick=s,this._popupConfirmation=r,this._ownerId=e.owner,this.id=e._id,this._userId=e.currentId,this._toggleLike=n}_getTemplate(){return document.querySelector(this._cardSelector).content.querySelector(".places__card").cloneNode(!0)}removeCard(){this._element.remove(),this._element=null}isLiked(){return this._element.querySelector(".places__card-button").classList.contains("places__card-button-liked")}setLikes(e){this._heartIcon.classList.toggle("places__card-button-liked"),this._likeCounter.textContent=e.likes.length}_setEventListeners(){this._heartIcon.addEventListener("click",(()=>{this._toggleLike(this)})),this._trashIcon&&this._trashIcon.addEventListener("click",(()=>{this._popupConfirmation.open(this)})),this._pictureElement.addEventListener("click",(e=>{this._handleCardClick({link:this._imageLink,text:this._text})}))}generateCard(){return this._element=this._getTemplate(),this._heartIcon=this._element.querySelector(".places__card-button"),this._likeCounter=this._element.querySelector(".places__likes-counter"),this._pictureElement=this._element.querySelector(".places__card-image"),this._trashIcon=this._element.querySelector(".places__card-delete-icon"),this._likes.some((e=>e._id===this._userId))&&this._heartIcon.classList.add("places__card-button-liked"),this._ownerId!==this._userId&&this._trashIcon.remove(),this._setEventListeners(),this._pictureElement.src=this._imageLink,this._pictureElement.alt=this._text,this._element.querySelector(".places__card-title").textContent=this._text,this._likeCounter.textContent=this._likes.length,this._element}}class n{constructor(e,t){let{items:s,renderer:r}=e;this._items=s,this._renderer=r,this._container=document.querySelector(t)}renderItems(){this._items.forEach((e=>{this._renderer(e)}))}addItem(e){this._container.prepend(e)}}const i=document.querySelector(".profile__button-name-change"),o=document.querySelector(".profile__button-add-place"),a=document.querySelector("[name='userName']"),c=document.querySelector("[name='userJob']"),l=(document.querySelector(".popup-profile"),document.querySelector(".popup-place"),document.querySelector(".popup-profile-picture"),document.querySelector(".popup__form-profile"),document.querySelector(".popup__form-place"),document.querySelector(".popup__form-profile-picture"),document.querySelector(".profile__picture"),document.querySelector(".profile__picture-container")),u=(document.querySelector(".popup__button-profile"),document.querySelector(".popup__button-place"),document.querySelector(".popup__button-picture"),{inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"});let p,h;const _=new class{constructor(e){let{baseUrl:t,headers:s}=e;this._baseUrl=t,this._headers=s,this._section=null}_handleResponse(e){return e.ok?e.json():Promise.reject("Error: ".concat(e.status))}initialize(){return Promise.all([this.getInitialUser(),this.getInitialCards()])}getInitialCards(){return fetch("".concat(this._baseUrl,"/cards"),{headers:this._headers}).then((e=>this._handleResponse(e)))}getInitialUser(){return fetch("".concat(this._baseUrl,"/users/me"),{headers:this._headers}).then((e=>this._handleResponse(e)))}addCart(e){let{title:t,link:s}=e;return fetch("".concat(this._baseUrl,"/cards"),{method:"POST",headers:this._headers,body:JSON.stringify({name:t,link:s})}).then((e=>this._handleResponse(e)))}deleteCard(e){return fetch("".concat(this._baseUrl,"/cards/").concat(e),{method:"DELETE",headers:this._headers}).then((e=>this._handleResponse(e)))}toggleLike(e,t){return fetch("".concat(this._baseUrl,"/cards/likes/").concat(e),{method:t?"DELETE":"PUT",headers:this._headers}).then((e=>this._handleResponse(e)))}changePicture(e){let{avatar:t}=e;return fetch("".concat(this._baseUrl,"/users/me/avatar"),{method:"PATCH",headers:this._headers,body:JSON.stringify({avatar:t})}).then((e=>this._handleResponse(e)))}setNewUser(e){let{userName:t,userJob:s}=e;return fetch("".concat(this._baseUrl,"/users/me"),{method:"PATCH",headers:this._headers,body:JSON.stringify({name:t,about:s})}).then((e=>this._handleResponse(e)))}}({baseUrl:"https://around.nomoreparties.co/v1/group-12",headers:{authorization:"5ad7ef92-ff2d-4fbe-9e41-f5034926c435","Content-Type":"application/json"}}),d=new class extends t{constructor(e,t){super(e),this._handleClick=t,this._button=this._popup.querySelector(".popup__button")}open(e){super.open(),this._card=e}setEventListeners(){super.setEventListeners(),this._button.addEventListener("click",(()=>{this._handleClick(this._card)}))}}(".popup-confirm",(function(e){_.deleteCard(e.id).then((t=>{d.close(),e.removeCard()})).catch((e=>{console.log(e)}))}));function m(e){_.toggleLike(this.id,e.isLiked()).then((t=>{e.setLikes(t)})).catch((e=>{console.log(e)}))}d.setEventListeners();const f=new class extends t{constructor(e){super(e),this._popupImage=document.querySelector(".popup-picture__image"),this._popupImageTitle=document.querySelector(".popup-picture__title")}open(e,t){this._popupImage.setAttribute("src",e),this._popupImage.setAttribute("alt",t),this._popupImageTitle.textContent=t,super.open()}}(".popup-picture");f.setEventListeners();const g=new class{constructor(e){let{userNameSelector:t,userJobSelector:s,pictureSelector:r}=e;this._profileName=document.querySelector(t),this._profileFunction=document.querySelector(s),this._picture=document.querySelector(r)}getUserInfo(){return{userName:this._profileName.textContent,userJob:this._profileFunction.textContent}}setUserInfo(e){let{userName:t,userJob:s,userAvatar:r}=e;this._profileName.textContent=t,this._profileFunction.textContent=s,this._picture.src=r}}({userNameSelector:".profile__name",userJobSelector:".profile__function",pictureSelector:".profile__picture"});function b(e,t,s,n,i){return new r(e,t,s,n,i).generateCard()}function L(e){let{link:t,text:s}=e;f.open(t,s)}_.initialize().then((e=>{const[t,s]=e;p=new n({items:s,renderer:e=>{h=t._id;const s=b({text:e.name,imageLink:e.link,likes:e.likes,owner:e.owner._id,_id:e._id,currentId:h},"#card-template",L,d,m);p.addItem(s)}},".places"),p.renderItems(),g.setUserInfo({userName:t.name,userJob:t.about,userAvatar:t.avatar})})).catch((e=>{console.log(e)}));const v=new s(".popup-place",(function(e){v.renderLoading(!0),_.addCart(e).then((e=>{const t=b({text:e.name,imageLink:e.link,likes:e.likes,owner:h,_id:e._id,currentId:h},"#card-template",L,d,m);p.addItem(t),v.close()})).catch((e=>{console.log(e)})).finally((()=>{v.renderLoading(!1)}))}));v.setEventListeners();const E=new s(".popup-profile",(function(e){E.renderLoading(!0),_.setNewUser(e).then((e=>{g.setUserInfo({userName:e.name,userJob:e.about,userAvatar:e.avatar}),E.close()})).catch((e=>{console.log(e)})).finally((()=>{E.renderLoading(!1)}))}));E.setEventListeners();const S=new s(".popup-profile-picture",(function(e){S.renderLoading(!0),_.changePicture(e).then((e=>{g.setUserInfo({userName:e.name,userJob:e.about,userAvatar:e.avatar}),S.close()})).catch((e=>{console.log(e)})).finally((()=>{S.renderLoading(!1)}))}));S.setEventListeners(),new e(u,".popup__form-profile").enableValidation(),new e(u,".popup__form-place").enableValidation(),new e(u,".popup__form-profile-picture").enableValidation(),o.addEventListener("click",(function(){v.open()})),i.addEventListener("click",(function(){const{userName:e,userJob:t}=g.getUserInfo();a.value=e,c.value=t,E.open()})),l.addEventListener("click",(function(){S.open()}))}();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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LEVBQW9CaEosVSIsInNvdXJjZXMiOlsid2VicGFjazovL3dlYl9wcm9qZWN0XzQvLi9zcmMvY29tcG9uZW50cy9Gb3JtVmFsaWRhdG9yLmpzIiwid2VicGFjazovL3dlYl9wcm9qZWN0XzQvLi9zcmMvY29tcG9uZW50cy9Qb3B1cC5qcyIsIndlYnBhY2s6Ly93ZWJfcHJvamVjdF80Ly4vc3JjL2NvbXBvbmVudHMvUG9wdXBXaXRoRm9ybS5qcyIsIndlYnBhY2s6Ly93ZWJfcHJvamVjdF80Ly4vc3JjL2NvbXBvbmVudHMvQ2FyZC5qcyIsIndlYnBhY2s6Ly93ZWJfcHJvamVjdF80Ly4vc3JjL2NvbXBvbmVudHMvU2VjdGlvbi5qcyIsIndlYnBhY2s6Ly93ZWJfcHJvamVjdF80Ly4vc3JjL3V0aWxzL2NvbnN0YW50cy5qcyIsIndlYnBhY2s6Ly93ZWJfcHJvamVjdF80Ly4vc3JjL3BhZ2VzL2luZGV4LmpzIiwid2VicGFjazovL3dlYl9wcm9qZWN0XzQvLi9zcmMvY29tcG9uZW50cy9BcGkuanMiLCJ3ZWJwYWNrOi8vd2ViX3Byb2plY3RfNC8uL3NyYy9jb21wb25lbnRzL1BvcHVwQ29uZmlybWF0aW9uLmpzIiwid2VicGFjazovL3dlYl9wcm9qZWN0XzQvLi9zcmMvY29tcG9uZW50cy9Qb3B1cFdpdGhJbWFnZS5qcyIsIndlYnBhY2s6Ly93ZWJfcHJvamVjdF80Ly4vc3JjL2NvbXBvbmVudHMvVXNlckluZm8uanMiXSwic291cmNlc0NvbnRlbnQiOlsiXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBGb3JtVmFsaWRhdG9yIHtcbiAgICBjb25zdHJ1Y3RvcihzZXR0aW5ncywgZm9ybSkge1xuICAgICAgICB0aGlzLl9zZXR0aW5ncyA9IHNldHRpbmdzO1xuICAgICAgICB0aGlzLl9mb3JtID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcihmb3JtKTtcbiAgICAgICAgdGhpcy5fYnV0dG9uRWxlbWVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoZm9ybSkucXVlcnlTZWxlY3Rvcih0aGlzLl9zZXR0aW5ncy5zdWJtaXRCdXR0b25TZWxlY3Rvcik7XG4gICAgICAgIHRoaXMuX2lucHV0TGlzdCA9IFsuLi5kb2N1bWVudC5xdWVyeVNlbGVjdG9yKGZvcm0pLnF1ZXJ5U2VsZWN0b3JBbGwodGhpcy5fc2V0dGluZ3MuaW5wdXRTZWxlY3RvcildO1xuICAgIH1cbiAgICBcbiAgICBfaGFzSW52YWxpZElucHV0IChpbnB1dExpc3QpIHtcbiAgICAgICAgcmV0dXJuIGlucHV0TGlzdC5zb21lKChpbnB1dEVsZW1lbnQpID0+IHsgXG4gICAgXG4gICAgICAgICAgcmV0dXJuICFpbnB1dEVsZW1lbnQudmFsaWRpdHkudmFsaWQ7IFxuICAgIFxuICAgICAgICB9KTsgXG4gICAgICB9XG5cbiAgICBfc2hvd0lucHV0RXJyb3IgKGZvcm0sIGlucHV0RWxlbWVudCwgZXJyb3JNZXNzYWdlICkge1xuICAgICAgICAvLyBGaW5kIHRoZSBlcnJvciBtZXNzYWdlIGVsZW1lbnQgaW5zaWRlIHRoZSB2ZXJ5IGZ1bmN0aW9uXG4gICAgICAgIGNvbnN0IGVycm9yRWxlbWVudCA9IGZvcm0ucXVlcnlTZWxlY3RvcihgLiR7aW5wdXRFbGVtZW50LmlkfS1lcnJvcmApO1xuICAgICAgICAvLyBUaGUgcmVzdCByZW1haW5zIHVuY2hhbmdlZFxuICAgICAgICBpbnB1dEVsZW1lbnQuY2xhc3NMaXN0LmFkZCh0aGlzLl9zZXR0aW5ncy5pbnB1dEVycm9yQ2xhc3MpO1xuICAgICAgICBlcnJvckVsZW1lbnQudGV4dENvbnRlbnQgPSBlcnJvck1lc3NhZ2U7XG4gICAgICAgIGVycm9yRWxlbWVudC5jbGFzc0xpc3QuYWRkKHRoaXMuX3NldHRpbmdzLmVycm9yQ2xhc3MpO1xuICAgICAgfVxuICAgICAgXG4gICAgX2hpZGVJbnB1dEVycm9yIChmb3JtLCBpbnB1dEVsZW1lbnQgKSB7XG4gICAgICAgIC8vIEZpbmQgdGhlIGVycm9yIG1lc3NhZ2UgZWxlbWVudFxuICAgICAgICBjb25zdCBlcnJvckVsZW1lbnQgPSBmb3JtLnF1ZXJ5U2VsZWN0b3IoYC4ke2lucHV0RWxlbWVudC5pZH0tZXJyb3JgKTtcbiAgICAgICAgLy8gVGhlIHJlc3QgcmVtYWlucyB1bmNoYW5nZWRcbiAgICAgICAgaW5wdXRFbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUodGhpcy5fc2V0dGluZ3MuaW5wdXRFcnJvckNsYXNzKTtcbiAgICAgICAgZXJyb3JFbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUodGhpcy5fc2V0dGluZ3MuZXJyb3JDbGFzcyk7XG4gICAgICAgIGVycm9yRWxlbWVudC50ZXh0Q29udGVudCA9IFwiXCI7XG4gICAgICB9XG5cbiAgICBfdG9nZ2xlQnV0dG9uU3RhdGUgKGlucHV0TGlzdCwgYnV0dG9uRWxlbWVudCkge1xuICAgICAgICBpZiAodGhpcy5faGFzSW52YWxpZElucHV0KGlucHV0TGlzdCkpIHtcbiAgICAgICAgICB0aGlzLl9kaXNhYmxlQnV0dG9uKGJ1dHRvbkVsZW1lbnQpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGJ1dHRvbkVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZSh0aGlzLl9zZXR0aW5ncy5pbmFjdGl2ZUJ1dHRvbkNsYXNzKTtcbiAgICAgICAgICBidXR0b25FbGVtZW50LmRpc2FibGVkID0gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICBcbiAgICAgIF9kaXNhYmxlQnV0dG9uKGJ1dHRvbkVsZW1lbnQpIHtcbiAgICAgICAgYnV0dG9uRWxlbWVudC5jbGFzc0xpc3QuYWRkKHRoaXMuX3NldHRpbmdzLmluYWN0aXZlQnV0dG9uQ2xhc3MpO1xuICAgICAgICBidXR0b25FbGVtZW50LmRpc2FibGVkID0gdHJ1ZTtcbiAgICAgIH1cbiAgICBcbiAgICBfdG9nZ2xlSW5wdXRFcnJvciAoZm9ybSwgaW5wdXRFbGVtZW50KSB7XG4gICAgICAgIGlmICghaW5wdXRFbGVtZW50LnZhbGlkaXR5LnZhbGlkKSB7XG4gICAgICAgICAgLy8gVGhlIHBhcmFtZXRlciBvZiBzaG93SW5wdXRFcnJvcigpIGlzIG5vdyBhIGZvcm0sXG4gICAgICAgICAgLy8gd2hpY2ggY29udGFpbnMgYSBmaWVsZCB0byBiZSBjaGVja2VkXG4gICAgICAgICAgdGhpcy5fc2hvd0lucHV0RXJyb3IoZm9ybSwgaW5wdXRFbGVtZW50LCBpbnB1dEVsZW1lbnQudmFsaWRhdGlvbk1lc3NhZ2UpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIC8vIFRoZSBzYW1lIGZvciBoaWRlSW5wdXRFcnJvcigpLCBJdHMgcGFyYW1ldGVyIGlzIG5vdyBhIGZvcm0sXG4gICAgICAgICAgLy8gd2hpY2ggY29udGFpbnMgYSBmaWVsZCB0byBiZSBjaGVja2VkXG4gICAgICAgICAgdGhpcy5faGlkZUlucHV0RXJyb3IoZm9ybSwgaW5wdXRFbGVtZW50KTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICBfc2V0RXZlbnRMaXN0ZW5lcnMoKSB7XG4gICAgdGhpcy5fZm9ybS5hZGRFdmVudExpc3RlbmVyKFwic3VibWl0XCIsIChldnQpID0+IHtcbiAgICAgICAgLy8gQ2FuY2VsIGRlZmF1bHQgYmVoYXZpb3IgZm9yIHRoZSBmb3JtXG4gICAgICAgIGV2dC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIH0pO1xuXG4gICAgdGhpcy5fZm9ybS5hZGRFdmVudExpc3RlbmVyKFwicmVzZXRcIiwgKCkgPT4geyBcbiAgICAgIHRoaXMuX2Rpc2FibGVCdXR0b24odGhpcy5fYnV0dG9uRWxlbWVudCk7IFxuICAgICAgdGhpcy5yZXNldFZhbGlkYXRpb24oKTtcbiAgICB9KTsgXG4gIFxuICAgIC8vIEl0ZXJhdGUgb3ZlciB0aGUgcmVzdWx0aW5nIGFycmF5XG4gICAgdGhpcy5faW5wdXRMaXN0LmZvckVhY2goKGlucHV0RWxlbWVudCkgPT4ge1xuICAgICAgLy8gYWRkIHRoZSBpbnB1dCBldmVudCBoYW5kbGVyIHRvIGVhY2ggZmllbGRcbiAgICAgIGlucHV0RWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwiaW5wdXRcIiwgKCkgPT4ge1xuICAgICAgICAvLyBDYWxsIHRoZSB0b2dnbGVJbnB1dEVycm9yKCkgZnVuY3Rpb24gaW5zaWRlIHRoZSBjYWxsYmFjayxcbiAgICAgICAgLy8gYW5kIHBhc3MgdGhlIGZvcm0gYW5kIHRoZSBlbGVtZW50IHRvIGJlIGNoZWNrZWQgdG8gaXRcbiAgICAgICAgdGhpcy5fdG9nZ2xlSW5wdXRFcnJvcih0aGlzLl9mb3JtLCBpbnB1dEVsZW1lbnQpO1xuICAgICAgICB0aGlzLl90b2dnbGVCdXR0b25TdGF0ZSh0aGlzLl9pbnB1dExpc3QsIHRoaXMuX2J1dHRvbkVsZW1lbnQpO1xuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgfVxuXG4gIHJlc2V0VmFsaWRhdGlvbiAoKXsgXG4gICAgdGhpcy5faW5wdXRMaXN0LmZvckVhY2goKGlucHV0RWxlbWVudCkgPT4geyBcbiAgICAgICAgdGhpcy5faGlkZUlucHV0RXJyb3IodGhpcy5fZm9ybSwgaW5wdXRFbGVtZW50KTsgXG4gICAgfSk7IFxuICB9OyBcblxuICBlbmFibGVWYWxpZGF0aW9uKCkge1xuICAgIHRoaXMuX3NldEV2ZW50TGlzdGVuZXJzKHRoaXMuX2Zvcm0pO1xuICB9XG59IiwiZXhwb3J0IGRlZmF1bHQgY2xhc3MgUG9wdXAge1xuICAgIGNvbnN0cnVjdG9yKHBvcHVwU2VsZWN0b3Ipe1xuICAgICAgICB0aGlzLl9wb3B1cCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IocG9wdXBTZWxlY3Rvcik7XG4gICAgICAgIHRoaXMuX2hhbmRsZUVzY0Nsb3NlID0gdGhpcy5faGFuZGxlRXNjQ2xvc2UuYmluZCh0aGlzKTtcbiAgICB9XG5cbiAgICBvcGVuKCkge1xuICAgICAgICB0aGlzLl9wb3B1cC5jbGFzc0xpc3QuYWRkKCdwb3B1cF9vcGVuZWQnKTtcbiAgICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImtleWRvd25cIiwgdGhpcy5faGFuZGxlRXNjQ2xvc2UpO1xuICAgIH1cblxuICAgIGNsb3NlKCkge1xuICAgICAgICB0aGlzLl9wb3B1cC5jbGFzc0xpc3QucmVtb3ZlKCdwb3B1cF9vcGVuZWQnKTtcbiAgICAgICAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcigna2V5ZG93bicsIHRoaXMuX2hhbmRsZUVzY0Nsb3NlKTtcbiAgICB9XG5cbiAgICBfaGFuZGxlRXNjQ2xvc2UoZXZ0KXtcbiAgICAgICAgaWYgKGV2dC5rZXkgPT09XCJFc2NhcGVcIikge1xuICAgICAgICAgICAgdGhpcy5jbG9zZSgpO1xuICAgICAgICAgIH1cbiAgICB9XG4gICAgXG4gICAgc2V0RXZlbnRMaXN0ZW5lcnMoKSB7XG4gICAgICAgIHRoaXMuX3BvcHVwLnF1ZXJ5U2VsZWN0b3IoJy5wb3B1cF9fY2xvc2UnKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHtcbiAgICAgICAgICAgIHRoaXMuY2xvc2UoKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgdGhpcy5fcG9wdXAuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIChldnQpID0+IHtcbiAgICAgICAgICAgIGlmIChldnQudGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucygncG9wdXAnKSkge1xuICAgICAgICAgICAgICAgIHRoaXMuY2xvc2UoKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgIH1cblxufSIsImltcG9ydCBQb3B1cCBmcm9tIFwiLi9Qb3B1cC5qc1wiO1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBQb3B1cFdpdGhGb3JtIGV4dGVuZHMgUG9wdXAge1xuICAgIGNvbnN0cnVjdG9yKHBvcHVwU2VsZWN0b3IsIGhhbmRsZUZvcm1TdWJtaXQpIHtcbiAgICAgICAgc3VwZXIocG9wdXBTZWxlY3Rvcik7XG4gICAgICAgIHRoaXMuX2hhbmRsZUZvcm1TdWJtaXQgPSBoYW5kbGVGb3JtU3VibWl0O1xuICAgICAgICB0aGlzLl9pbnB1dExpc3QgPSB0aGlzLl9wb3B1cC5xdWVyeVNlbGVjdG9yQWxsKFwiLnBvcHVwX19pbnB1dFwiKTtcbiAgICAgICAgdGhpcy5fZm9ybSA9IHRoaXMuX3BvcHVwLnF1ZXJ5U2VsZWN0b3IoJy5wb3B1cF9fZm9ybScpO1xuICAgICAgICB0aGlzLl9zdWJtaXRCdXR0b24gPSB0aGlzLl9wb3B1cC5xdWVyeVNlbGVjdG9yKCcucG9wdXBfX2J1dHRvbicpO1xuICAgICAgICB0aGlzLl9zdWJtaXRCdXR0b25UZXh0ID0gdGhpcy5fc3VibWl0QnV0dG9uLnRleHRDb250ZW50O1xuICAgIH1cblxuICAgIHJlbmRlckxvYWRpbmcoaXNMb2FkaW5nLCBsb2FkaW5nVGV4dD0nU2F2aW5nLi4uJykge1xuICAgICAgICBpZiAoaXNMb2FkaW5nKSB7XG4gICAgICAgICAgdGhpcy5fc3VibWl0QnV0dG9uLnRleHRDb250ZW50ID0gbG9hZGluZ1RleHQ7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdGhpcy5fc3VibWl0QnV0dG9uLnRleHRDb250ZW50ID0gdGhpcy5fc3VibWl0QnV0dG9uVGV4dDtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIF9nZXRJbnB1dFZhbHVlcygpIHtcbiAgICAgICAgXG5cbiAgICAgICAgLy8gQ3JlYXRlIGFuIGVtcHR5IG9iamVjdFxuICAgICAgICB0aGlzLl9mb3JtVmFsdWVzID0ge307XG5cbiAgICAgICAgLy8gQWRkIHRoZSB2YWx1ZXMgb2YgdGhlIGZpZWxkcyB0byB0aGlzIG9iamVjdFxuICAgICAgICB0aGlzLl9pbnB1dExpc3QuZm9yRWFjaChpbnB1dCA9PiB7XG4gICAgICAgICAgICB0aGlzLl9mb3JtVmFsdWVzW2lucHV0Lm5hbWVdID0gaW5wdXQudmFsdWU7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIFJldHVybiB0aGUgdmFsdWVzIG9iamVjdFxuICAgICAgICByZXR1cm4gdGhpcy5fZm9ybVZhbHVlcztcbiAgICB9IFxuXG4gICAgY2xvc2UoKSB7XG4gICAgICAgIHN1cGVyLmNsb3NlKCk7XG4gICAgICAgIHRoaXMuX2Zvcm0ucmVzZXQoKTtcbiAgICB9XG5cblxuICAgIHNldEV2ZW50TGlzdGVuZXJzKCkge1xuXG4gICAgICAgIHN1cGVyLnNldEV2ZW50TGlzdGVuZXJzKCk7XG4gICAgICAgIHRoaXMuX2Zvcm0uYWRkRXZlbnRMaXN0ZW5lcignc3VibWl0JywgKGV2dCkgPT4ge1xuICAgICAgICAgICAgZXZ0LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICB0aGlzLl9oYW5kbGVGb3JtU3VibWl0KHRoaXMuX2dldElucHV0VmFsdWVzKCkpO1xuICAgICAgICB9KTtcblxuICAgIH1cbiAgICBcblxufTsiLCJleHBvcnQgZGVmYXVsdCBjbGFzcyBDYXJkIHtcblxuICAgIGNvbnN0cnVjdG9yKGRhdGEsIGNhcmRTZWxlY3RvciwgaGFuZGxlQ2FyZENsaWNrLCBwb3B1cENvbmZpcm1hdGlvbiwgdG9nZ2xlTGlrZSkge1xuICAgICAgICB0aGlzLl90ZXh0ID0gZGF0YS50ZXh0O1xuICAgICAgICB0aGlzLl9pbWFnZUxpbmsgPSBkYXRhLmltYWdlTGluaztcbiAgICAgICAgdGhpcy5fbGlrZXMgPSBkYXRhLmxpa2VzO1xuICAgICAgICB0aGlzLl9jYXJkU2VsZWN0b3IgPSBjYXJkU2VsZWN0b3I7XG4gICAgICAgIHRoaXMuX2hhbmRsZUNhcmRDbGljayA9IGhhbmRsZUNhcmRDbGljaztcbiAgICAgICAgdGhpcy5fcG9wdXBDb25maXJtYXRpb24gPSBwb3B1cENvbmZpcm1hdGlvbjtcbiAgICAgICAgdGhpcy5fb3duZXJJZCA9IGRhdGEub3duZXI7XG4gICAgICAgIHRoaXMuaWQgPSBkYXRhLl9pZDtcbiAgICAgICAgdGhpcy5fdXNlcklkID0gZGF0YS5jdXJyZW50SWQ7XG4gICAgICAgIHRoaXMuX3RvZ2dsZUxpa2UgPSB0b2dnbGVMaWtlO1xuICAgIH1cblxuICAgIF9nZXRUZW1wbGF0ZSgpe1xuICAgICAgICBjb25zdCBjYXJkRWxlbWVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IodGhpcy5fY2FyZFNlbGVjdG9yKS5jb250ZW50LnF1ZXJ5U2VsZWN0b3IoXCIucGxhY2VzX19jYXJkXCIpLmNsb25lTm9kZSh0cnVlKTtcblxuICAgICAgICByZXR1cm4gY2FyZEVsZW1lbnQ7XG4gICAgfVxuXG4gICAgcmVtb3ZlQ2FyZCgpe1xuICAgICAgICB0aGlzLl9lbGVtZW50LnJlbW92ZSgpO1xuICAgICAgICB0aGlzLl9lbGVtZW50ID0gbnVsbDtcbiAgICB9XG5cbiAgICBpc0xpa2VkKCkge1xuICAgICAgcmV0dXJuIHRoaXMuX2VsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5wbGFjZXNfX2NhcmQtYnV0dG9uXCIpLmNsYXNzTGlzdC5jb250YWlucyhcInBsYWNlc19fY2FyZC1idXR0b24tbGlrZWRcIik7XG4gICAgfVxuXG4gICAgc2V0TGlrZXMocmVzdWx0KSB7XG4gICAgICB0aGlzLl9oZWFydEljb24uY2xhc3NMaXN0LnRvZ2dsZSgncGxhY2VzX19jYXJkLWJ1dHRvbi1saWtlZCcpO1xuICAgICAgdGhpcy5fbGlrZUNvdW50ZXIudGV4dENvbnRlbnQgPSByZXN1bHQubGlrZXMubGVuZ3RoO1xuICAgIH1cblxuXG4gICAgX3NldEV2ZW50TGlzdGVuZXJzKCkge1xuICAgICAgICB0aGlzLl9oZWFydEljb24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgICAgICAgICAgIHRoaXMuX3RvZ2dsZUxpa2UodGhpcyk7XG4gICAgICAgIH0pO1xuICAgICAgICAgIGlmKHRoaXMuX3RyYXNoSWNvbil7IFxuICAgICAgICAgICAgdGhpcy5fdHJhc2hJY29uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgICAgICAgICAgIHRoaXMuX3BvcHVwQ29uZmlybWF0aW9uLm9wZW4odGhpcyk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9XG4gICAgICAgICAgdGhpcy5fcGljdHVyZUVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIChldnQpID0+IHtcbiAgICAgICAgICAgIHRoaXMuX2hhbmRsZUNhcmRDbGljayh7IGxpbms6IHRoaXMuX2ltYWdlTGluaywgdGV4dDogdGhpcy5fdGV4dCB9KTsgXG4gICAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgZ2VuZXJhdGVDYXJkKCkge1xuICAgICAgICB0aGlzLl9lbGVtZW50ID0gdGhpcy5fZ2V0VGVtcGxhdGUoKTtcbiAgICAgICAgdGhpcy5faGVhcnRJY29uID0gdGhpcy5fZWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLnBsYWNlc19fY2FyZC1idXR0b25cIik7XG4gICAgICAgIHRoaXMuX2xpa2VDb3VudGVyID0gdGhpcy5fZWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLnBsYWNlc19fbGlrZXMtY291bnRlclwiKTtcbiAgICAgICAgdGhpcy5fcGljdHVyZUVsZW1lbnQgPSB0aGlzLl9lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucGxhY2VzX19jYXJkLWltYWdlXCIpO1xuICAgICAgICB0aGlzLl90cmFzaEljb24gPSB0aGlzLl9lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucGxhY2VzX19jYXJkLWRlbGV0ZS1pY29uXCIpO1xuICAgICAgICBpZih0aGlzLl9saWtlcy5zb21lKGl0ZW0gPT4gaXRlbS5faWQgPT09IHRoaXMuX3VzZXJJZCkpIHtcbiAgICAgICAgICB0aGlzLl9oZWFydEljb24uY2xhc3NMaXN0LmFkZCgncGxhY2VzX19jYXJkLWJ1dHRvbi1saWtlZCcpO1xuICAgICAgICB9XG4gICAgICAgIGlmKHRoaXMuX293bmVySWQgIT09IHRoaXMuX3VzZXJJZCkge1xuICAgICAgICAgIHRoaXMuX3RyYXNoSWNvbi5yZW1vdmUoKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLl9zZXRFdmVudExpc3RlbmVycygpOyBcbiAgICAgICAgdGhpcy5fcGljdHVyZUVsZW1lbnQuc3JjID0gdGhpcy5faW1hZ2VMaW5rO1xuICAgICAgICB0aGlzLl9waWN0dXJlRWxlbWVudC5hbHQgPSB0aGlzLl90ZXh0O1xuICAgICAgICB0aGlzLl9lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucGxhY2VzX19jYXJkLXRpdGxlXCIpLnRleHRDb250ZW50ID0gdGhpcy5fdGV4dDtcbiAgICAgICAgdGhpcy5fbGlrZUNvdW50ZXIudGV4dENvbnRlbnQgPSB0aGlzLl9saWtlcy5sZW5ndGg7XG4gICAgICBcbiAgICAgICAgcmV0dXJuIHRoaXMuX2VsZW1lbnQ7XG4gICAgICB9IFxuXG59IiwiZXhwb3J0IGRlZmF1bHQgY2xhc3MgU2VjdGlvbiB7XG4gICAgY29uc3RydWN0b3Ioe2l0ZW1zLCByZW5kZXJlcn0sIGNvbnRhaW5lclNlbGVjdG9yKSB7XG4gICAgICAgIHRoaXMuX2l0ZW1zID0gaXRlbXM7XG4gICAgICAgIHRoaXMuX3JlbmRlcmVyID0gcmVuZGVyZXI7XG4gICAgICAgIHRoaXMuX2NvbnRhaW5lciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoY29udGFpbmVyU2VsZWN0b3IpO1xuICAgIH1cblxuICAgIHJlbmRlckl0ZW1zKCkge1xuICAgICAgICB0aGlzLl9pdGVtcy5mb3JFYWNoKGl0ZW0gPT4ge1xuICAgICAgICAgIHRoaXMuX3JlbmRlcmVyKGl0ZW0pOyBcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgYWRkSXRlbShlbGVtZW50KSB7XG4gICAgICAgIHRoaXMuX2NvbnRhaW5lci5wcmVwZW5kKGVsZW1lbnQpO1xuICAgICAgfVxuXG59IiwiZXhwb3J0IGNvbnN0IGVkaXRCdXR0b24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcucHJvZmlsZV9fYnV0dG9uLW5hbWUtY2hhbmdlJyk7XG5leHBvcnQgY29uc3QgbmV3UGxhY2VCdXR0b24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcucHJvZmlsZV9fYnV0dG9uLWFkZC1wbGFjZScpO1xuZXhwb3J0IGNvbnN0IG5hbWVJbnB1dCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCJbbmFtZT0ndXNlck5hbWUnXVwiKTsgXG5leHBvcnQgY29uc3QgdGl0bGVJbnB1dCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCJbbmFtZT0ndXNlckpvYiddXCIpOyBcbmV4cG9ydCBjb25zdCBwb3B1cFByb2ZpbGVTZWxlY3RvciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5wb3B1cC1wcm9maWxlJyk7XG5leHBvcnQgY29uc3QgcG9wdXBQbGFjZVNlbGVjdG9yID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnBvcHVwLXBsYWNlJyk7XG5leHBvcnQgY29uc3QgcG9wdXBQaWN0dXJlU2VsZWN0b3IgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcucG9wdXAtcHJvZmlsZS1waWN0dXJlJyk7XG5leHBvcnQgY29uc3QgcHJvZmlsZUZvcm0gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcucG9wdXBfX2Zvcm0tcHJvZmlsZScpO1xuZXhwb3J0IGNvbnN0IHBsYWNlRm9ybSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5wb3B1cF9fZm9ybS1wbGFjZScpO1xuZXhwb3J0IGNvbnN0IHBpY3R1cmVGb3JtID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnBvcHVwX19mb3JtLXByb2ZpbGUtcGljdHVyZScpO1xuZXhwb3J0IGNvbnN0IHByb2ZpbGVQaWN0dXJlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnByb2ZpbGVfX3BpY3R1cmUnKTtcbmV4cG9ydCBjb25zdCBwcm9maWxlUGljdHVyZUJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5wcm9maWxlX19waWN0dXJlLWNvbnRhaW5lcicpO1xuZXhwb3J0IGNvbnN0IHByb2ZpbGVCdXR0b24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcucG9wdXBfX2J1dHRvbi1wcm9maWxlJyk7XG5leHBvcnQgY29uc3QgcGxhY2VCdXR0b24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcucG9wdXBfX2J1dHRvbi1wbGFjZScpO1xuZXhwb3J0IGNvbnN0IHBpY3R1cmVCdXR0b24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcucG9wdXBfX2J1dHRvbi1waWN0dXJlJyk7XG5leHBvcnQgY29uc3QgdmFsaWRhdGlvblNldHRpbmdzID0ge1xuICAgIGlucHV0U2VsZWN0b3I6IFwiLnBvcHVwX19pbnB1dFwiLFxuICAgIHN1Ym1pdEJ1dHRvblNlbGVjdG9yOiBcIi5wb3B1cF9fYnV0dG9uXCIsXG4gICAgaW5hY3RpdmVCdXR0b25DbGFzczogXCJwb3B1cF9fYnV0dG9uX2Rpc2FibGVkXCIsXG4gICAgaW5wdXRFcnJvckNsYXNzOiBcInBvcHVwX19pbnB1dF90eXBlX2Vycm9yXCIsXG4gICAgZXJyb3JDbGFzczogXCJwb3B1cF9fZXJyb3JfdmlzaWJsZVwiXG4gIH07IiwiaW1wb3J0IEZvcm1WYWxpZGF0b3IgZnJvbSBcIi4uL2NvbXBvbmVudHMvRm9ybVZhbGlkYXRvci5qc1wiO1xuaW1wb3J0IFBvcHVwV2l0aEZvcm0gZnJvbSBcIi4uL2NvbXBvbmVudHMvUG9wdXBXaXRoRm9ybS5qc1wiO1xuaW1wb3J0IEFwaSBmcm9tIFwiLi4vY29tcG9uZW50cy9BcGkuanNcIjtcbmltcG9ydCBDYXJkIGZyb20gXCIuLi9jb21wb25lbnRzL0NhcmRcIjtcbmltcG9ydCBTZWN0aW9uIGZyb20gXCIuLi9jb21wb25lbnRzL1NlY3Rpb25cIjtcbmltcG9ydCBVc2VySW5mbyBmcm9tIFwiLi4vY29tcG9uZW50cy9Vc2VySW5mb1wiO1xuaW1wb3J0IFBvcHVwQ29uZmlybWF0aW9uIGZyb20gXCIuLi9jb21wb25lbnRzL1BvcHVwQ29uZmlybWF0aW9uXCI7XG5pbXBvcnQgUG9wdXBXaXRoSW1hZ2UgZnJvbSBcIi4uL2NvbXBvbmVudHMvUG9wdXBXaXRoSW1hZ2VcIjtcbmltcG9ydCB7IHZhbGlkYXRpb25TZXR0aW5ncywgcHJvZmlsZVBpY3R1cmUsIHByb2ZpbGVCdXR0b24sIHBsYWNlQnV0dG9uLCBwaWN0dXJlQnV0dG9uLCBuZXdQbGFjZUJ1dHRvbiwgZWRpdEJ1dHRvbiwgbmFtZUlucHV0LCB0aXRsZUlucHV0LCBwb3B1cFByb2ZpbGVTZWxlY3RvciwgcG9wdXBQbGFjZVNlbGVjdG9yLCBwcm9maWxlRm9ybSwgcGxhY2VGb3JtLCBwaWN0dXJlRm9ybSwgcHJvZmlsZVBpY3R1cmVCdXR0b24sIHBvcHVwUGljdHVyZVNlbGVjdG9yIH0gZnJvbSBcIi4uL3V0aWxzL2NvbnN0YW50cy5qc1wiO1xuaW1wb3J0IFwiLi9zdHlsZXMuY3NzXCI7XG5cblxuLy9zZXQgY29uc3RhbnRzXG5cbmxldCBzZWN0aW9uO1xubGV0IGN1cnJlbnRJZDtcblxuLy9pbml0YWxpemUgYXBpIGNsYXNzXG5leHBvcnQgY29uc3QgYXBpID0gbmV3IEFwaSh7XG4gIGJhc2VVcmw6IFwiaHR0cHM6Ly9hcm91bmQubm9tb3JlcGFydGllcy5jby92MS9ncm91cC0xMlwiLFxuICBoZWFkZXJzOiB7XG4gICAgYXV0aG9yaXphdGlvbjogXCI1YWQ3ZWY5Mi1mZjJkLTRmYmUtOWU0MS1mNTAzNDkyNmM0MzVcIixcbiAgICBcIkNvbnRlbnQtVHlwZVwiOiBcImFwcGxpY2F0aW9uL2pzb25cIlxuICB9XG59KTsgXG5cbi8vaW5zdGFudGlhdGUgcG9wdXAgY29uZmlybWF0aW9uIGNsYXNzXG5jb25zdCBwb3B1cENvbmZpcm1hdGlvbiA9IG5ldyBQb3B1cENvbmZpcm1hdGlvbihcIi5wb3B1cC1jb25maXJtXCIsIGhhbmRsZUNsaWNrKTtcbnBvcHVwQ29uZmlybWF0aW9uLnNldEV2ZW50TGlzdGVuZXJzKCk7XG5cbi8vaGFuZGxlY2xpY2sgZnVuY3Rpb24gZm9yIGRlbGV0aW5nIGNhcmRcbmZ1bmN0aW9uIGhhbmRsZUNsaWNrKGNhcmQpIHtcbiAgYXBpLmRlbGV0ZUNhcmQoY2FyZC5pZCkudGhlbihyZXMgPT4ge1xuICAgIHBvcHVwQ29uZmlybWF0aW9uLmNsb3NlKCk7XG4gICAgY2FyZC5yZW1vdmVDYXJkKCk7XG4gIH0pXG4gIC5jYXRjaCgoZXJyKSA9PiB7XG4gICAgY29uc29sZS5sb2coZXJyKTsgLy8gbG9nIHRoZSBlcnJvciB0byB0aGUgY29uc29sZVxuICB9KTtcbn1cblxuLy90b2dnbGVMaWtlIGZ1bmN0aW9uXG5mdW5jdGlvbiB0b2dnbGVMaWtlKGNhcmQpIHtcbiAgYXBpLnRvZ2dsZUxpa2UodGhpcy5pZCwgY2FyZC5pc0xpa2VkKCkpLnRoZW4oKHJlc3VsdCkgPT4ge1xuICAgICAgY2FyZC5zZXRMaWtlcyhyZXN1bHQpO1xuICAgICAgfSlcbiAgICAgIC5jYXRjaCgoZXJyKSA9PiB7XG4gICAgICAgIGNvbnNvbGUubG9nKGVycik7IC8vIGxvZyB0aGUgZXJyb3IgdG8gdGhlIGNvbnNvbGVcbiAgICAgIH0pO1xufVxuXG5cbi8vaW5zdGFudGlhdGUgcG9wdXBpbWFnZSBjbGFzc1xuY29uc3QgcG9wdXBJbWFnZSA9IG5ldyBQb3B1cFdpdGhJbWFnZShcIi5wb3B1cC1waWN0dXJlXCIpO1xucG9wdXBJbWFnZS5zZXRFdmVudExpc3RlbmVycygpO1xuXG4vL2luc3RhbnRpYXRlIHVzZXIgaW5mbyBjbGFzc1xuZXhwb3J0IGNvbnN0IHVzZXJJbmZvID0gbmV3IFVzZXJJbmZvKHt1c2VyTmFtZVNlbGVjdG9yOiAnLnByb2ZpbGVfX25hbWUnLCB1c2VySm9iU2VsZWN0b3I6ICcucHJvZmlsZV9fZnVuY3Rpb24nLCBwaWN0dXJlU2VsZWN0b3I6ICcucHJvZmlsZV9fcGljdHVyZSd9KTtcblxuXG4vL2Z1bmN0aW9uIHRvIGNyZWF0ZSBhIG5ldyBjYXJkXG5mdW5jdGlvbiBjcmVhdGVDYXJkKGRhdGEsIHRlbXBsYXRlLCBjYWxsYmFjaywgcG9wdXBDb25maXJtYXRpb24sIHRvZ2dsZUxpa2UpIHtcbiAgICBjb25zdCBjYXJkID0gbmV3IENhcmQoZGF0YSwgdGVtcGxhdGUsIGNhbGxiYWNrLCBwb3B1cENvbmZpcm1hdGlvbiwgdG9nZ2xlTGlrZSk7XG4gICAgcmV0dXJuIGNhcmQuZ2VuZXJhdGVDYXJkKCk7XG59XG5cbi8vY3JlYXRlIGhhbmRsZUNhcmRDbGljayBmdW5jdGlvbiBmb3IgY2FyZHNcbmV4cG9ydCBmdW5jdGlvbiBoYW5kbGVDYXJkQ2xpY2soeyBsaW5rLCB0ZXh0IH0pIHtcbiAgcG9wdXBJbWFnZS5vcGVuKGxpbmssIHRleHQpOyBcbn07XG5cblxuXG5cbmFwaS5pbml0aWFsaXplKCkudGhlbihyZXMgPT4ge1xuICBjb25zdCBbdXNlciwgZGF0YV0gPSByZXM7XG4gIHNlY3Rpb24gPSBuZXcgU2VjdGlvbih7IFxuICAgIGl0ZW1zOiBkYXRhLCBcbiAgICByZW5kZXJlcjogKGl0ZW0pID0+IHtcbiAgICAgIGN1cnJlbnRJZCA9IHVzZXIuX2lkO1xuICAgICAgY29uc3QgZWxlbWVudCA9IGNyZWF0ZUNhcmQoe3RleHQ6IGl0ZW0ubmFtZSwgaW1hZ2VMaW5rOiBpdGVtLmxpbmssIGxpa2VzOiBpdGVtLmxpa2VzLCBvd25lcjogaXRlbS5vd25lci5faWQsIF9pZDogaXRlbS5faWQsIGN1cnJlbnRJZH0sIFwiI2NhcmQtdGVtcGxhdGVcIiwgaGFuZGxlQ2FyZENsaWNrLCBwb3B1cENvbmZpcm1hdGlvbiwgdG9nZ2xlTGlrZSk7XG4gICAgICBzZWN0aW9uLmFkZEl0ZW0oZWxlbWVudCk7XG4gICAgfVxuICAgIH0sXG4gICAgXCIucGxhY2VzXCJcbiAgKTtcbiAgc2VjdGlvbi5yZW5kZXJJdGVtcygpO1xuXG4gIHVzZXJJbmZvLnNldFVzZXJJbmZvKHt1c2VyTmFtZTogdXNlci5uYW1lLCB1c2VySm9iOiB1c2VyLmFib3V0LCB1c2VyQXZhdGFyOiB1c2VyLmF2YXRhcn0pO1xuXG4gIH0pXG4gIC5jYXRjaCgoZXJyKSA9PiB7XG4gICAgY29uc29sZS5sb2coZXJyKTsgLy8gbG9nIHRoZSBlcnJvciB0byB0aGUgY29uc29sZVxuICB9KTtcblxuXG4vL2luc3RhbnRpYXRlIHBvcHVwIHBsYWNlIGZvcm1cbmNvbnN0IHBvcHVwUGxhY2UgPSBuZXcgUG9wdXBXaXRoRm9ybShcIi5wb3B1cC1wbGFjZVwiLCBoYW5kbGVQbGFjZVN1Ym1pdCk7XG5wb3B1cFBsYWNlLnNldEV2ZW50TGlzdGVuZXJzKCk7XG5cbi8vaW5zdGFudGlhdGUgcG9wdXAgcHJvZmlsZSBmb3JtXG5jb25zdCBwb3B1cFByb2ZpbGUgPSBuZXcgUG9wdXBXaXRoRm9ybShcIi5wb3B1cC1wcm9maWxlXCIsIGhhbmRsZVByb2ZpbGVTdWJtaXQpO1xucG9wdXBQcm9maWxlLnNldEV2ZW50TGlzdGVuZXJzKCk7XG5cbi8vaW5zdGFudGlhdGUgcG9wdXAgZm9yIHByb2ZpbGUgcGljdHVyZVxuY29uc3QgcG9wdXBQcm9maWxlUGljdHVyZSA9IG5ldyBQb3B1cFdpdGhGb3JtKFwiLnBvcHVwLXByb2ZpbGUtcGljdHVyZVwiLCBoYW5kbGVQaWN0dXJlU3VibWl0KTtcbnBvcHVwUHJvZmlsZVBpY3R1cmUuc2V0RXZlbnRMaXN0ZW5lcnMoKTtcblxuLy9lbmFibGUgZm9ybSB2YWxpZGF0aW9uXG5jb25zdCBwcm9maWxlVmFsaWRhdG9yID0gbmV3IEZvcm1WYWxpZGF0b3IoIHZhbGlkYXRpb25TZXR0aW5ncywgXCIucG9wdXBfX2Zvcm0tcHJvZmlsZVwiKTtcblxucHJvZmlsZVZhbGlkYXRvci5lbmFibGVWYWxpZGF0aW9uKCk7XG5cbmNvbnN0IHBsYWNlVmFsaWRhdG9yID0gbmV3IEZvcm1WYWxpZGF0b3IoIHZhbGlkYXRpb25TZXR0aW5ncywgXCIucG9wdXBfX2Zvcm0tcGxhY2VcIik7XG5cbnBsYWNlVmFsaWRhdG9yLmVuYWJsZVZhbGlkYXRpb24oKTtcblxuY29uc3QgcGljdHVyZVZhbGlkYXRvciA9IG5ldyBGb3JtVmFsaWRhdG9yKCB2YWxpZGF0aW9uU2V0dGluZ3MsIFwiLnBvcHVwX19mb3JtLXByb2ZpbGUtcGljdHVyZVwiKTtcblxucGljdHVyZVZhbGlkYXRvci5lbmFibGVWYWxpZGF0aW9uKCk7XG5cbi8vYWRkIGV2ZW50IGxpc3RlbmVyIHRvIG9wZW4gdGhlIGZvcm0gZm9yIGEgbmV3IHBsYWNlIGNhcmRcbm5ld1BsYWNlQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgb3BlblBsYWNlRm9ybSk7XG5cbi8vYWRkIGV2ZW50IGxpc3RlbmVyIHRvIG9wZW4gdGhlIGZvcm0gZm9yIHRoZSBwcm9maWxlXG5lZGl0QnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgb3BlblByb2ZpbGVQb3B1cCk7XG5cbi8vYWRkIGV2ZW50IGxpc3RlbmVyIHRvIG9wZW4gdGhlIGZvcm0gdG8gY2hhbmdlIHRoZSBwcm9maWxlIHBpY3R1cmVcbnByb2ZpbGVQaWN0dXJlQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgb3BlblByb2ZpbGVQaWN0dXJlKTtcblxuLy9mdW5jdGlvbiB0byBvcGVuIGZvcm0gZm9yIHBpY3R1cmUgY2hhbmdlXG5mdW5jdGlvbiBvcGVuUHJvZmlsZVBpY3R1cmUgKCkge1xuICBwb3B1cFByb2ZpbGVQaWN0dXJlLm9wZW4oKTtcbn1cblxuLy9mdW5jdGlvbiB0byBvcGVuIHByb2ZpbGVcbmZ1bmN0aW9uIG9wZW5Qcm9maWxlUG9wdXAgKCkge1xuICBjb25zdCB7IHVzZXJOYW1lLCB1c2VySm9iIH0gPSB1c2VySW5mby5nZXRVc2VySW5mbygpO1xuICBuYW1lSW5wdXQudmFsdWUgPSB1c2VyTmFtZTtcbiAgdGl0bGVJbnB1dC52YWx1ZSA9IHVzZXJKb2I7XG4gIHBvcHVwUHJvZmlsZS5vcGVuKCk7XG59XG5cbi8vZnVuY3Rpb24gdG8gb3BlbiBwbGFjZSBmb3JtXG5mdW5jdGlvbiBvcGVuUGxhY2VGb3JtICgpIHtcbiAgcG9wdXBQbGFjZS5vcGVuKCk7XG59XG5cbi8vY3JlYXRlIGhhbmRsZSBzdWJtaXQgZnVuY3Rpb24gZm9yIGNoYW5naW5nIHByb2ZpbGVcbmZ1bmN0aW9uIGhhbmRsZVByb2ZpbGVTdWJtaXQoZGF0YSkge1xuICBwb3B1cFByb2ZpbGUucmVuZGVyTG9hZGluZyh0cnVlKTtcbiAgYXBpLnNldE5ld1VzZXIoZGF0YSkudGhlbihkYXRhID0+IHtcbiAgICB1c2VySW5mby5zZXRVc2VySW5mbyh7IHVzZXJOYW1lOiBkYXRhLm5hbWUsIHVzZXJKb2I6IGRhdGEuYWJvdXQsIHVzZXJBdmF0YXI6IGRhdGEuYXZhdGFyfSk7IFxuICAgIHBvcHVwUHJvZmlsZS5jbG9zZSgpO1xuICB9KVxuICAuY2F0Y2goKGVycikgPT4ge1xuICAgIGNvbnNvbGUubG9nKGVycik7IC8vIGxvZyB0aGUgZXJyb3IgdG8gdGhlIGNvbnNvbGVcbiAgfSlcbiAgLmZpbmFsbHkoKCkgPT4ge1xuICAgIHBvcHVwUHJvZmlsZS5yZW5kZXJMb2FkaW5nKGZhbHNlKTtcbiAgfSk7XG59XG5cbi8vY3JlYXRlIGhhbmRsZSBzdWJtaXQgZnVuY3Rpb24gZm9yIGFkZGluZyBuZXcgcGxhY2VzXG4gZnVuY3Rpb24gaGFuZGxlUGxhY2VTdWJtaXQoZGF0YSl7XG4gIHBvcHVwUGxhY2UucmVuZGVyTG9hZGluZyh0cnVlKTtcbiAgYXBpLmFkZENhcnQoZGF0YSkudGhlbigocmVzdWx0KSA9PiB7XG4gICAgY29uc3QgZWxlbWVudCA9IGNyZWF0ZUNhcmQoe3RleHQ6IHJlc3VsdC5uYW1lLCBpbWFnZUxpbms6IHJlc3VsdC5saW5rLCBsaWtlczogcmVzdWx0Lmxpa2VzLCBvd25lcjogY3VycmVudElkLCBfaWQ6IHJlc3VsdC5faWQsIGN1cnJlbnRJZH0sIFwiI2NhcmQtdGVtcGxhdGVcIiwgaGFuZGxlQ2FyZENsaWNrLCBwb3B1cENvbmZpcm1hdGlvbiwgdG9nZ2xlTGlrZSk7XG4gICAgc2VjdGlvbi5hZGRJdGVtKGVsZW1lbnQpO1xuICAgIHBvcHVwUGxhY2UuY2xvc2UoKTtcbiAgfSlcbiAgLmNhdGNoKChlcnIpID0+IHtcbiAgICBjb25zb2xlLmxvZyhlcnIpOyAvLyBsb2cgdGhlIGVycm9yIHRvIHRoZSBjb25zb2xlXG4gIH0pXG4gIC5maW5hbGx5KCgpID0+IHtcbiAgICBwb3B1cFBsYWNlLnJlbmRlckxvYWRpbmcoZmFsc2UpO1xuICB9KTtcbn1cblxuLy9jcmVhdGUgaGFuZGxlIHN1Ym1pdCBmb3IgbmV3IHByb2ZpbGUgcGljdHVyZVxuZnVuY3Rpb24gaGFuZGxlUGljdHVyZVN1Ym1pdChkYXRhKXtcbiAgcG9wdXBQcm9maWxlUGljdHVyZS5yZW5kZXJMb2FkaW5nKHRydWUpO1xuICBhcGkuY2hhbmdlUGljdHVyZShkYXRhKS50aGVuKChyZXN1bHQpID0+IHtcbiAgICB1c2VySW5mby5zZXRVc2VySW5mbyh7dXNlck5hbWU6IHJlc3VsdC5uYW1lLCB1c2VySm9iOiByZXN1bHQuYWJvdXQsIHVzZXJBdmF0YXI6IHJlc3VsdC5hdmF0YXJ9KTtcbiAgICBwb3B1cFByb2ZpbGVQaWN0dXJlLmNsb3NlKCk7XG4gIH0pXG4gIC5jYXRjaCgoZXJyKSA9PiB7XG4gICAgY29uc29sZS5sb2coZXJyKTsgLy8gbG9nIHRoZSBlcnJvciB0byB0aGUgY29uc29sZVxuICB9KVxuICAuZmluYWxseSgoKSA9PiB7XG4gICAgcG9wdXBQcm9maWxlUGljdHVyZS5yZW5kZXJMb2FkaW5nKGZhbHNlKTtcbiAgfSk7XG59XG5cblxuXG5cblxuXG5cblxuXG4iLCJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIEFwaSB7XG4gICAgY29uc3RydWN0b3IoeyBiYXNlVXJsLCBoZWFkZXJzfSkge1xuICAgICAgICB0aGlzLl9iYXNlVXJsID0gYmFzZVVybDtcbiAgICAgICAgdGhpcy5faGVhZGVycyA9IGhlYWRlcnM7XG4gICAgICAgIHRoaXMuX3NlY3Rpb24gPSBudWxsO1xuICAgICAgfVxuXG4gICAgICBfaGFuZGxlUmVzcG9uc2UocmVzKSB7XG4gICAgICAgIHJldHVybiByZXMub2sgPyByZXMuanNvbigpIDogUHJvbWlzZS5yZWplY3QoYEVycm9yOiAke3Jlcy5zdGF0dXN9YCk7XG4gICAgICB9XG5cbiAgICAgIGluaXRpYWxpemUoKSB7XG4gICAgICAgIHJldHVybiBQcm9taXNlLmFsbChbXG4gICAgICAgICAgdGhpcy5nZXRJbml0aWFsVXNlcigpLFxuICAgICAgICAgIHRoaXMuZ2V0SW5pdGlhbENhcmRzKClcbiAgICAgICAgXSk7XG4gICAgICB9XG4gICAgXG4gICAgICBnZXRJbml0aWFsQ2FyZHMoKSB7XG4gICAgICAgICAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vY2FyZHNgLCB7XG4gICAgICAgICAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnNcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAudGhlbihyZXMgPT4gdGhpcy5faGFuZGxlUmVzcG9uc2UocmVzKSk7IFxuICAgICAgfVxuXG4gICAgICBnZXRJbml0aWFsVXNlcigpIHtcbiAgICAgICAgICAgIHJldHVybiBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfS91c2Vycy9tZWAsIHtcbiAgICAgICAgICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVyc1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC50aGVuKHJlcyA9PiB0aGlzLl9oYW5kbGVSZXNwb25zZShyZXMpKTsgXG4gICAgICB9XG5cblxuICAgICAgYWRkQ2FydCh7dGl0bGUsIGxpbmt9KXtcbiAgICAgICAgcmV0dXJuIGZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L2NhcmRzYCwge1xuICAgICAgICAgIG1ldGhvZDogXCJQT1NUXCIsXG4gICAgICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcbiAgICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgICAgICBuYW1lOiB0aXRsZSxcbiAgICAgICAgICAgIGxpbmtcbiAgICAgICAgICB9KVxuICAgICAgICB9KVxuICAgICAgICAudGhlbihyZXMgPT4gdGhpcy5faGFuZGxlUmVzcG9uc2UocmVzKSk7IFxuICAgICB9XG5cblxuICAgICBkZWxldGVDYXJkKGlkKSB7XG4gICAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vY2FyZHMvJHtpZH1gLCB7XG4gICAgICAgIG1ldGhvZDogXCJERUxFVEVcIixcbiAgICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVyc1xuICAgICAgfSlcbiAgICAgIC50aGVuKHJlcyA9PiB0aGlzLl9oYW5kbGVSZXNwb25zZShyZXMpKTsgXG4gICAgIH1cblxuICAgICB0b2dnbGVMaWtlKGlkLCBpc0xpa2VkKSB7XG4gICAgICAgIHJldHVybiBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfS9jYXJkcy9saWtlcy8ke2lkfWAsIHtcbiAgICAgICAgICBtZXRob2Q6IGlzTGlrZWQgPyBcIkRFTEVURVwiIDogXCJQVVRcIixcbiAgICAgICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzXG4gICAgICAgIH0pXG4gICAgICAgIC50aGVuKHJlcyA9PiB0aGlzLl9oYW5kbGVSZXNwb25zZShyZXMpKTsgXG4gICAgIH1cblxuICAgICBjaGFuZ2VQaWN0dXJlKHthdmF0YXJ9KXtcbiAgICAgIHJldHVybiBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfS91c2Vycy9tZS9hdmF0YXJgLCB7XG4gICAgICAgICAgbWV0aG9kOiBcIlBBVENIXCIsXG4gICAgICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcbiAgICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgICAgICBhdmF0YXJcbiAgICAgICAgICB9KVxuICAgICAgICB9KVxuICAgICAgICAudGhlbihyZXMgPT4gdGhpcy5faGFuZGxlUmVzcG9uc2UocmVzKSk7IFxuICAgICAgfVxuXG4gICAgICBzZXROZXdVc2VyKHt1c2VyTmFtZSwgdXNlckpvYn0pIHsgXG4gICAgICAgIHJldHVybiBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfS91c2Vycy9tZWAsIHtcbiAgICAgICAgICAgIG1ldGhvZDogXCJQQVRDSFwiLFxuICAgICAgICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcbiAgICAgICAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHtcbiAgICAgICAgICAgICAgbmFtZTogdXNlck5hbWUsXG4gICAgICAgICAgICAgIGFib3V0OiB1c2VySm9iXG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC50aGVuKHJlcyA9PiB0aGlzLl9oYW5kbGVSZXNwb25zZShyZXMpKTsgXG4gICAgICB9XG4gICAgXG4gICAgXG5cbn07XG5cblxuXG5cbiIsImltcG9ydCBQb3B1cCBmcm9tIFwiLi9Qb3B1cC5qc1wiO1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBQb3B1cENvbmZpcm1hdGlvbiBleHRlbmRzIFBvcHVwIHtcbiAgICBjb25zdHJ1Y3Rvcihwb3B1cFNlbGVjdG9yLCBoYW5kbGVDbGljaykge1xuICAgICAgICBzdXBlcihwb3B1cFNlbGVjdG9yKTtcbiAgICAgICAgdGhpcy5faGFuZGxlQ2xpY2sgPSBoYW5kbGVDbGljaztcbiAgICAgICAgdGhpcy5fYnV0dG9uID0gdGhpcy5fcG9wdXAucXVlcnlTZWxlY3RvcignLnBvcHVwX19idXR0b24nKTtcbiAgICB9XG4gICAgXG4gICAgb3BlbihjYXJkKSB7XG4gICAgICAgIHN1cGVyLm9wZW4oKTtcbiAgICAgICAgdGhpcy5fY2FyZCA9IGNhcmQ7XG4gICAgfVxuXG4gICAgc2V0RXZlbnRMaXN0ZW5lcnMoKSB7XG4gICAgICAgIHN1cGVyLnNldEV2ZW50TGlzdGVuZXJzKCk7XG4gICAgICAgIHRoaXMuX2J1dHRvbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHtcbiAgICAgICAgICAgIHRoaXMuX2hhbmRsZUNsaWNrKHRoaXMuX2NhcmQpO1xuICAgICAgICB9KTtcbiAgICB9XG5cblxufSIsImltcG9ydCBQb3B1cCBmcm9tIFwiLi9Qb3B1cC5qc1wiO1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBQb3B1cFdpdGhJbWFnZSBleHRlbmRzIFBvcHVwIHtcblxuICAgIGNvbnN0cnVjdG9yKHBvcHVwU2VsZWN0b3IpIHtcbiAgICAgICAgc3VwZXIocG9wdXBTZWxlY3RvcilcbiAgICAgICAgdGhpcy5fcG9wdXBJbWFnZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5wb3B1cC1waWN0dXJlX19pbWFnZScpO1xuICAgICAgICB0aGlzLl9wb3B1cEltYWdlVGl0bGUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcucG9wdXAtcGljdHVyZV9fdGl0bGUnKTtcbiAgICB9XG5cbiAgICBvcGVuKGltYWdlTGluaywgaW1hZ2VOYW1lKXtcbiAgICAgICAgdGhpcy5fcG9wdXBJbWFnZS5zZXRBdHRyaWJ1dGUoJ3NyYycsIGltYWdlTGluayk7XG4gICAgICAgIHRoaXMuX3BvcHVwSW1hZ2Uuc2V0QXR0cmlidXRlKCdhbHQnLCBpbWFnZU5hbWUpOyAgICBcbiAgICAgICAgdGhpcy5fcG9wdXBJbWFnZVRpdGxlLnRleHRDb250ZW50ID0gaW1hZ2VOYW1lO1xuICAgICAgICBzdXBlci5vcGVuKCk7XG4gICAgfSBcblxufSIsImV4cG9ydCBkZWZhdWx0IGNsYXNzIFVzZXJJbmZvIHtcbiAgICBjb25zdHJ1Y3RvciAoe3VzZXJOYW1lU2VsZWN0b3IsIHVzZXJKb2JTZWxlY3RvciwgcGljdHVyZVNlbGVjdG9yfSl7XG4gICAgICAgIHRoaXMuX3Byb2ZpbGVOYW1lID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcih1c2VyTmFtZVNlbGVjdG9yKTtcbiAgICAgICAgdGhpcy5fcHJvZmlsZUZ1bmN0aW9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcih1c2VySm9iU2VsZWN0b3IpO1xuICAgICAgICB0aGlzLl9waWN0dXJlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihwaWN0dXJlU2VsZWN0b3IpO1xuICAgIH1cblxuICAgIGdldFVzZXJJbmZvKCkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgdXNlck5hbWU6IHRoaXMuX3Byb2ZpbGVOYW1lLnRleHRDb250ZW50LFxuICAgICAgICAgICAgdXNlckpvYjogdGhpcy5fcHJvZmlsZUZ1bmN0aW9uLnRleHRDb250ZW50XG4gICAgICAgIH07XG4gICAgfVxuXG4gICAgc2V0VXNlckluZm8oeyB1c2VyTmFtZSwgdXNlckpvYiwgdXNlckF2YXRhciB9KSB7XG4gICAgICAgIHRoaXMuX3Byb2ZpbGVOYW1lLnRleHRDb250ZW50ID0gdXNlck5hbWU7XG4gICAgICAgIHRoaXMuX3Byb2ZpbGVGdW5jdGlvbi50ZXh0Q29udGVudCA9IHVzZXJKb2I7XG4gICAgICAgIHRoaXMuX3BpY3R1cmUuc3JjID0gdXNlckF2YXRhcjtcbiAgICB9XG59OyJdLCJuYW1lcyI6WyJGb3JtVmFsaWRhdG9yIiwiY29uc3RydWN0b3IiLCJzZXR0aW5ncyIsImZvcm0iLCJ0aGlzIiwiX3NldHRpbmdzIiwiX2Zvcm0iLCJkb2N1bWVudCIsInF1ZXJ5U2VsZWN0b3IiLCJfYnV0dG9uRWxlbWVudCIsInN1Ym1pdEJ1dHRvblNlbGVjdG9yIiwiX2lucHV0TGlzdCIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJpbnB1dFNlbGVjdG9yIiwiX2hhc0ludmFsaWRJbnB1dCIsImlucHV0TGlzdCIsInNvbWUiLCJpbnB1dEVsZW1lbnQiLCJ2YWxpZGl0eSIsInZhbGlkIiwiX3Nob3dJbnB1dEVycm9yIiwiZXJyb3JNZXNzYWdlIiwiZXJyb3JFbGVtZW50IiwiaWQiLCJjbGFzc0xpc3QiLCJhZGQiLCJpbnB1dEVycm9yQ2xhc3MiLCJ0ZXh0Q29udGVudCIsImVycm9yQ2xhc3MiLCJfaGlkZUlucHV0RXJyb3IiLCJyZW1vdmUiLCJfdG9nZ2xlQnV0dG9uU3RhdGUiLCJidXR0b25FbGVtZW50IiwiX2Rpc2FibGVCdXR0b24iLCJpbmFjdGl2ZUJ1dHRvbkNsYXNzIiwiZGlzYWJsZWQiLCJfdG9nZ2xlSW5wdXRFcnJvciIsInZhbGlkYXRpb25NZXNzYWdlIiwiX3NldEV2ZW50TGlzdGVuZXJzIiwiYWRkRXZlbnRMaXN0ZW5lciIsImV2dCIsInByZXZlbnREZWZhdWx0IiwicmVzZXRWYWxpZGF0aW9uIiwiZm9yRWFjaCIsImVuYWJsZVZhbGlkYXRpb24iLCJQb3B1cCIsInBvcHVwU2VsZWN0b3IiLCJfcG9wdXAiLCJfaGFuZGxlRXNjQ2xvc2UiLCJiaW5kIiwib3BlbiIsImNsb3NlIiwicmVtb3ZlRXZlbnRMaXN0ZW5lciIsImtleSIsInNldEV2ZW50TGlzdGVuZXJzIiwidGFyZ2V0IiwiY29udGFpbnMiLCJQb3B1cFdpdGhGb3JtIiwiaGFuZGxlRm9ybVN1Ym1pdCIsInN1cGVyIiwiX2hhbmRsZUZvcm1TdWJtaXQiLCJfc3VibWl0QnV0dG9uIiwiX3N1Ym1pdEJ1dHRvblRleHQiLCJyZW5kZXJMb2FkaW5nIiwiaXNMb2FkaW5nIiwibG9hZGluZ1RleHQiLCJfZ2V0SW5wdXRWYWx1ZXMiLCJfZm9ybVZhbHVlcyIsImlucHV0IiwibmFtZSIsInZhbHVlIiwicmVzZXQiLCJDYXJkIiwiZGF0YSIsImNhcmRTZWxlY3RvciIsImhhbmRsZUNhcmRDbGljayIsInBvcHVwQ29uZmlybWF0aW9uIiwidG9nZ2xlTGlrZSIsIl90ZXh0IiwidGV4dCIsIl9pbWFnZUxpbmsiLCJpbWFnZUxpbmsiLCJfbGlrZXMiLCJsaWtlcyIsIl9jYXJkU2VsZWN0b3IiLCJfaGFuZGxlQ2FyZENsaWNrIiwiX3BvcHVwQ29uZmlybWF0aW9uIiwiX293bmVySWQiLCJvd25lciIsIl9pZCIsIl91c2VySWQiLCJjdXJyZW50SWQiLCJfdG9nZ2xlTGlrZSIsIl9nZXRUZW1wbGF0ZSIsImNvbnRlbnQiLCJjbG9uZU5vZGUiLCJyZW1vdmVDYXJkIiwiX2VsZW1lbnQiLCJpc0xpa2VkIiwic2V0TGlrZXMiLCJyZXN1bHQiLCJfaGVhcnRJY29uIiwidG9nZ2xlIiwiX2xpa2VDb3VudGVyIiwibGVuZ3RoIiwiX3RyYXNoSWNvbiIsIl9waWN0dXJlRWxlbWVudCIsImxpbmsiLCJnZW5lcmF0ZUNhcmQiLCJpdGVtIiwic3JjIiwiYWx0IiwiU2VjdGlvbiIsImNvbnRhaW5lclNlbGVjdG9yIiwiaXRlbXMiLCJyZW5kZXJlciIsIl9pdGVtcyIsIl9yZW5kZXJlciIsIl9jb250YWluZXIiLCJyZW5kZXJJdGVtcyIsImFkZEl0ZW0iLCJlbGVtZW50IiwicHJlcGVuZCIsImVkaXRCdXR0b24iLCJuZXdQbGFjZUJ1dHRvbiIsIm5hbWVJbnB1dCIsInRpdGxlSW5wdXQiLCJwcm9maWxlUGljdHVyZUJ1dHRvbiIsInZhbGlkYXRpb25TZXR0aW5ncyIsInNlY3Rpb24iLCJhcGkiLCJiYXNlVXJsIiwiaGVhZGVycyIsIl9iYXNlVXJsIiwiX2hlYWRlcnMiLCJfc2VjdGlvbiIsIl9oYW5kbGVSZXNwb25zZSIsInJlcyIsIm9rIiwianNvbiIsIlByb21pc2UiLCJyZWplY3QiLCJzdGF0dXMiLCJpbml0aWFsaXplIiwiYWxsIiwiZ2V0SW5pdGlhbFVzZXIiLCJnZXRJbml0aWFsQ2FyZHMiLCJmZXRjaCIsInRoZW4iLCJhZGRDYXJ0IiwidGl0bGUiLCJtZXRob2QiLCJib2R5IiwiSlNPTiIsInN0cmluZ2lmeSIsImRlbGV0ZUNhcmQiLCJjaGFuZ2VQaWN0dXJlIiwiYXZhdGFyIiwic2V0TmV3VXNlciIsInVzZXJOYW1lIiwidXNlckpvYiIsImFib3V0IiwiYXV0aG9yaXphdGlvbiIsImhhbmRsZUNsaWNrIiwiX2hhbmRsZUNsaWNrIiwiX2J1dHRvbiIsImNhcmQiLCJfY2FyZCIsImNhdGNoIiwiZXJyIiwiY29uc29sZSIsImxvZyIsInBvcHVwSW1hZ2UiLCJfcG9wdXBJbWFnZSIsIl9wb3B1cEltYWdlVGl0bGUiLCJpbWFnZU5hbWUiLCJzZXRBdHRyaWJ1dGUiLCJ1c2VySW5mbyIsInVzZXJOYW1lU2VsZWN0b3IiLCJ1c2VySm9iU2VsZWN0b3IiLCJwaWN0dXJlU2VsZWN0b3IiLCJfcHJvZmlsZU5hbWUiLCJfcHJvZmlsZUZ1bmN0aW9uIiwiX3BpY3R1cmUiLCJnZXRVc2VySW5mbyIsInNldFVzZXJJbmZvIiwidXNlckF2YXRhciIsImNyZWF0ZUNhcmQiLCJ0ZW1wbGF0ZSIsImNhbGxiYWNrIiwidXNlciIsInBvcHVwUGxhY2UiLCJmaW5hbGx5IiwicG9wdXBQcm9maWxlIiwicG9wdXBQcm9maWxlUGljdHVyZSJdLCJzb3VyY2VSb290IjoiIn0=