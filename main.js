!function(){"use strict";var e={d:function(t,s){for(var r in s)e.o(s,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:s[r]})},o:function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}};e.d({},{hi:function(){return E}});class t{constructor(e,t){this._settings=e,this._form=t}_hasInvalidInput(e){return e.some((e=>!e.validity.valid))}_showInputError(e,t,s){const r=e.querySelector(".".concat(t.id,"-error"));t.classList.add(this._settings.inputErrorClass),r.textContent=s,r.classList.add(this._settings.errorClass)}_hideInputError(e,t){const s=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(this._settings.inputErrorClass),s.classList.remove(this._settings.errorClass),s.textContent=""}_toggleButtonState(e,t){this._hasInvalidInput(e)?(t.classList.add(this._settings.inactiveButtonClass),t.disabled=!0):(t.classList.remove(this._settings.inactiveButtonClass),t.disabled=!1)}_disableButton(e){e.classList.add(this._settings.inactiveButtonClass),e.disabled=!0}_toggleInputError(e,t){t.validity.valid?this._hideInputError(e,t):this._showInputError(e,t,t.validationMessage)}_setEventListeners(e){e.addEventListener("submit",(e=>{e.preventDefault()}));const t=[...e.querySelectorAll(this._settings.inputSelector)],s=e.querySelector(this._settings.submitButtonSelector);e.addEventListener("reset",(()=>{this._disableButton(s)})),t.forEach((r=>{r.addEventListener("input",(()=>{this._toggleInputError(e,r),this._toggleButtonState(t,s)}))}))}resetValidation(e){const t=Array.from(e.querySelectorAll(".popup__input")),s=document.querySelector(this._form);t.forEach((e=>{this._hideInputError(s,e)}))}enableValidation(){const e=document.querySelector(this._form);this._setEventListeners(e)}}class s{constructor(e){this._popup=document.querySelector(e)}open(){this._popup.classList.add("popup_opened")}close(){this._popup.classList.remove("popup_opened")}_handleEscClose(e){"Escape"===e.key&&this.close()}setEventListeners(){this._popup.querySelector(".popup__close").addEventListener("click",(()=>{this.close()})),document.addEventListener("keydown",(e=>{this._handleEscClose(e)})),document.addEventListener("click",(e=>{e.target.classList.contains("popup")&&document.querySelector(".popup_opened")&&this.close()}))}}class r extends s{constructor(e,t){super(e),this._handleFormSubmit=t,this._inputList=this._popup.querySelectorAll(".popup__input"),this._form=this._popup.querySelector(".popup__form")}_getInputValues(){return this._formValues={},this._inputList.forEach((e=>{this._formValues[e.name]=e.value})),this._formValues}setEventListeners(){super.setEventListeners(),this._form.addEventListener("submit",(e=>{e.preventDefault(),this._handleFormSubmit(this._getInputValues())}))}}class n{constructor(e,t,s,r){this._text=e.text,this._imageLink=e.imageLink,this._likes=e.likes,this._cardSelector=t,this._handleCardClick=s,this._popupConfirmation=r,this._ownerId=e.owner,this.id=e._id,this._userId=e.currentId}_getTemplate(){return document.querySelector(this._cardSelector).content.querySelector(".places__card").cloneNode(!0)}_toggleHeart(){let e=this._element.querySelector(".places__card-button").classList.contains("places__card-button-liked");this._heartIcon.classList.toggle("places__card-button-liked"),E.toggleLike(this.id,e).then((e=>{this._element.querySelector(".places__likes-counter").innerHTML=e.likes.length})).catch((e=>{console.log(e)}))}removeCard(){this._element.remove(),this._element=null}_setEventListeners(){this._element.querySelector(".places__card-button").addEventListener("click",(()=>{this._toggleHeart()})),this._element.querySelector(".places__card-delete-icon")&&this._element.querySelector(".places__card-delete-icon").addEventListener("click",(()=>{this._popupConfirmation.open(this)})),this._element.querySelector(".places__card-image").addEventListener("click",(e=>{this._handleCardClick({link:this._imageLink,text:this._text})}))}generateCard(){return this._element=this._getTemplate(),this._heartIcon=this._element.querySelector(".places__card-button"),this._likes.some((e=>e._id===this._userId))&&this._heartIcon.classList.add("places__card-button-liked"),this._ownerId!==this._userId&&this._element.querySelector(".places__card-delete-icon").remove(),this._setEventListeners(),this._element.querySelector(".places__card-image").src=this._imageLink,this._element.querySelector(".places__card-image").alt=this._text,this._element.querySelector(".places__card-title").textContent=this._text,this._element.querySelector(".places__likes-counter").textContent=this._likes.length,this._element}}class o{constructor(e,t){let{items:s,renderer:r}=e;this._items=s,this._renderer=r,this._container=document.querySelector(t)}renderItems(){this._items.forEach((e=>{this._renderer(e)}))}addItem(e){this._container.prepend(e)}}const i=document.querySelector(".profile__button-name-change"),a=document.querySelector(".profile__button-add-place"),c=document.querySelector("[name='userName']"),l=document.querySelector("[name='userJob']"),u=document.querySelector(".popup-profile"),p=document.querySelector(".popup-place"),_=document.querySelector(".popup-profile-picture"),d=document.querySelector(".popup__form-profile"),h=document.querySelector(".popup__form-place"),m=document.querySelector(".popup__form-profile-picture"),f=document.querySelector(".profile__picture"),g=document.querySelector(".profile__picture-container"),b=document.querySelector(".popup__button-profile"),S=document.querySelector(".popup__button-place"),v=document.querySelector(".popup__button-picture");let y,C;const E=new class{constructor(e){let{baseUrl:t,headers:s}=e;this._baseUrl=t,this._headers=s,this._section=null}_handleResponse(e){return e.ok?e.json():Promise.reject("Error: ".concat(e.status))}initialize(){return Promise.all([this.getInitialUser(),this.getInitialCards()])}getInitialCards(){return fetch("".concat(this._baseUrl,"/cards"),{headers:this._headers}).then((e=>this._handleResponse(e)))}getInitialUser(){return fetch("".concat(this._baseUrl,"/users/me"),{headers:this._headers}).then((e=>this._handleResponse(e)))}addCart(e){let{title:t,link:s}=e;return fetch("".concat(this._baseUrl,"/cards"),{method:"POST",headers:this._headers,body:JSON.stringify({name:t,link:s})}).then((e=>this._handleResponse(e)))}deleteCard(e){return fetch("".concat(this._baseUrl,"/cards/").concat(e),{method:"DELETE",headers:this._headers}).then((e=>this._handleResponse(e)))}toggleLike(e,t){return fetch("".concat(this._baseUrl,"/cards/likes/").concat(e),{method:t?"DELETE":"PUT",headers:this._headers}).then((e=>this._handleResponse(e)))}changePicture(e){let{avatar:t}=e;return fetch("".concat(this._baseUrl,"/users/me/avatar"),{method:"PATCH",headers:this._headers,body:JSON.stringify({avatar:t})}).then((e=>this._handleResponse(e)))}setNewUser(e){let{userName:t,userJob:s}=e;return fetch("".concat(this._baseUrl,"/users/me"),{method:"PATCH",headers:this._headers,body:JSON.stringify({name:t,about:s})}).then((e=>this._handleResponse(e)))}}({baseUrl:"https://around.nomoreparties.co/v1/group-12",headers:{authorization:"5ad7ef92-ff2d-4fbe-9e41-f5034926c435","Content-Type":"application/json"}}),L=new class extends s{constructor(e,t){super(e),this._handleClick=t,this._button=this._popup.querySelector(".popup__button")}open(e){super.open(),this._card=e}setEventListeners(){super.setEventListeners(),this._button.addEventListener("click",(()=>{this._handleClick(this._card)}))}}(".popup-confirm",(function(e){E.deleteCard(e.id).then((e=>{console.log(e),L.close()})).catch((e=>{console.log(e)})),e.removeCard()}));L.setEventListeners();const q=new class extends s{constructor(e){super(e),this._popupImage=document.querySelector(".popup-picture__image"),this._popupImageTitle=document.querySelector(".popup-picture__title")}open(e,t){this._popupImage.setAttribute("src",e),this._popupImage.setAttribute("alt",t),this._popupImageTitle.textContent=t,super.open()}}(".popup-picture");q.setEventListeners();const k=new class{constructor(e){let{userNameSelector:t,userJobSelector:s}=e;this._profileName=document.querySelector(t),this._profileFunction=document.querySelector(s)}getUserInfo(){return{userName:this._profileName.textContent,userJob:this._profileFunction.textContent}}setUserInfo(e){let{userName:t,userJob:s}=e;this._profileName.textContent=t,this._profileFunction.textContent=s}}({userNameSelector:".profile__name",userJobSelector:".profile__function"});function I(e,t,s,r){return new n(e,t,s,r).generateCard()}function x(e){let{link:t,text:s}=e;q.open(t,s)}E.initialize().then((e=>{const[t,s]=e;y=new o({items:s,renderer:e=>{console.log(e),C=t._id;const s=I({text:e.name,imageLink:e.link,likes:e.likes,owner:e.owner._id,_id:e._id,currentId:C},"#card-template",x,L);y.addItem(s)}},".places"),y.renderItems(),k.setUserInfo({userName:t.name,userJob:t.about}),f.src=t.avatar})).catch((e=>{console.log(e)}));const w=new r(".popup-place",(function(e){S.textContent="Saving...",E.addCart(e).then((e=>{S.textContent="Create";const t=I({text:e.name,imageLink:e.link,likes:e.likes,owner:C,_id:e._id,currentId:C},"#card-template",x,L);y.addItem(t),w.close()})).catch((e=>{console.log(e)})),h.reset()}));w.setEventListeners();const U=new r(".popup-profile",(function(e){b.textContent="Saving...",E.setNewUser(e).then((e=>{b.textContent="Save",k.setUserInfo({userName:e.name,userJob:e.about}),U.close()})).catch((e=>{console.log(e)})),d.reset()}));U.setEventListeners();const N=new r(".popup-profile-picture",(function(e){v.textContent="Saving...",E.changePicture(e).then((e=>{v.textContent="Save",f.src=e.avatar,N.close()})).catch((e=>{console.log(e)})),m.reset()}));N.setEventListeners();const B=new t({inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"},".popup__form-profile");B.enableValidation();const V=new t({inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"},".popup__form-place");V.enableValidation();const J=new t({inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"},".popup__form-profile-picture");J.enableValidation(),a.addEventListener("click",(function(){V.resetValidation(p),w.open()})),i.addEventListener("click",(function(){B.resetValidation(u);const{userName:e,userJob:t}=k.getUserInfo();c.value=e,l.value=t,U.open()})),g.addEventListener("click",(function(){J.resetValidation(_),N.open()}))}();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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R0FBWWEsRUFBU0ssY0FDdkM1RCxFQUFVekQsTUFBUWtHLEVBQ2xCeEMsRUFBVzFELE1BQVFtRyxFQUNuQjBCLEVBQWE1SSxVQWRmaUYsRUFBcUJsRyxpQkFBaUIsU0FHdEMsV0FDRWlLLEVBQWlCMUosZ0JBQWdCc0YsR0FDakNpRSxFQUFvQjdJLFUiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly93ZWJfcHJvamVjdF80L3dlYnBhY2svYm9vdHN0cmFwIiwid2VicGFjazovL3dlYl9wcm9qZWN0XzQvd2VicGFjay9ydW50aW1lL2RlZmluZSBwcm9wZXJ0eSBnZXR0ZXJzIiwid2VicGFjazovL3dlYl9wcm9qZWN0XzQvd2VicGFjay9ydW50aW1lL2hhc093blByb3BlcnR5IHNob3J0aGFuZCIsIndlYnBhY2s6Ly93ZWJfcHJvamVjdF80Ly4vc3JjL2NvbXBvbmVudHMvRm9ybVZhbGlkYXRvci5qcyIsIndlYnBhY2s6Ly93ZWJfcHJvamVjdF80Ly4vc3JjL2NvbXBvbmVudHMvUG9wdXAuanMiLCJ3ZWJwYWNrOi8vd2ViX3Byb2plY3RfNC8uL3NyYy9jb21wb25lbnRzL1BvcHVwV2l0aEZvcm0uanMiLCJ3ZWJwYWNrOi8vd2ViX3Byb2plY3RfNC8uL3NyYy9jb21wb25lbnRzL0NhcmQuanMiLCJ3ZWJwYWNrOi8vd2ViX3Byb2plY3RfNC8uL3NyYy9jb21wb25lbnRzL1NlY3Rpb24uanMiLCJ3ZWJwYWNrOi8vd2ViX3Byb2plY3RfNC8uL3NyYy91dGlscy9jb25zdGFudHMuanMiLCJ3ZWJwYWNrOi8vd2ViX3Byb2plY3RfNC8uL3NyYy9wYWdlcy9pbmRleC5qcyIsIndlYnBhY2s6Ly93ZWJfcHJvamVjdF80Ly4vc3JjL2NvbXBvbmVudHMvQXBpLmpzIiwid2VicGFjazovL3dlYl9wcm9qZWN0XzQvLi9zcmMvY29tcG9uZW50cy9Qb3B1cENvbmZpcm1hdGlvbi5qcyIsIndlYnBhY2s6Ly93ZWJfcHJvamVjdF80Ly4vc3JjL2NvbXBvbmVudHMvUG9wdXBXaXRoSW1hZ2UuanMiLCJ3ZWJwYWNrOi8vd2ViX3Byb2plY3RfNC8uL3NyYy9jb21wb25lbnRzL1VzZXJJbmZvLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIFRoZSByZXF1aXJlIHNjb3BlXG52YXIgX193ZWJwYWNrX3JlcXVpcmVfXyA9IHt9O1xuXG4iLCIvLyBkZWZpbmUgZ2V0dGVyIGZ1bmN0aW9ucyBmb3IgaGFybW9ueSBleHBvcnRzXG5fX3dlYnBhY2tfcmVxdWlyZV9fLmQgPSBmdW5jdGlvbihleHBvcnRzLCBkZWZpbml0aW9uKSB7XG5cdGZvcih2YXIga2V5IGluIGRlZmluaXRpb24pIHtcblx0XHRpZihfX3dlYnBhY2tfcmVxdWlyZV9fLm8oZGVmaW5pdGlvbiwga2V5KSAmJiAhX193ZWJwYWNrX3JlcXVpcmVfXy5vKGV4cG9ydHMsIGtleSkpIHtcblx0XHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBrZXksIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBkZWZpbml0aW9uW2tleV0gfSk7XG5cdFx0fVxuXHR9XG59OyIsIl9fd2VicGFja19yZXF1aXJlX18ubyA9IGZ1bmN0aW9uKG9iaiwgcHJvcCkgeyByZXR1cm4gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG9iaiwgcHJvcCk7IH0iLCJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIEZvcm1WYWxpZGF0b3Ige1xuICAgIGNvbnN0cnVjdG9yKHNldHRpbmdzLCBmb3JtKSB7XG4gICAgICAgIHRoaXMuX3NldHRpbmdzID0gc2V0dGluZ3M7XG4gICAgICAgIHRoaXMuX2Zvcm0gPSBmb3JtO1xuICAgIH1cbiAgICBcbiAgICBfaGFzSW52YWxpZElucHV0IChpbnB1dExpc3QpIHtcbiAgICAgICAgcmV0dXJuIGlucHV0TGlzdC5zb21lKChpbnB1dEVsZW1lbnQpID0+IHsgXG4gICAgXG4gICAgICAgICAgcmV0dXJuICFpbnB1dEVsZW1lbnQudmFsaWRpdHkudmFsaWQ7IFxuICAgIFxuICAgICAgICB9KTsgXG4gICAgICB9XG5cbiAgICBfc2hvd0lucHV0RXJyb3IgKGZvcm0sIGlucHV0RWxlbWVudCwgZXJyb3JNZXNzYWdlICkge1xuICAgICAgICAvLyBGaW5kIHRoZSBlcnJvciBtZXNzYWdlIGVsZW1lbnQgaW5zaWRlIHRoZSB2ZXJ5IGZ1bmN0aW9uXG4gICAgICAgIGNvbnN0IGVycm9yRWxlbWVudCA9IGZvcm0ucXVlcnlTZWxlY3RvcihgLiR7aW5wdXRFbGVtZW50LmlkfS1lcnJvcmApO1xuICAgICAgICAvLyBUaGUgcmVzdCByZW1haW5zIHVuY2hhbmdlZFxuICAgICAgICBpbnB1dEVsZW1lbnQuY2xhc3NMaXN0LmFkZCh0aGlzLl9zZXR0aW5ncy5pbnB1dEVycm9yQ2xhc3MpO1xuICAgICAgICBlcnJvckVsZW1lbnQudGV4dENvbnRlbnQgPSBlcnJvck1lc3NhZ2U7XG4gICAgICAgIGVycm9yRWxlbWVudC5jbGFzc0xpc3QuYWRkKHRoaXMuX3NldHRpbmdzLmVycm9yQ2xhc3MpO1xuICAgICAgfVxuICAgICAgXG4gICAgX2hpZGVJbnB1dEVycm9yIChmb3JtLCBpbnB1dEVsZW1lbnQgKSB7XG4gICAgICAgIC8vIEZpbmQgdGhlIGVycm9yIG1lc3NhZ2UgZWxlbWVudFxuICAgICAgICBjb25zdCBlcnJvckVsZW1lbnQgPSBmb3JtLnF1ZXJ5U2VsZWN0b3IoYC4ke2lucHV0RWxlbWVudC5pZH0tZXJyb3JgKTtcbiAgICAgICAgLy8gVGhlIHJlc3QgcmVtYWlucyB1bmNoYW5nZWRcbiAgICAgICAgaW5wdXRFbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUodGhpcy5fc2V0dGluZ3MuaW5wdXRFcnJvckNsYXNzKTtcbiAgICAgICAgZXJyb3JFbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUodGhpcy5fc2V0dGluZ3MuZXJyb3JDbGFzcyk7XG4gICAgICAgIGVycm9yRWxlbWVudC50ZXh0Q29udGVudCA9IFwiXCI7XG4gICAgICB9XG5cbiAgICBfdG9nZ2xlQnV0dG9uU3RhdGUgKGlucHV0TGlzdCwgYnV0dG9uRWxlbWVudCkge1xuICAgICAgICBpZiAodGhpcy5faGFzSW52YWxpZElucHV0KGlucHV0TGlzdCkpIHtcbiAgICAgICAgICBidXR0b25FbGVtZW50LmNsYXNzTGlzdC5hZGQodGhpcy5fc2V0dGluZ3MuaW5hY3RpdmVCdXR0b25DbGFzcyk7XG4gICAgICAgICAgYnV0dG9uRWxlbWVudC5kaXNhYmxlZCA9IHRydWU7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgYnV0dG9uRWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKHRoaXMuX3NldHRpbmdzLmluYWN0aXZlQnV0dG9uQ2xhc3MpO1xuICAgICAgICAgIGJ1dHRvbkVsZW1lbnQuZGlzYWJsZWQgPSBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIFxuICAgICAgX2Rpc2FibGVCdXR0b24oYnV0dG9uRWxlbWVudCkge1xuICAgICAgICBidXR0b25FbGVtZW50LmNsYXNzTGlzdC5hZGQodGhpcy5fc2V0dGluZ3MuaW5hY3RpdmVCdXR0b25DbGFzcyk7XG4gICAgICAgIGJ1dHRvbkVsZW1lbnQuZGlzYWJsZWQgPSB0cnVlO1xuICAgICAgfVxuICAgIFxuICAgIF90b2dnbGVJbnB1dEVycm9yIChmb3JtLCBpbnB1dEVsZW1lbnQpIHtcbiAgICAgICAgaWYgKCFpbnB1dEVsZW1lbnQudmFsaWRpdHkudmFsaWQpIHtcbiAgICAgICAgICAvLyBUaGUgcGFyYW1ldGVyIG9mIHNob3dJbnB1dEVycm9yKCkgaXMgbm93IGEgZm9ybSxcbiAgICAgICAgICAvLyB3aGljaCBjb250YWlucyBhIGZpZWxkIHRvIGJlIGNoZWNrZWRcbiAgICAgICAgICB0aGlzLl9zaG93SW5wdXRFcnJvcihmb3JtLCBpbnB1dEVsZW1lbnQsIGlucHV0RWxlbWVudC52YWxpZGF0aW9uTWVzc2FnZSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgLy8gVGhlIHNhbWUgZm9yIGhpZGVJbnB1dEVycm9yKCksIEl0cyBwYXJhbWV0ZXIgaXMgbm93IGEgZm9ybSxcbiAgICAgICAgICAvLyB3aGljaCBjb250YWlucyBhIGZpZWxkIHRvIGJlIGNoZWNrZWRcbiAgICAgICAgICB0aGlzLl9oaWRlSW5wdXRFcnJvcihmb3JtLCBpbnB1dEVsZW1lbnQpO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgIF9zZXRFdmVudExpc3RlbmVycyhmb3JtKSB7XG4gICAgZm9ybS5hZGRFdmVudExpc3RlbmVyKFwic3VibWl0XCIsIChldnQpID0+IHtcbiAgICAgICAgLy8gQ2FuY2VsIGRlZmF1bHQgYmVoYXZpb3IgZm9yIHRoZSBmb3JtXG4gICAgICAgIGV2dC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIH0pO1xuXG4gICBcblxuICAgIGNvbnN0IGlucHV0TGlzdCA9IFsuLi5mb3JtLnF1ZXJ5U2VsZWN0b3JBbGwodGhpcy5fc2V0dGluZ3MuaW5wdXRTZWxlY3RvcildO1xuICAgIGNvbnN0IGJ1dHRvbkVsZW1lbnQgPSBmb3JtLnF1ZXJ5U2VsZWN0b3IodGhpcy5fc2V0dGluZ3Muc3VibWl0QnV0dG9uU2VsZWN0b3IpO1xuXG4gICAgZm9ybS5hZGRFdmVudExpc3RlbmVyKFwicmVzZXRcIiwgKCkgPT4geyBcbiAgICAgIHRoaXMuX2Rpc2FibGVCdXR0b24oYnV0dG9uRWxlbWVudCk7IFxuICAgIH0pOyBcbiAgXG4gICAgLy8gSXRlcmF0ZSBvdmVyIHRoZSByZXN1bHRpbmcgYXJyYXlcbiAgICBpbnB1dExpc3QuZm9yRWFjaCgoaW5wdXRFbGVtZW50KSA9PiB7XG4gICAgICAvLyBhZGQgdGhlIGlucHV0IGV2ZW50IGhhbmRsZXIgdG8gZWFjaCBmaWVsZFxuICAgICAgaW5wdXRFbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJpbnB1dFwiLCAoKSA9PiB7XG4gICAgICAgIC8vIENhbGwgdGhlIHRvZ2dsZUlucHV0RXJyb3IoKSBmdW5jdGlvbiBpbnNpZGUgdGhlIGNhbGxiYWNrLFxuICAgICAgICAvLyBhbmQgcGFzcyB0aGUgZm9ybSBhbmQgdGhlIGVsZW1lbnQgdG8gYmUgY2hlY2tlZCB0byBpdFxuICAgICAgICB0aGlzLl90b2dnbGVJbnB1dEVycm9yKGZvcm0sIGlucHV0RWxlbWVudCk7XG4gICAgICAgIHRoaXMuX3RvZ2dsZUJ1dHRvblN0YXRlKGlucHV0TGlzdCwgYnV0dG9uRWxlbWVudCk7XG4gICAgICB9KTtcbiAgICB9KTtcblxuICB9XG5cbiAgcmVzZXRWYWxpZGF0aW9uIChwb3B1cCl7IFxuXG4gICAgY29uc3QgaW5wdXRFbGVtZW50cyA9IEFycmF5LmZyb20ocG9wdXAucXVlcnlTZWxlY3RvckFsbChcIi5wb3B1cF9faW5wdXRcIikpOyBcbiAgICBjb25zdCBmb3JtID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcih0aGlzLl9mb3JtKTtcblxuICAgIGlucHV0RWxlbWVudHMuZm9yRWFjaCgoaW5wdXRFbGVtZW50KSA9PiB7IFxuXG4gICAgICAgIHRoaXMuX2hpZGVJbnB1dEVycm9yKGZvcm0sIGlucHV0RWxlbWVudCk7IFxuXG4gICAgfSk7IFxuXG4gIH07IFxuXG4gICBlbmFibGVWYWxpZGF0aW9uKCkge1xuICAgICAgICBjb25zdCBmb3JtID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcih0aGlzLl9mb3JtKTtcblxuICAgICAgICB0aGlzLl9zZXRFdmVudExpc3RlbmVycyhmb3JtKTtcbiAgfVxufSIsImV4cG9ydCBkZWZhdWx0IGNsYXNzIFBvcHVwIHtcbiAgICBjb25zdHJ1Y3Rvcihwb3B1cFNlbGVjdG9yKXtcbiAgICAgICAgdGhpcy5fcG9wdXAgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKHBvcHVwU2VsZWN0b3IpO1xuICAgIH1cblxuICAgIG9wZW4oKSB7XG4gICAgICAgIHRoaXMuX3BvcHVwLmNsYXNzTGlzdC5hZGQoJ3BvcHVwX29wZW5lZCcpO1xuICAgIH1cblxuICAgIGNsb3NlKCkge1xuICAgICAgICB0aGlzLl9wb3B1cC5jbGFzc0xpc3QucmVtb3ZlKCdwb3B1cF9vcGVuZWQnKTtcbiAgICB9XG5cbiAgICBfaGFuZGxlRXNjQ2xvc2UoZXZ0KSB7XG4gICAgICAgIGlmIChldnQua2V5ID09PVwiRXNjYXBlXCIpIHtcbiAgICAgICAgICAgIHRoaXMuY2xvc2UoKTtcbiAgICAgICAgICB9XG4gICAgfVxuICAgIFxuICAgIHNldEV2ZW50TGlzdGVuZXJzKCkge1xuICAgICAgICB0aGlzLl9wb3B1cC5xdWVyeVNlbGVjdG9yKCcucG9wdXBfX2Nsb3NlJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7XG4gICAgICAgICAgICB0aGlzLmNsb3NlKCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJrZXlkb3duXCIsIChldnQpID0+IHsgXG4gICAgICAgICAgICB0aGlzLl9oYW5kbGVFc2NDbG9zZShldnQpO1xuICAgICAgICB9KTtcblxuICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKGV2dCkgPT4ge1xuICAgICAgICAgICAgaWYgKGV2dC50YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKCdwb3B1cCcpICYmIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucG9wdXBfb3BlbmVkXCIpKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5jbG9zZSgpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgfVxuXG59IiwiaW1wb3J0IFBvcHVwIGZyb20gXCIuL1BvcHVwLmpzXCI7XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFBvcHVwV2l0aEZvcm0gZXh0ZW5kcyBQb3B1cCB7XG4gICAgY29uc3RydWN0b3IocG9wdXBTZWxlY3RvciwgaGFuZGxlRm9ybVN1Ym1pdCkge1xuICAgICAgICBzdXBlcihwb3B1cFNlbGVjdG9yKTtcbiAgICAgICAgdGhpcy5faGFuZGxlRm9ybVN1Ym1pdCA9IGhhbmRsZUZvcm1TdWJtaXQ7XG4gICAgICAgIHRoaXMuX2lucHV0TGlzdCA9IHRoaXMuX3BvcHVwLnF1ZXJ5U2VsZWN0b3JBbGwoXCIucG9wdXBfX2lucHV0XCIpO1xuICAgICAgICB0aGlzLl9mb3JtID0gdGhpcy5fcG9wdXAucXVlcnlTZWxlY3RvcignLnBvcHVwX19mb3JtJyk7XG4gICAgfVxuXG4gICAgX2dldElucHV0VmFsdWVzKCkge1xuICAgICAgICBcblxuICAgICAgICAvLyBDcmVhdGUgYW4gZW1wdHkgb2JqZWN0XG4gICAgICAgIHRoaXMuX2Zvcm1WYWx1ZXMgPSB7fTtcblxuICAgICAgICAvLyBBZGQgdGhlIHZhbHVlcyBvZiB0aGUgZmllbGRzIHRvIHRoaXMgb2JqZWN0XG4gICAgICAgIHRoaXMuX2lucHV0TGlzdC5mb3JFYWNoKGlucHV0ID0+IHtcbiAgICAgICAgICAgIHRoaXMuX2Zvcm1WYWx1ZXNbaW5wdXQubmFtZV0gPSBpbnB1dC52YWx1ZTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gUmV0dXJuIHRoZSB2YWx1ZXMgb2JqZWN0XG4gICAgICAgIHJldHVybiB0aGlzLl9mb3JtVmFsdWVzO1xuICAgIH0gXG5cblxuICAgIHNldEV2ZW50TGlzdGVuZXJzKCkge1xuXG4gICAgICAgIHN1cGVyLnNldEV2ZW50TGlzdGVuZXJzKCk7XG4gICAgICAgIHRoaXMuX2Zvcm0uYWRkRXZlbnRMaXN0ZW5lcignc3VibWl0JywgKGV2dCkgPT4ge1xuICAgICAgICAgICAgZXZ0LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICB0aGlzLl9oYW5kbGVGb3JtU3VibWl0KHRoaXMuX2dldElucHV0VmFsdWVzKCkpO1xuICAgICAgICB9KTtcblxuICAgIH1cbiAgICBcblxufTsiLCJpbXBvcnQgeyBhcGkgfSBmcm9tIFwiLi4vcGFnZXMvaW5kZXguanNcIjtcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgQ2FyZCB7XG5cbiAgICBjb25zdHJ1Y3RvcihkYXRhLCBjYXJkU2VsZWN0b3IsIGhhbmRsZUNhcmRDbGljaywgcG9wdXBDb25maXJtYXRpb24pIHtcbiAgICAgICAgdGhpcy5fdGV4dCA9IGRhdGEudGV4dDtcbiAgICAgICAgdGhpcy5faW1hZ2VMaW5rID0gZGF0YS5pbWFnZUxpbms7XG4gICAgICAgIHRoaXMuX2xpa2VzID0gZGF0YS5saWtlcztcbiAgICAgICAgdGhpcy5fY2FyZFNlbGVjdG9yID0gY2FyZFNlbGVjdG9yO1xuICAgICAgICB0aGlzLl9oYW5kbGVDYXJkQ2xpY2sgPSBoYW5kbGVDYXJkQ2xpY2s7XG4gICAgICAgIHRoaXMuX3BvcHVwQ29uZmlybWF0aW9uID0gcG9wdXBDb25maXJtYXRpb247XG4gICAgICAgIHRoaXMuX293bmVySWQgPSBkYXRhLm93bmVyO1xuICAgICAgICB0aGlzLmlkID0gZGF0YS5faWQ7XG4gICAgICAgIHRoaXMuX3VzZXJJZCA9IGRhdGEuY3VycmVudElkO1xuICAgIH1cblxuICAgIF9nZXRUZW1wbGF0ZSgpe1xuICAgICAgICBjb25zdCBjYXJkRWxlbWVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IodGhpcy5fY2FyZFNlbGVjdG9yKS5jb250ZW50LnF1ZXJ5U2VsZWN0b3IoXCIucGxhY2VzX19jYXJkXCIpLmNsb25lTm9kZSh0cnVlKTtcblxuICAgICAgICByZXR1cm4gY2FyZEVsZW1lbnQ7XG4gICAgfVxuXG4gICAgX3RvZ2dsZUhlYXJ0KCl7XG4gICAgICBsZXQgaXNMaWtlZCA9IHRoaXMuX2VsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5wbGFjZXNfX2NhcmQtYnV0dG9uXCIpLmNsYXNzTGlzdC5jb250YWlucyhcInBsYWNlc19fY2FyZC1idXR0b24tbGlrZWRcIik7XG4gICAgICB0aGlzLl9oZWFydEljb24uY2xhc3NMaXN0LnRvZ2dsZSgncGxhY2VzX19jYXJkLWJ1dHRvbi1saWtlZCcpO1xuICAgICAgYXBpLnRvZ2dsZUxpa2UodGhpcy5pZCwgaXNMaWtlZCkudGhlbigocmVzdWx0KSA9PiB7XG4gICAgICAgICAgICB0aGlzLl9lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucGxhY2VzX19saWtlcy1jb3VudGVyXCIpLmlubmVySFRNTCA9IHJlc3VsdC5saWtlcy5sZW5ndGg7XG4gICAgICAgICAgfSlcbiAgICAgICAgICAuY2F0Y2goKGVycikgPT4ge1xuICAgICAgICAgICAgY29uc29sZS5sb2coZXJyKTsgLy8gbG9nIHRoZSBlcnJvciB0byB0aGUgY29uc29sZVxuICAgICAgICAgIH0pO1xuICAgIH1cbiAgICBcblxuICAgIHJlbW92ZUNhcmQoKXtcbiAgICAgICAgdGhpcy5fZWxlbWVudC5yZW1vdmUoKTtcbiAgICAgICAgdGhpcy5fZWxlbWVudCA9IG51bGw7XG4gICAgfVxuXG5cbiAgICBfc2V0RXZlbnRMaXN0ZW5lcnMoKSB7XG4gICAgICAgIHRoaXMuX2VsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5wbGFjZXNfX2NhcmQtYnV0dG9uXCIpLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgICAgICAgICB0aGlzLl90b2dnbGVIZWFydCgpO1xuICAgICAgICAgIH0pO1xuICAgICAgICAgIGlmKHRoaXMuX2VsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5wbGFjZXNfX2NhcmQtZGVsZXRlLWljb25cIikpeyBcbiAgICAgICAgICAgIHRoaXMuX2VsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5wbGFjZXNfX2NhcmQtZGVsZXRlLWljb25cIikuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgICAgICAgICAgICAgdGhpcy5fcG9wdXBDb25maXJtYXRpb24ub3Blbih0aGlzKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH1cbiAgICAgICAgICB0aGlzLl9lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucGxhY2VzX19jYXJkLWltYWdlXCIpLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoZXZ0KSA9PiB7XG4gICAgICAgICAgICB0aGlzLl9oYW5kbGVDYXJkQ2xpY2soeyBsaW5rOiB0aGlzLl9pbWFnZUxpbmssIHRleHQ6IHRoaXMuX3RleHQgfSk7IFxuICAgICAgICAgIH0pO1xuICAgIH1cblxuICAgIGdlbmVyYXRlQ2FyZCgpIHtcbiAgICAgICAgdGhpcy5fZWxlbWVudCA9IHRoaXMuX2dldFRlbXBsYXRlKCk7XG4gICAgICAgIHRoaXMuX2hlYXJ0SWNvbiA9IHRoaXMuX2VsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5wbGFjZXNfX2NhcmQtYnV0dG9uXCIpO1xuICAgICAgICBpZih0aGlzLl9saWtlcy5zb21lKGl0ZW0gPT4gaXRlbS5faWQgPT09IHRoaXMuX3VzZXJJZCkpIHtcbiAgICAgICAgICB0aGlzLl9oZWFydEljb24uY2xhc3NMaXN0LmFkZCgncGxhY2VzX19jYXJkLWJ1dHRvbi1saWtlZCcpO1xuICAgICAgICB9XG4gICAgICAgIGlmKHRoaXMuX293bmVySWQgIT09IHRoaXMuX3VzZXJJZCkge1xuICAgICAgICAgIHRoaXMuX2VsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5wbGFjZXNfX2NhcmQtZGVsZXRlLWljb25cIikucmVtb3ZlKCk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5fc2V0RXZlbnRMaXN0ZW5lcnMoKTsgXG4gICAgICAgIHRoaXMuX2VsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5wbGFjZXNfX2NhcmQtaW1hZ2VcIikuc3JjID0gdGhpcy5faW1hZ2VMaW5rO1xuICAgICAgICB0aGlzLl9lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucGxhY2VzX19jYXJkLWltYWdlXCIpLmFsdCA9IHRoaXMuX3RleHQ7XG4gICAgICAgIHRoaXMuX2VsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5wbGFjZXNfX2NhcmQtdGl0bGVcIikudGV4dENvbnRlbnQgPSB0aGlzLl90ZXh0O1xuICAgICAgICB0aGlzLl9lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucGxhY2VzX19saWtlcy1jb3VudGVyXCIpLnRleHRDb250ZW50ID0gdGhpcy5fbGlrZXMubGVuZ3RoO1xuICAgICAgXG4gICAgICAgIHJldHVybiB0aGlzLl9lbGVtZW50O1xuICAgICAgfSBcblxufSIsImV4cG9ydCBkZWZhdWx0IGNsYXNzIFNlY3Rpb24ge1xuICAgIGNvbnN0cnVjdG9yKHtpdGVtcywgcmVuZGVyZXJ9LCBjb250YWluZXJTZWxlY3Rvcikge1xuICAgICAgICB0aGlzLl9pdGVtcyA9IGl0ZW1zO1xuICAgICAgICB0aGlzLl9yZW5kZXJlciA9IHJlbmRlcmVyO1xuICAgICAgICB0aGlzLl9jb250YWluZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGNvbnRhaW5lclNlbGVjdG9yKTtcbiAgICB9XG5cbiAgICByZW5kZXJJdGVtcygpIHtcbiAgICAgICAgdGhpcy5faXRlbXMuZm9yRWFjaChpdGVtID0+IHtcbiAgICAgICAgICB0aGlzLl9yZW5kZXJlcihpdGVtKTsgXG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIGFkZEl0ZW0oZWxlbWVudCkge1xuICAgICAgICB0aGlzLl9jb250YWluZXIucHJlcGVuZChlbGVtZW50KTtcbiAgICAgIH1cblxufSIsImV4cG9ydCBjb25zdCBlZGl0QnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnByb2ZpbGVfX2J1dHRvbi1uYW1lLWNoYW5nZScpO1xuZXhwb3J0IGNvbnN0IG5ld1BsYWNlQnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnByb2ZpbGVfX2J1dHRvbi1hZGQtcGxhY2UnKTtcbmV4cG9ydCBjb25zdCBuYW1lSW5wdXQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiW25hbWU9J3VzZXJOYW1lJ11cIik7IFxuZXhwb3J0IGNvbnN0IHRpdGxlSW5wdXQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiW25hbWU9J3VzZXJKb2InXVwiKTsgXG5leHBvcnQgY29uc3QgcG9wdXBQcm9maWxlU2VsZWN0b3IgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcucG9wdXAtcHJvZmlsZScpO1xuZXhwb3J0IGNvbnN0IHBvcHVwUGxhY2VTZWxlY3RvciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5wb3B1cC1wbGFjZScpO1xuZXhwb3J0IGNvbnN0IHBvcHVwUGljdHVyZVNlbGVjdG9yID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnBvcHVwLXByb2ZpbGUtcGljdHVyZScpO1xuZXhwb3J0IGNvbnN0IHByb2ZpbGVGb3JtID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnBvcHVwX19mb3JtLXByb2ZpbGUnKTtcbmV4cG9ydCBjb25zdCBwbGFjZUZvcm0gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcucG9wdXBfX2Zvcm0tcGxhY2UnKTtcbmV4cG9ydCBjb25zdCBwaWN0dXJlRm9ybSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5wb3B1cF9fZm9ybS1wcm9maWxlLXBpY3R1cmUnKTtcbmV4cG9ydCBjb25zdCBwcm9maWxlUGljdHVyZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5wcm9maWxlX19waWN0dXJlJyk7XG5leHBvcnQgY29uc3QgcHJvZmlsZVBpY3R1cmVCdXR0b24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcucHJvZmlsZV9fcGljdHVyZS1jb250YWluZXInKTtcbmV4cG9ydCBjb25zdCBwcm9maWxlQnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnBvcHVwX19idXR0b24tcHJvZmlsZScpO1xuZXhwb3J0IGNvbnN0IHBsYWNlQnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnBvcHVwX19idXR0b24tcGxhY2UnKTtcbmV4cG9ydCBjb25zdCBwaWN0dXJlQnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnBvcHVwX19idXR0b24tcGljdHVyZScpO1xuIiwiaW1wb3J0IEZvcm1WYWxpZGF0b3IgZnJvbSBcIi4uL2NvbXBvbmVudHMvRm9ybVZhbGlkYXRvci5qc1wiO1xuaW1wb3J0IFBvcHVwV2l0aEZvcm0gZnJvbSBcIi4uL2NvbXBvbmVudHMvUG9wdXBXaXRoRm9ybS5qc1wiO1xuaW1wb3J0IEFwaSBmcm9tIFwiLi4vY29tcG9uZW50cy9BcGkuanNcIjtcbmltcG9ydCBDYXJkIGZyb20gXCIuLi9jb21wb25lbnRzL0NhcmRcIjtcbmltcG9ydCBTZWN0aW9uIGZyb20gXCIuLi9jb21wb25lbnRzL1NlY3Rpb25cIjtcbmltcG9ydCBVc2VySW5mbyBmcm9tIFwiLi4vY29tcG9uZW50cy9Vc2VySW5mb1wiO1xuaW1wb3J0IFBvcHVwQ29uZmlybWF0aW9uIGZyb20gXCIuLi9jb21wb25lbnRzL1BvcHVwQ29uZmlybWF0aW9uXCI7XG5pbXBvcnQgUG9wdXBXaXRoSW1hZ2UgZnJvbSBcIi4uL2NvbXBvbmVudHMvUG9wdXBXaXRoSW1hZ2VcIjtcbmltcG9ydCB7IHByb2ZpbGVQaWN0dXJlLCBwcm9maWxlQnV0dG9uLCBwbGFjZUJ1dHRvbiwgcGljdHVyZUJ1dHRvbiwgbmV3UGxhY2VCdXR0b24sIGVkaXRCdXR0b24sIG5hbWVJbnB1dCwgdGl0bGVJbnB1dCwgcG9wdXBQcm9maWxlU2VsZWN0b3IsIHBvcHVwUGxhY2VTZWxlY3RvciwgcHJvZmlsZUZvcm0sIHBsYWNlRm9ybSwgcGljdHVyZUZvcm0sIHByb2ZpbGVQaWN0dXJlQnV0dG9uLCBwb3B1cFBpY3R1cmVTZWxlY3RvciB9IGZyb20gXCIuLi91dGlscy9jb25zdGFudHMuanNcIjtcbmltcG9ydCBcIi4vc3R5bGVzLmNzc1wiO1xuXG5cbi8vc2V0IGNvbnN0YW50c1xuXG5sZXQgc2VjdGlvbjtcbmxldCBjdXJyZW50SWQ7XG5cbi8vaW5pdGFsaXplIGFwaSBjbGFzc1xuZXhwb3J0IGNvbnN0IGFwaSA9IG5ldyBBcGkoe1xuICBiYXNlVXJsOiBcImh0dHBzOi8vYXJvdW5kLm5vbW9yZXBhcnRpZXMuY28vdjEvZ3JvdXAtMTJcIixcbiAgaGVhZGVyczoge1xuICAgIGF1dGhvcml6YXRpb246IFwiNWFkN2VmOTItZmYyZC00ZmJlLTllNDEtZjUwMzQ5MjZjNDM1XCIsXG4gICAgXCJDb250ZW50LVR5cGVcIjogXCJhcHBsaWNhdGlvbi9qc29uXCJcbiAgfVxufSk7IFxuXG4vL2luc3RhbnRpYXRlIHBvcHVwIGNvbmZpcm1hdGlvbiBjbGFzc1xuY29uc3QgcG9wdXBDb25maXJtYXRpb24gPSBuZXcgUG9wdXBDb25maXJtYXRpb24oXCIucG9wdXAtY29uZmlybVwiLCBoYW5kbGVDbGljayk7XG5wb3B1cENvbmZpcm1hdGlvbi5zZXRFdmVudExpc3RlbmVycygpO1xuXG4vL2hhbmRsZWNsaWNrIGZ1bmN0aW9uIGZvciBkZWxldGluZyBjYXJkXG5mdW5jdGlvbiBoYW5kbGVDbGljayhjYXJkKSB7XG4gIGFwaS5kZWxldGVDYXJkKGNhcmQuaWQpLnRoZW4ocmVzID0+IHtcbiAgICBjb25zb2xlLmxvZyhyZXMpO1xuICAgIHBvcHVwQ29uZmlybWF0aW9uLmNsb3NlKCk7XG4gIH0pXG4gIC5jYXRjaCgoZXJyKSA9PiB7XG4gICAgY29uc29sZS5sb2coZXJyKTsgLy8gbG9nIHRoZSBlcnJvciB0byB0aGUgY29uc29sZVxuICB9KTtcbiAgY2FyZC5yZW1vdmVDYXJkKCk7XG59XG5cblxuLy9pbnN0YW50aWF0ZSBwb3B1cGltYWdlIGNsYXNzXG5jb25zdCBwb3B1cEltYWdlID0gbmV3IFBvcHVwV2l0aEltYWdlKFwiLnBvcHVwLXBpY3R1cmVcIik7XG5wb3B1cEltYWdlLnNldEV2ZW50TGlzdGVuZXJzKCk7XG5cbi8vaW5zdGFudGlhdGUgdXNlciBpbmZvIGNsYXNzXG5leHBvcnQgY29uc3QgdXNlckluZm8gPSBuZXcgVXNlckluZm8oe3VzZXJOYW1lU2VsZWN0b3I6ICcucHJvZmlsZV9fbmFtZScsIHVzZXJKb2JTZWxlY3RvcjogJy5wcm9maWxlX19mdW5jdGlvbid9KTtcblxuXG4vL2Z1bmN0aW9uIHRvIGNyZWF0ZSBhIG5ldyBjYXJkXG5mdW5jdGlvbiBjcmVhdGVDYXJkKGRhdGEsIHRlbXBsYXRlLCBjYWxsYmFjaywgcG9wdXBDb25maXJtYXRpb24pIHtcbiAgICBjb25zdCBjYXJkID0gbmV3IENhcmQoZGF0YSwgdGVtcGxhdGUsIGNhbGxiYWNrLCBwb3B1cENvbmZpcm1hdGlvbik7XG4gICAgcmV0dXJuIGNhcmQuZ2VuZXJhdGVDYXJkKCk7XG59XG5cbi8vY3JlYXRlIGhhbmRsZUNhcmRDbGljayBmdW5jdGlvbiBmb3IgY2FyZHNcbmV4cG9ydCBmdW5jdGlvbiBoYW5kbGVDYXJkQ2xpY2soeyBsaW5rLCB0ZXh0IH0pIHtcbiAgcG9wdXBJbWFnZS5vcGVuKGxpbmssIHRleHQpOyBcbn07XG5cblxuXG5cbmFwaS5pbml0aWFsaXplKCkudGhlbihyZXMgPT4ge1xuICBjb25zdCBbdXNlciwgZGF0YV0gPSByZXM7XG4gIHNlY3Rpb24gPSBuZXcgU2VjdGlvbih7IFxuICAgIGl0ZW1zOiBkYXRhLCBcbiAgICByZW5kZXJlcjogKGl0ZW0pID0+IHtcbiAgICAgIGNvbnNvbGUubG9nKGl0ZW0pXG4gICAgICBjdXJyZW50SWQgPSB1c2VyLl9pZDtcbiAgICAgIGNvbnN0IGVsZW1lbnQgPSBjcmVhdGVDYXJkKHt0ZXh0OiBpdGVtLm5hbWUsIGltYWdlTGluazogaXRlbS5saW5rLCBsaWtlczogaXRlbS5saWtlcywgb3duZXI6IGl0ZW0ub3duZXIuX2lkLCBfaWQ6IGl0ZW0uX2lkLCBjdXJyZW50SWR9LCBcIiNjYXJkLXRlbXBsYXRlXCIsIGhhbmRsZUNhcmRDbGljaywgcG9wdXBDb25maXJtYXRpb24pO1xuICAgICAgc2VjdGlvbi5hZGRJdGVtKGVsZW1lbnQpO1xuICAgIH1cbiAgICB9LFxuICAgIFwiLnBsYWNlc1wiXG4gICk7XG4gIHNlY3Rpb24ucmVuZGVySXRlbXMoKTtcblxuICB1c2VySW5mby5zZXRVc2VySW5mbyh7dXNlck5hbWU6IHVzZXIubmFtZSwgdXNlckpvYjogdXNlci5hYm91dH0pO1xuICBwcm9maWxlUGljdHVyZS5zcmMgPSB1c2VyLmF2YXRhcjtcblxuICB9KVxuICAuY2F0Y2goKGVycikgPT4ge1xuICAgIGNvbnNvbGUubG9nKGVycik7IC8vIGxvZyB0aGUgZXJyb3IgdG8gdGhlIGNvbnNvbGVcbiAgfSk7XG5cblxuLy9pbnN0YW50aWF0ZSBwb3B1cCBwbGFjZSBmb3JtXG5jb25zdCBwb3B1cFBsYWNlID0gbmV3IFBvcHVwV2l0aEZvcm0oXCIucG9wdXAtcGxhY2VcIiwgaGFuZGxlUGxhY2VTdWJtaXQpO1xucG9wdXBQbGFjZS5zZXRFdmVudExpc3RlbmVycygpO1xuXG4vL2luc3RhbnRpYXRlIHBvcHVwIHByb2ZpbGUgZm9ybVxuY29uc3QgcG9wdXBQcm9maWxlID0gbmV3IFBvcHVwV2l0aEZvcm0oXCIucG9wdXAtcHJvZmlsZVwiLCBoYW5kbGVQcm9maWxlU3VibWl0KTtcbnBvcHVwUHJvZmlsZS5zZXRFdmVudExpc3RlbmVycygpO1xuXG4vL2luc3RhbnRpYXRlIHBvcHVwIGZvciBwcm9maWxlIHBpY3R1cmVcbmNvbnN0IHBvcHVwUHJvZmlsZVBpY3R1cmUgPSBuZXcgUG9wdXBXaXRoRm9ybShcIi5wb3B1cC1wcm9maWxlLXBpY3R1cmVcIiwgaGFuZGxlUGljdHVyZVN1Ym1pdCk7XG5wb3B1cFByb2ZpbGVQaWN0dXJlLnNldEV2ZW50TGlzdGVuZXJzKCk7XG5cbi8vZW5hYmxlIGZvcm0gdmFsaWRhdGlvblxuY29uc3QgcHJvZmlsZVZhbGlkYXRvciA9IG5ldyBGb3JtVmFsaWRhdG9yKHtcbiAgaW5wdXRTZWxlY3RvcjogXCIucG9wdXBfX2lucHV0XCIsXG4gIHN1Ym1pdEJ1dHRvblNlbGVjdG9yOiBcIi5wb3B1cF9fYnV0dG9uXCIsXG4gIGluYWN0aXZlQnV0dG9uQ2xhc3M6IFwicG9wdXBfX2J1dHRvbl9kaXNhYmxlZFwiLFxuICBpbnB1dEVycm9yQ2xhc3M6IFwicG9wdXBfX2lucHV0X3R5cGVfZXJyb3JcIixcbiAgZXJyb3JDbGFzczogXCJwb3B1cF9fZXJyb3JfdmlzaWJsZVwiXG59LCBcIi5wb3B1cF9fZm9ybS1wcm9maWxlXCIpO1xuXG5wcm9maWxlVmFsaWRhdG9yLmVuYWJsZVZhbGlkYXRpb24oKTtcblxuY29uc3QgcGxhY2VWYWxpZGF0b3IgPSBuZXcgRm9ybVZhbGlkYXRvcih7XG4gIGlucHV0U2VsZWN0b3I6IFwiLnBvcHVwX19pbnB1dFwiLFxuICBzdWJtaXRCdXR0b25TZWxlY3RvcjogXCIucG9wdXBfX2J1dHRvblwiLFxuICBpbmFjdGl2ZUJ1dHRvbkNsYXNzOiBcInBvcHVwX19idXR0b25fZGlzYWJsZWRcIixcbiAgaW5wdXRFcnJvckNsYXNzOiBcInBvcHVwX19pbnB1dF90eXBlX2Vycm9yXCIsXG4gIGVycm9yQ2xhc3M6IFwicG9wdXBfX2Vycm9yX3Zpc2libGVcIlxufSwgXCIucG9wdXBfX2Zvcm0tcGxhY2VcIik7XG5cbnBsYWNlVmFsaWRhdG9yLmVuYWJsZVZhbGlkYXRpb24oKTtcblxuY29uc3QgcGljdHVyZVZhbGlkYXRvciA9IG5ldyBGb3JtVmFsaWRhdG9yKHtcbiAgaW5wdXRTZWxlY3RvcjogXCIucG9wdXBfX2lucHV0XCIsXG4gIHN1Ym1pdEJ1dHRvblNlbGVjdG9yOiBcIi5wb3B1cF9fYnV0dG9uXCIsXG4gIGluYWN0aXZlQnV0dG9uQ2xhc3M6IFwicG9wdXBfX2J1dHRvbl9kaXNhYmxlZFwiLFxuICBpbnB1dEVycm9yQ2xhc3M6IFwicG9wdXBfX2lucHV0X3R5cGVfZXJyb3JcIixcbiAgZXJyb3JDbGFzczogXCJwb3B1cF9fZXJyb3JfdmlzaWJsZVwiXG59LCBcIi5wb3B1cF9fZm9ybS1wcm9maWxlLXBpY3R1cmVcIik7XG5cbnBpY3R1cmVWYWxpZGF0b3IuZW5hYmxlVmFsaWRhdGlvbigpO1xuXG4vL2FkZCBldmVudCBsaXN0ZW5lciB0byBvcGVuIHRoZSBmb3JtIGZvciBhIG5ldyBwbGFjZSBjYXJkXG5uZXdQbGFjZUJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIG9wZW5QbGFjZUZvcm0pO1xuXG4vL2FkZCBldmVudCBsaXN0ZW5lciB0byBvcGVuIHRoZSBmb3JtIGZvciB0aGUgcHJvZmlsZVxuZWRpdEJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIG9wZW5Qcm9maWxlUG9wdXApO1xuXG4vL2FkZCBldmVudCBsaXN0ZW5lciB0byBvcGVuIHRoZSBmb3JtIHRvIGNoYW5nZSB0aGUgcHJvZmlsZSBwaWN0dXJlXG5wcm9maWxlUGljdHVyZUJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIG9wZW5Qcm9maWxlUGljdHVyZSk7XG5cbi8vZnVuY3Rpb24gdG8gb3BlbiBmb3JtIGZvciBwaWN0dXJlIGNoYW5nZVxuZnVuY3Rpb24gb3BlblByb2ZpbGVQaWN0dXJlICgpIHtcbiAgcGljdHVyZVZhbGlkYXRvci5yZXNldFZhbGlkYXRpb24ocG9wdXBQaWN0dXJlU2VsZWN0b3IpO1xuICBwb3B1cFByb2ZpbGVQaWN0dXJlLm9wZW4oKTtcbn1cblxuLy9mdW5jdGlvbiB0byBvcGVuIHByb2ZpbGVcbmZ1bmN0aW9uIG9wZW5Qcm9maWxlUG9wdXAgKCkge1xuICBwcm9maWxlVmFsaWRhdG9yLnJlc2V0VmFsaWRhdGlvbihwb3B1cFByb2ZpbGVTZWxlY3Rvcik7ICBcbiAgY29uc3QgeyB1c2VyTmFtZSwgdXNlckpvYiB9ID0gdXNlckluZm8uZ2V0VXNlckluZm8oKTtcbiAgbmFtZUlucHV0LnZhbHVlID0gdXNlck5hbWU7XG4gIHRpdGxlSW5wdXQudmFsdWUgPSB1c2VySm9iO1xuICBwb3B1cFByb2ZpbGUub3BlbigpO1xufVxuXG4vL2Z1bmN0aW9uIHRvIG9wZW4gcGxhY2UgZm9ybVxuZnVuY3Rpb24gb3BlblBsYWNlRm9ybSAoKSB7XG4gIHBsYWNlVmFsaWRhdG9yLnJlc2V0VmFsaWRhdGlvbihwb3B1cFBsYWNlU2VsZWN0b3IpO1xuICBwb3B1cFBsYWNlLm9wZW4oKTtcbn1cblxuLy9jcmVhdGUgaGFuZGxlIHN1Ym1pdCBmdW5jdGlvbiBmb3IgY2hhbmdpbmcgcHJvZmlsZVxuZnVuY3Rpb24gaGFuZGxlUHJvZmlsZVN1Ym1pdChkYXRhKSB7XG4gIHByb2ZpbGVCdXR0b24udGV4dENvbnRlbnQgPSBcIlNhdmluZy4uLlwiO1xuICBhcGkuc2V0TmV3VXNlcihkYXRhKS50aGVuKGRhdGEgPT4ge1xuICAgIHByb2ZpbGVCdXR0b24udGV4dENvbnRlbnQgPSBcIlNhdmVcIjtcbiAgICB1c2VySW5mby5zZXRVc2VySW5mbyh7IHVzZXJOYW1lOiBkYXRhLm5hbWUsIHVzZXJKb2I6IGRhdGEuYWJvdXR9KTsgXG4gICAgcG9wdXBQcm9maWxlLmNsb3NlKCk7XG4gIH0pXG4gIC5jYXRjaCgoZXJyKSA9PiB7XG4gICAgY29uc29sZS5sb2coZXJyKTsgLy8gbG9nIHRoZSBlcnJvciB0byB0aGUgY29uc29sZVxuICB9KTtcbiAgcHJvZmlsZUZvcm0ucmVzZXQoKTtcbn1cblxuLy9jcmVhdGUgaGFuZGxlIHN1Ym1pdCBmdW5jdGlvbiBmb3IgYWRkaW5nIG5ldyBwbGFjZXNcbiBmdW5jdGlvbiBoYW5kbGVQbGFjZVN1Ym1pdChkYXRhKXtcbiAgcGxhY2VCdXR0b24udGV4dENvbnRlbnQgPSBcIlNhdmluZy4uLlwiO1xuICBhcGkuYWRkQ2FydChkYXRhKS50aGVuKChyZXN1bHQpID0+IHtcbiAgICBwbGFjZUJ1dHRvbi50ZXh0Q29udGVudCA9IFwiQ3JlYXRlXCI7XG4gICAgY29uc3QgZWxlbWVudCA9IGNyZWF0ZUNhcmQoe3RleHQ6IHJlc3VsdC5uYW1lLCBpbWFnZUxpbms6IHJlc3VsdC5saW5rLCBsaWtlczogcmVzdWx0Lmxpa2VzLCBvd25lcjogY3VycmVudElkLCBfaWQ6IHJlc3VsdC5faWQsIGN1cnJlbnRJZH0sIFwiI2NhcmQtdGVtcGxhdGVcIiwgaGFuZGxlQ2FyZENsaWNrLCBwb3B1cENvbmZpcm1hdGlvbik7XG4gICAgc2VjdGlvbi5hZGRJdGVtKGVsZW1lbnQpO1xuICAgIHBvcHVwUGxhY2UuY2xvc2UoKTtcbiAgfSlcbiAgLmNhdGNoKChlcnIpID0+IHtcbiAgICBjb25zb2xlLmxvZyhlcnIpOyAvLyBsb2cgdGhlIGVycm9yIHRvIHRoZSBjb25zb2xlXG4gIH0pO1xuICBwbGFjZUZvcm0ucmVzZXQoKTtcbn07XG5cbi8vY3JlYXRlIGhhbmRsZSBzdWJtaXQgZm9yIG5ldyBwcm9maWxlIHBpY3R1cmVcbmZ1bmN0aW9uIGhhbmRsZVBpY3R1cmVTdWJtaXQoZGF0YSl7XG4gIHBpY3R1cmVCdXR0b24udGV4dENvbnRlbnQgPSBcIlNhdmluZy4uLlwiO1xuICBhcGkuY2hhbmdlUGljdHVyZShkYXRhKS50aGVuKChyZXN1bHQpID0+IHtcbiAgICBwaWN0dXJlQnV0dG9uLnRleHRDb250ZW50ID0gXCJTYXZlXCI7XG4gICAgcHJvZmlsZVBpY3R1cmUuc3JjID0gcmVzdWx0LmF2YXRhcjtcbiAgICBwb3B1cFByb2ZpbGVQaWN0dXJlLmNsb3NlKCk7XG4gIH0pXG4gIC5jYXRjaCgoZXJyKSA9PiB7XG4gICAgY29uc29sZS5sb2coZXJyKTsgLy8gbG9nIHRoZSBlcnJvciB0byB0aGUgY29uc29sZVxuICB9KTtcbiAgcGljdHVyZUZvcm0ucmVzZXQoKTtcbn1cblxuXG5cblxuXG5cblxuXG5cbiIsIlxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgQXBpIHtcbiAgICBjb25zdHJ1Y3Rvcih7IGJhc2VVcmwsIGhlYWRlcnN9KSB7XG4gICAgICAgIHRoaXMuX2Jhc2VVcmwgPSBiYXNlVXJsO1xuICAgICAgICB0aGlzLl9oZWFkZXJzID0gaGVhZGVycztcbiAgICAgICAgdGhpcy5fc2VjdGlvbiA9IG51bGw7XG4gICAgICB9XG5cbiAgICAgIF9oYW5kbGVSZXNwb25zZShyZXMpIHtcbiAgICAgICAgcmV0dXJuIHJlcy5vayA/IHJlcy5qc29uKCkgOiBQcm9taXNlLnJlamVjdChgRXJyb3I6ICR7cmVzLnN0YXR1c31gKTtcbiAgICAgIH1cblxuICAgICAgaW5pdGlhbGl6ZSgpIHtcbiAgICAgICAgcmV0dXJuIFByb21pc2UuYWxsKFtcbiAgICAgICAgICB0aGlzLmdldEluaXRpYWxVc2VyKCksXG4gICAgICAgICAgdGhpcy5nZXRJbml0aWFsQ2FyZHMoKVxuICAgICAgICBdKTtcbiAgICAgIH1cbiAgICBcbiAgICAgIGdldEluaXRpYWxDYXJkcygpIHtcbiAgICAgICAgICAgIHJldHVybiBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfS9jYXJkc2AsIHtcbiAgICAgICAgICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVyc1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC50aGVuKHJlcyA9PiB0aGlzLl9oYW5kbGVSZXNwb25zZShyZXMpKTsgXG4gICAgICB9XG5cbiAgICAgIGdldEluaXRpYWxVc2VyKCkge1xuICAgICAgICAgICAgcmV0dXJuIGZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L3VzZXJzL21lYCwge1xuICAgICAgICAgICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzXG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLnRoZW4ocmVzID0+IHRoaXMuX2hhbmRsZVJlc3BvbnNlKHJlcykpOyBcbiAgICAgIH1cblxuXG4gICAgICBhZGRDYXJ0KHt0aXRsZSwgbGlua30pe1xuICAgICAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vY2FyZHNgLCB7XG4gICAgICAgICAgbWV0aG9kOiBcIlBPU1RcIixcbiAgICAgICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxuICAgICAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHtcbiAgICAgICAgICAgIG5hbWU6IHRpdGxlLFxuICAgICAgICAgICAgbGlua1xuICAgICAgICAgIH0pXG4gICAgICAgIH0pXG4gICAgICAgIC50aGVuKHJlcyA9PiB0aGlzLl9oYW5kbGVSZXNwb25zZShyZXMpKTsgXG4gICAgIH1cblxuXG4gICAgIGRlbGV0ZUNhcmQoaWQpIHtcbiAgICAgIHJldHVybiBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfS9jYXJkcy8ke2lkfWAsIHtcbiAgICAgICAgbWV0aG9kOiBcIkRFTEVURVwiLFxuICAgICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzXG4gICAgICB9KVxuICAgICAgLnRoZW4ocmVzID0+IHRoaXMuX2hhbmRsZVJlc3BvbnNlKHJlcykpOyBcbiAgICAgfVxuXG4gICAgIHRvZ2dsZUxpa2UoaWQsIGlzTGlrZWQpIHtcbiAgICAgICAgcmV0dXJuIGZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L2NhcmRzL2xpa2VzLyR7aWR9YCwge1xuICAgICAgICAgIG1ldGhvZDogaXNMaWtlZCA/IFwiREVMRVRFXCIgOiBcIlBVVFwiLFxuICAgICAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnNcbiAgICAgICAgfSlcbiAgICAgICAgLnRoZW4ocmVzID0+IHRoaXMuX2hhbmRsZVJlc3BvbnNlKHJlcykpOyBcbiAgICAgfVxuXG4gICAgIGNoYW5nZVBpY3R1cmUoe2F2YXRhcn0pe1xuICAgICAgcmV0dXJuIGZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L3VzZXJzL21lL2F2YXRhcmAsIHtcbiAgICAgICAgICBtZXRob2Q6IFwiUEFUQ0hcIixcbiAgICAgICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxuICAgICAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHtcbiAgICAgICAgICAgIGF2YXRhclxuICAgICAgICAgIH0pXG4gICAgICAgIH0pXG4gICAgICAgIC50aGVuKHJlcyA9PiB0aGlzLl9oYW5kbGVSZXNwb25zZShyZXMpKTsgXG4gICAgICB9XG5cbiAgICAgIHNldE5ld1VzZXIoe3VzZXJOYW1lLCB1c2VySm9ifSkgeyBcbiAgICAgICAgcmV0dXJuIGZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L3VzZXJzL21lYCwge1xuICAgICAgICAgICAgbWV0aG9kOiBcIlBBVENIXCIsXG4gICAgICAgICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxuICAgICAgICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICAgICAgICBuYW1lOiB1c2VyTmFtZSxcbiAgICAgICAgICAgICAgYWJvdXQ6IHVzZXJKb2JcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLnRoZW4ocmVzID0+IHRoaXMuX2hhbmRsZVJlc3BvbnNlKHJlcykpOyBcbiAgICAgIH1cbiAgICBcbiAgICBcblxufTtcblxuXG5cblxuIiwiaW1wb3J0IFBvcHVwIGZyb20gXCIuL1BvcHVwLmpzXCI7XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFBvcHVwQ29uZmlybWF0aW9uIGV4dGVuZHMgUG9wdXAge1xuICAgIGNvbnN0cnVjdG9yKHBvcHVwU2VsZWN0b3IsIGhhbmRsZUNsaWNrKSB7XG4gICAgICAgIHN1cGVyKHBvcHVwU2VsZWN0b3IpO1xuICAgICAgICB0aGlzLl9oYW5kbGVDbGljayA9IGhhbmRsZUNsaWNrO1xuICAgICAgICB0aGlzLl9idXR0b24gPSB0aGlzLl9wb3B1cC5xdWVyeVNlbGVjdG9yKCcucG9wdXBfX2J1dHRvbicpO1xuICAgIH1cbiAgICBcbiAgICBvcGVuKGNhcmQpIHtcbiAgICAgICAgc3VwZXIub3BlbigpO1xuICAgICAgICB0aGlzLl9jYXJkID0gY2FyZDtcbiAgICB9XG5cbiAgICBzZXRFdmVudExpc3RlbmVycygpIHtcbiAgICAgICAgc3VwZXIuc2V0RXZlbnRMaXN0ZW5lcnMoKTtcbiAgICAgICAgdGhpcy5fYnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5faGFuZGxlQ2xpY2sodGhpcy5fY2FyZCk7XG4gICAgICAgIH0pO1xuICAgIH1cblxuXG59IiwiaW1wb3J0IFBvcHVwIGZyb20gXCIuL1BvcHVwLmpzXCI7XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFBvcHVwV2l0aEltYWdlIGV4dGVuZHMgUG9wdXAge1xuXG4gICAgY29uc3RydWN0b3IocG9wdXBTZWxlY3Rvcikge1xuICAgICAgICBzdXBlcihwb3B1cFNlbGVjdG9yKVxuICAgICAgICB0aGlzLl9wb3B1cEltYWdlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnBvcHVwLXBpY3R1cmVfX2ltYWdlJyk7XG4gICAgICAgIHRoaXMuX3BvcHVwSW1hZ2VUaXRsZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5wb3B1cC1waWN0dXJlX190aXRsZScpO1xuICAgIH1cblxuICAgIG9wZW4oaW1hZ2VMaW5rLCBpbWFnZU5hbWUpe1xuICAgICAgICB0aGlzLl9wb3B1cEltYWdlLnNldEF0dHJpYnV0ZSgnc3JjJywgaW1hZ2VMaW5rKTtcbiAgICAgICAgdGhpcy5fcG9wdXBJbWFnZS5zZXRBdHRyaWJ1dGUoJ2FsdCcsIGltYWdlTmFtZSk7ICAgIFxuICAgICAgICB0aGlzLl9wb3B1cEltYWdlVGl0bGUudGV4dENvbnRlbnQgPSBpbWFnZU5hbWU7XG4gICAgICAgIHN1cGVyLm9wZW4oKTtcbiAgICB9IFxuXG59IiwiZXhwb3J0IGRlZmF1bHQgY2xhc3MgVXNlckluZm8ge1xuICAgIGNvbnN0cnVjdG9yICh7dXNlck5hbWVTZWxlY3RvciwgdXNlckpvYlNlbGVjdG9yfSl7XG4gICAgICAgIHRoaXMuX3Byb2ZpbGVOYW1lID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcih1c2VyTmFtZVNlbGVjdG9yKTtcbiAgICAgICAgdGhpcy5fcHJvZmlsZUZ1bmN0aW9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcih1c2VySm9iU2VsZWN0b3IpO1xuICAgIH1cblxuICAgIGdldFVzZXJJbmZvKCkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgdXNlck5hbWU6IHRoaXMuX3Byb2ZpbGVOYW1lLnRleHRDb250ZW50LFxuICAgICAgICAgICAgdXNlckpvYjogdGhpcy5fcHJvZmlsZUZ1bmN0aW9uLnRleHRDb250ZW50XG4gICAgICAgIH07XG4gICAgfVxuXG4gICAgc2V0VXNlckluZm8oeyB1c2VyTmFtZSwgdXNlckpvYiB9KSB7XG4gICAgICAgIHRoaXMuX3Byb2ZpbGVOYW1lLnRleHRDb250ZW50ID0gdXNlck5hbWU7XG4gICAgICAgIHRoaXMuX3Byb2ZpbGVGdW5jdGlvbi50ZXh0Q29udGVudCA9IHVzZXJKb2I7XG4gICAgfVxufTsiXSwibmFtZXMiOlsiX193ZWJwYWNrX3JlcXVpcmVfXyIsImV4cG9ydHMiLCJkZWZpbml0aW9uIiwia2V5IiwibyIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiZW51bWVyYWJsZSIsImdldCIsIm9iaiIsInByb3AiLCJwcm90b3R5cGUiLCJoYXNPd25Qcm9wZXJ0eSIsImNhbGwiLCJGb3JtVmFsaWRhdG9yIiwiY29uc3RydWN0b3IiLCJzZXR0aW5ncyIsImZvcm0iLCJ0aGlzIiwiX3NldHRpbmdzIiwiX2Zvcm0iLCJfaGFzSW52YWxpZElucHV0IiwiaW5wdXRMaXN0Iiwic29tZSIsImlucHV0RWxlbWVudCIsInZhbGlkaXR5IiwidmFsaWQiLCJfc2hvd0lucHV0RXJyb3IiLCJlcnJvck1lc3NhZ2UiLCJlcnJvckVsZW1lbnQiLCJxdWVyeVNlbGVjdG9yIiwiaWQiLCJjbGFzc0xpc3QiLCJhZGQiLCJpbnB1dEVycm9yQ2xhc3MiLCJ0ZXh0Q29udGVudCIsImVycm9yQ2xhc3MiLCJfaGlkZUlucHV0RXJyb3IiLCJyZW1vdmUiLCJfdG9nZ2xlQnV0dG9uU3RhdGUiLCJidXR0b25FbGVtZW50IiwiaW5hY3RpdmVCdXR0b25DbGFzcyIsImRpc2FibGVkIiwiX2Rpc2FibGVCdXR0b24iLCJfdG9nZ2xlSW5wdXRFcnJvciIsInZhbGlkYXRpb25NZXNzYWdlIiwiX3NldEV2ZW50TGlzdGVuZXJzIiwiYWRkRXZlbnRMaXN0ZW5lciIsImV2dCIsInByZXZlbnREZWZhdWx0IiwicXVlcnlTZWxlY3RvckFsbCIsImlucHV0U2VsZWN0b3IiLCJzdWJtaXRCdXR0b25TZWxlY3RvciIsImZvckVhY2giLCJyZXNldFZhbGlkYXRpb24iLCJwb3B1cCIsImlucHV0RWxlbWVudHMiLCJBcnJheSIsImZyb20iLCJkb2N1bWVudCIsImVuYWJsZVZhbGlkYXRpb24iLCJQb3B1cCIsInBvcHVwU2VsZWN0b3IiLCJfcG9wdXAiLCJvcGVuIiwiY2xvc2UiLCJfaGFuZGxlRXNjQ2xvc2UiLCJzZXRFdmVudExpc3RlbmVycyIsInRhcmdldCIsImNvbnRhaW5zIiwiUG9wdXBXaXRoRm9ybSIsImhhbmRsZUZvcm1TdWJtaXQiLCJzdXBlciIsIl9oYW5kbGVGb3JtU3VibWl0IiwiX2lucHV0TGlzdCIsIl9nZXRJbnB1dFZhbHVlcyIsIl9mb3JtVmFsdWVzIiwiaW5wdXQiLCJuYW1lIiwidmFsdWUiLCJDYXJkIiwiZGF0YSIsImNhcmRTZWxlY3RvciIsImhhbmRsZUNhcmRDbGljayIsInBvcHVwQ29uZmlybWF0aW9uIiwiX3RleHQiLCJ0ZXh0IiwiX2ltYWdlTGluayIsImltYWdlTGluayIsIl9saWtlcyIsImxpa2VzIiwiX2NhcmRTZWxlY3RvciIsIl9oYW5kbGVDYXJkQ2xpY2siLCJfcG9wdXBDb25maXJtYXRpb24iLCJfb3duZXJJZCIsIm93bmVyIiwiX2lkIiwiX3VzZXJJZCIsImN1cnJlbnRJZCIsIl9nZXRUZW1wbGF0ZSIsImNvbnRlbnQiLCJjbG9uZU5vZGUiLCJfdG9nZ2xlSGVhcnQiLCJpc0xpa2VkIiwiX2VsZW1lbnQiLCJfaGVhcnRJY29uIiwidG9nZ2xlIiwiYXBpIiwidG9nZ2xlTGlrZSIsInRoZW4iLCJyZXN1bHQiLCJpbm5lckhUTUwiLCJsZW5ndGgiLCJjYXRjaCIsImVyciIsImNvbnNvbGUiLCJsb2ciLCJyZW1vdmVDYXJkIiwibGluayIsImdlbmVyYXRlQ2FyZCIsIml0ZW0iLCJzcmMiLCJhbHQiLCJTZWN0aW9uIiwiY29udGFpbmVyU2VsZWN0b3IiLCJpdGVtcyIsInJlbmRlcmVyIiwiX2l0ZW1zIiwiX3JlbmRlcmVyIiwiX2NvbnRhaW5lciIsInJlbmRlckl0ZW1zIiwiYWRkSXRlbSIsImVsZW1lbnQiLCJwcmVwZW5kIiwiZWRpdEJ1dHRvbiIsIm5ld1BsYWNlQnV0dG9uIiwibmFtZUlucHV0IiwidGl0bGVJbnB1dCIsInBvcHVwUHJvZmlsZVNlbGVjdG9yIiwicG9wdXBQbGFjZVNlbGVjdG9yIiwicG9wdXBQaWN0dXJlU2VsZWN0b3IiLCJwcm9maWxlRm9ybSIsInBsYWNlRm9ybSIsInBpY3R1cmVGb3JtIiwicHJvZmlsZVBpY3R1cmUiLCJwcm9maWxlUGljdHVyZUJ1dHRvbiIsInByb2ZpbGVCdXR0b24iLCJwbGFjZUJ1dHRvbiIsInBpY3R1cmVCdXR0b24iLCJzZWN0aW9uIiwiYmFzZVVybCIsImhlYWRlcnMiLCJfYmFzZVVybCIsIl9oZWFkZXJzIiwiX3NlY3Rpb24iLCJfaGFuZGxlUmVzcG9uc2UiLCJyZXMiLCJvayIsImpzb24iLCJQcm9taXNlIiwicmVqZWN0Iiwic3RhdHVzIiwiaW5pdGlhbGl6ZSIsImFsbCIsImdldEluaXRpYWxVc2VyIiwiZ2V0SW5pdGlhbENhcmRzIiwiZmV0Y2giLCJhZGRDYXJ0IiwidGl0bGUiLCJtZXRob2QiLCJib2R5IiwiSlNPTiIsInN0cmluZ2lmeSIsImRlbGV0ZUNhcmQiLCJjaGFuZ2VQaWN0dXJlIiwiYXZhdGFyIiwic2V0TmV3VXNlciIsInVzZXJOYW1lIiwidXNlckpvYiIsImFib3V0IiwiYXV0aG9yaXphdGlvbiIsImhhbmRsZUNsaWNrIiwiX2hhbmRsZUNsaWNrIiwiX2J1dHRvbiIsImNhcmQiLCJfY2FyZCIsInBvcHVwSW1hZ2UiLCJfcG9wdXBJbWFnZSIsIl9wb3B1cEltYWdlVGl0bGUiLCJpbWFnZU5hbWUiLCJzZXRBdHRyaWJ1dGUiLCJ1c2VySW5mbyIsInVzZXJOYW1lU2VsZWN0b3IiLCJ1c2VySm9iU2VsZWN0b3IiLCJfcHJvZmlsZU5hbWUiLCJfcHJvZmlsZUZ1bmN0aW9uIiwiZ2V0VXNlckluZm8iLCJzZXRVc2VySW5mbyIsImNyZWF0ZUNhcmQiLCJ0ZW1wbGF0ZSIsImNhbGxiYWNrIiwidXNlciIsInBvcHVwUGxhY2UiLCJyZXNldCIsInBvcHVwUHJvZmlsZSIsInBvcHVwUHJvZmlsZVBpY3R1cmUiLCJwcm9maWxlVmFsaWRhdG9yIiwicGxhY2VWYWxpZGF0b3IiLCJwaWN0dXJlVmFsaWRhdG9yIl0sInNvdXJjZVJvb3QiOiIifQ==