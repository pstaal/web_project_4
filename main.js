!function(){"use strict";class e{constructor(e,t){this._settings=e,this._form=document.querySelector(t),this._buttonElement=document.querySelector(t).querySelector(this._settings.submitButtonSelector),this._inputList=[...document.querySelector(t).querySelectorAll(this._settings.inputSelector)]}_hasInvalidInput(e){return e.some((e=>!e.validity.valid))}_showInputError(e,t,s){const r=e.querySelector(".".concat(t.id,"-error"));t.classList.add(this._settings.inputErrorClass),r.textContent=s,r.classList.add(this._settings.errorClass)}_hideInputError(e,t){const s=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(this._settings.inputErrorClass),s.classList.remove(this._settings.errorClass),s.textContent=""}_toggleButtonState(e,t){this._hasInvalidInput(e)?this._disableButton(t):(t.classList.remove(this._settings.inactiveButtonClass),t.disabled=!1)}_disableButton(e){e.classList.add(this._settings.inactiveButtonClass),e.disabled=!0}_toggleInputError(e,t){t.validity.valid?this._hideInputError(e,t):this._showInputError(e,t,t.validationMessage)}_setEventListeners(){this._form.addEventListener("submit",(e=>{e.preventDefault()})),this._form.addEventListener("reset",(()=>{this._disableButton(this._buttonElement),this.resetValidation()})),this._inputList.forEach((e=>{e.addEventListener("input",(()=>{this._toggleInputError(this._form,e),this._toggleButtonState(this._inputList,this._buttonElement)}))}))}resetValidation(){this._inputList.forEach((e=>{this._hideInputError(this._form,e)}))}enableValidation(){this._setEventListeners(this._form)}}class t{constructor(e){this._popup=document.querySelector(e),this._handleEscClose=this._handleEscClose.bind(this)}open(){this._popup.classList.add("popup_opened"),document.addEventListener("keydown",this._handleEscClose)}close(){this._popup.classList.remove("popup_opened"),document.removeEventListener("keydown",this._handleEscClose)}_handleEscClose(e){"Escape"===e.key&&this.close()}setEventListeners(){this._popup.querySelector(".popup__close").addEventListener("click",(()=>{this.close()})),this._popup.addEventListener("click",(e=>{e.target.classList.contains("popup")&&this.close()}))}}class s extends t{constructor(e,t){super(e),this._handleFormSubmit=t,this._inputList=this._popup.querySelectorAll(".popup__input"),this._form=this._popup.querySelector(".popup__form"),this._submitButton=this._popup.querySelector(".popup__button"),this._submitButtonText=this._submitButton.textContent}renderLoading(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Saving...";this._submitButton.textContent=e?t:this._submitButtonText}_getInputValues(){return this._formValues={},this._inputList.forEach((e=>{this._formValues[e.name]=e.value})),this._formValues}close(){super.close(),this._form.reset()}setEventListeners(){super.setEventListeners(),this._form.addEventListener("submit",(e=>{e.preventDefault(),this._handleFormSubmit(this._getInputValues())}))}}class r{constructor(e,t,s,r,n){this._text=e.text,this._imageLink=e.imageLink,this._likes=e.likes,this._cardSelector=t,this._handleCardClick=s,this._popupConfirmation=r,this._ownerId=e.owner,this.id=e._id,this._userId=e.currentId,this._toggleLike=n}_getTemplate(){return document.querySelector(this._cardSelector).content.querySelector(".places__card").cloneNode(!0)}removeCard(){this._element.remove(),this._element=null}_setEventListeners(){this._heartIcon.addEventListener("click",(()=>{this._toggleLike()})),this._trashIcon&&this._trashIcon.addEventListener("click",(()=>{this._popupConfirmation.open(this)})),this._pictureElement.addEventListener("click",(e=>{this._handleCardClick({link:this._imageLink,text:this._text})}))}generateCard(){return this._element=this._getTemplate(),this._heartIcon=this._element.querySelector(".places__card-button"),this._likeCounter=this._element.querySelector(".places__likes-counter"),this._pictureElement=this._element.querySelector(".places__card-image"),this._trashIcon=this._element.querySelector(".places__card-delete-icon"),this._likes.some((e=>e._id===this._userId))&&this._heartIcon.classList.add("places__card-button-liked"),this._ownerId!==this._userId&&this._trashIcon.remove(),this._setEventListeners(),this._pictureElement.src=this._imageLink,this._pictureElement.alt=this._text,this._element.querySelector(".places__card-title").textContent=this._text,this._likeCounter.textContent=this._likes.length,this._element}}class n{constructor(e,t){let{items:s,renderer:r}=e;this._items=s,this._renderer=r,this._container=document.querySelector(t)}renderItems(){this._items.forEach((e=>{this._renderer(e)}))}addItem(e){this._container.prepend(e)}}const i=document.querySelector(".profile__button-name-change"),o=document.querySelector(".profile__button-add-place"),a=document.querySelector("[name='userName']"),c=document.querySelector("[name='userJob']"),l=(document.querySelector(".popup-profile"),document.querySelector(".popup-place")),u=document.querySelector(".popup-profile-picture"),p=(document.querySelector(".popup__form-profile"),document.querySelector(".popup__form-place"),document.querySelector(".popup__form-profile-picture"),document.querySelector(".profile__picture"),document.querySelector(".profile__picture-container")),h=(document.querySelector(".popup__button-profile"),document.querySelector(".popup__button-place"),document.querySelector(".popup__button-picture"),{inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"});let _,d;const m=new class{constructor(e){let{baseUrl:t,headers:s}=e;this._baseUrl=t,this._headers=s,this._section=null}_handleResponse(e){return e.ok?e.json():Promise.reject("Error: ".concat(e.status))}initialize(){return Promise.all([this.getInitialUser(),this.getInitialCards()])}getInitialCards(){return fetch("".concat(this._baseUrl,"/cards"),{headers:this._headers}).then((e=>this._handleResponse(e)))}getInitialUser(){return fetch("".concat(this._baseUrl,"/users/me"),{headers:this._headers}).then((e=>this._handleResponse(e)))}addCart(e){let{title:t,link:s}=e;return fetch("".concat(this._baseUrl,"/cards"),{method:"POST",headers:this._headers,body:JSON.stringify({name:t,link:s})}).then((e=>this._handleResponse(e)))}deleteCard(e){return fetch("".concat(this._baseUrl,"/cards/").concat(e),{method:"DELETE",headers:this._headers}).then((e=>this._handleResponse(e)))}toggleLike(e,t){return fetch("".concat(this._baseUrl,"/cards/likes/").concat(e),{method:t?"DELETE":"PUT",headers:this._headers}).then((e=>this._handleResponse(e)))}changePicture(e){let{avatar:t}=e;return fetch("".concat(this._baseUrl,"/users/me/avatar"),{method:"PATCH",headers:this._headers,body:JSON.stringify({avatar:t})}).then((e=>this._handleResponse(e)))}setNewUser(e){let{userName:t,userJob:s}=e;return fetch("".concat(this._baseUrl,"/users/me"),{method:"PATCH",headers:this._headers,body:JSON.stringify({name:t,about:s})}).then((e=>this._handleResponse(e)))}}({baseUrl:"https://around.nomoreparties.co/v1/group-12",headers:{authorization:"5ad7ef92-ff2d-4fbe-9e41-f5034926c435","Content-Type":"application/json"}}),f=new class extends t{constructor(e,t){super(e),this._handleClick=t,this._button=this._popup.querySelector(".popup__button")}open(e){super.open(),this._card=e}setEventListeners(){super.setEventListeners(),this._button.addEventListener("click",(()=>{this._handleClick(this._card)}))}}(".popup-confirm",(function(e){m.deleteCard(e.id).then((t=>{f.close(),e.removeCard()})).catch((e=>{console.log(e)}))}));function g(){let e=this._element.querySelector(".places__card-button").classList.contains("places__card-button-liked");this._heartIcon.classList.toggle("places__card-button-liked"),m.toggleLike(this.id,e).then((e=>{this._likeCounter.textContent=e.likes.length})).catch((e=>{console.log(e)}))}f.setEventListeners();const b=new class extends t{constructor(e){super(e),this._popupImage=document.querySelector(".popup-picture__image"),this._popupImageTitle=document.querySelector(".popup-picture__title")}open(e,t){this._popupImage.setAttribute("src",e),this._popupImage.setAttribute("alt",t),this._popupImageTitle.textContent=t,super.open()}}(".popup-picture");b.setEventListeners();const v=new class{constructor(e){let{userNameSelector:t,userJobSelector:s,pictureSelector:r}=e;this._profileName=document.querySelector(t),this._profileFunction=document.querySelector(s),this._picture=document.querySelector(r)}getUserInfo(){return{userName:this._profileName.textContent,userJob:this._profileFunction.textContent}}setUserInfo(e){let{userName:t,userJob:s,userAvatar:r}=e;this._profileName.textContent=t,this._profileFunction.textContent=s,this._picture.src=r}}({userNameSelector:".profile__name",userJobSelector:".profile__function",pictureSelector:".profile__picture"});function L(e,t,s,n,i){return new r(e,t,s,n,i).generateCard()}function E(e){let{link:t,text:s}=e;b.open(t,s)}m.initialize().then((e=>{const[t,s]=e;_=new n({items:s,renderer:e=>{d=t._id;const s=L({text:e.name,imageLink:e.link,likes:e.likes,owner:e.owner._id,_id:e._id,currentId:d},"#card-template",E,f,g);_.addItem(s)}},".places"),_.renderItems(),v.setUserInfo({userName:t.name,userJob:t.about,userAvatar:t.avatar})})).catch((e=>{console.log(e)}));const S=new s(".popup-place",(function(e){S.renderLoading(!0),m.addCart(e).then((e=>{const t=L({text:e.name,imageLink:e.link,likes:e.likes,owner:d,_id:e._id,currentId:d},"#card-template",E,f,g);_.addItem(t),S.close()})).catch((e=>{console.log(e)})).finally((()=>{S.renderLoading(!1)}))}));S.setEventListeners();const y=new s(".popup-profile",(function(e){y.renderLoading(!0),m.setNewUser(e).then((e=>{v.setUserInfo({userName:e.name,userJob:e.about,userAvatar:e.avatar}),y.close()})).catch((e=>{console.log(e)})).finally((()=>{y.renderLoading(!1)}))}));y.setEventListeners();const k=new s(".popup-profile-picture",(function(e){k.renderLoading(!0),m.changePicture(e).then((e=>{v.setUserInfo({userName:e.name,userJob:e.about,userAvatar:e.avatar}),k.close()})).catch((e=>{console.log(e)})).finally((()=>{k.renderLoading(!1)}))}));k.setEventListeners();const C=new e(h,".popup__form-profile");C.enableValidation();const I=new e(h,".popup__form-place");I.enableValidation();const q=new e(h,".popup__form-profile-picture");q.enableValidation(),o.addEventListener("click",(function(){I.resetValidation(l),S.open()})),i.addEventListener("click",(function(){C.resetValidation();const{userName:e,userJob:t}=v.getUserInfo();a.value=e,c.value=t,y.open()})),p.addEventListener("click",(function(){q.resetValidation(u),k.open()}))}();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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V3BELE1BQVF5RixFQUNuQm1DLEVBQWFoSixVQWRmMkUsRUFBcUJ0RixpQkFBaUIsU0FHdEMsV0FDRStKLEVBQWlCNUosZ0JBQWdCa0YsR0FDakN1RSxFQUFvQmpKLFUiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly93ZWJfcHJvamVjdF80Ly4vc3JjL2NvbXBvbmVudHMvRm9ybVZhbGlkYXRvci5qcyIsIndlYnBhY2s6Ly93ZWJfcHJvamVjdF80Ly4vc3JjL2NvbXBvbmVudHMvUG9wdXAuanMiLCJ3ZWJwYWNrOi8vd2ViX3Byb2plY3RfNC8uL3NyYy9jb21wb25lbnRzL1BvcHVwV2l0aEZvcm0uanMiLCJ3ZWJwYWNrOi8vd2ViX3Byb2plY3RfNC8uL3NyYy9jb21wb25lbnRzL0NhcmQuanMiLCJ3ZWJwYWNrOi8vd2ViX3Byb2plY3RfNC8uL3NyYy9jb21wb25lbnRzL1NlY3Rpb24uanMiLCJ3ZWJwYWNrOi8vd2ViX3Byb2plY3RfNC8uL3NyYy91dGlscy9jb25zdGFudHMuanMiLCJ3ZWJwYWNrOi8vd2ViX3Byb2plY3RfNC8uL3NyYy9wYWdlcy9pbmRleC5qcyIsIndlYnBhY2s6Ly93ZWJfcHJvamVjdF80Ly4vc3JjL2NvbXBvbmVudHMvQXBpLmpzIiwid2VicGFjazovL3dlYl9wcm9qZWN0XzQvLi9zcmMvY29tcG9uZW50cy9Qb3B1cENvbmZpcm1hdGlvbi5qcyIsIndlYnBhY2s6Ly93ZWJfcHJvamVjdF80Ly4vc3JjL2NvbXBvbmVudHMvUG9wdXBXaXRoSW1hZ2UuanMiLCJ3ZWJwYWNrOi8vd2ViX3Byb2plY3RfNC8uL3NyYy9jb21wb25lbnRzL1VzZXJJbmZvLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIlxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgRm9ybVZhbGlkYXRvciB7XG4gICAgY29uc3RydWN0b3Ioc2V0dGluZ3MsIGZvcm0pIHtcbiAgICAgICAgdGhpcy5fc2V0dGluZ3MgPSBzZXR0aW5ncztcbiAgICAgICAgdGhpcy5fZm9ybSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoZm9ybSk7XG4gICAgICAgIHRoaXMuX2J1dHRvbkVsZW1lbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGZvcm0pLnF1ZXJ5U2VsZWN0b3IodGhpcy5fc2V0dGluZ3Muc3VibWl0QnV0dG9uU2VsZWN0b3IpO1xuICAgICAgICB0aGlzLl9pbnB1dExpc3QgPSBbLi4uZG9jdW1lbnQucXVlcnlTZWxlY3Rvcihmb3JtKS5xdWVyeVNlbGVjdG9yQWxsKHRoaXMuX3NldHRpbmdzLmlucHV0U2VsZWN0b3IpXTtcbiAgICB9XG4gICAgXG4gICAgX2hhc0ludmFsaWRJbnB1dCAoaW5wdXRMaXN0KSB7XG4gICAgICAgIHJldHVybiBpbnB1dExpc3Quc29tZSgoaW5wdXRFbGVtZW50KSA9PiB7IFxuICAgIFxuICAgICAgICAgIHJldHVybiAhaW5wdXRFbGVtZW50LnZhbGlkaXR5LnZhbGlkOyBcbiAgICBcbiAgICAgICAgfSk7IFxuICAgICAgfVxuXG4gICAgX3Nob3dJbnB1dEVycm9yIChmb3JtLCBpbnB1dEVsZW1lbnQsIGVycm9yTWVzc2FnZSApIHtcbiAgICAgICAgLy8gRmluZCB0aGUgZXJyb3IgbWVzc2FnZSBlbGVtZW50IGluc2lkZSB0aGUgdmVyeSBmdW5jdGlvblxuICAgICAgICBjb25zdCBlcnJvckVsZW1lbnQgPSBmb3JtLnF1ZXJ5U2VsZWN0b3IoYC4ke2lucHV0RWxlbWVudC5pZH0tZXJyb3JgKTtcbiAgICAgICAgLy8gVGhlIHJlc3QgcmVtYWlucyB1bmNoYW5nZWRcbiAgICAgICAgaW5wdXRFbGVtZW50LmNsYXNzTGlzdC5hZGQodGhpcy5fc2V0dGluZ3MuaW5wdXRFcnJvckNsYXNzKTtcbiAgICAgICAgZXJyb3JFbGVtZW50LnRleHRDb250ZW50ID0gZXJyb3JNZXNzYWdlO1xuICAgICAgICBlcnJvckVsZW1lbnQuY2xhc3NMaXN0LmFkZCh0aGlzLl9zZXR0aW5ncy5lcnJvckNsYXNzKTtcbiAgICAgIH1cbiAgICAgIFxuICAgIF9oaWRlSW5wdXRFcnJvciAoZm9ybSwgaW5wdXRFbGVtZW50ICkge1xuICAgICAgICAvLyBGaW5kIHRoZSBlcnJvciBtZXNzYWdlIGVsZW1lbnRcbiAgICAgICAgY29uc3QgZXJyb3JFbGVtZW50ID0gZm9ybS5xdWVyeVNlbGVjdG9yKGAuJHtpbnB1dEVsZW1lbnQuaWR9LWVycm9yYCk7XG4gICAgICAgIC8vIFRoZSByZXN0IHJlbWFpbnMgdW5jaGFuZ2VkXG4gICAgICAgIGlucHV0RWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKHRoaXMuX3NldHRpbmdzLmlucHV0RXJyb3JDbGFzcyk7XG4gICAgICAgIGVycm9yRWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKHRoaXMuX3NldHRpbmdzLmVycm9yQ2xhc3MpO1xuICAgICAgICBlcnJvckVsZW1lbnQudGV4dENvbnRlbnQgPSBcIlwiO1xuICAgICAgfVxuXG4gICAgX3RvZ2dsZUJ1dHRvblN0YXRlIChpbnB1dExpc3QsIGJ1dHRvbkVsZW1lbnQpIHtcbiAgICAgICAgaWYgKHRoaXMuX2hhc0ludmFsaWRJbnB1dChpbnB1dExpc3QpKSB7XG4gICAgICAgICAgdGhpcy5fZGlzYWJsZUJ1dHRvbihidXR0b25FbGVtZW50KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBidXR0b25FbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUodGhpcy5fc2V0dGluZ3MuaW5hY3RpdmVCdXR0b25DbGFzcyk7XG4gICAgICAgICAgYnV0dG9uRWxlbWVudC5kaXNhYmxlZCA9IGZhbHNlO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgXG4gICAgICBfZGlzYWJsZUJ1dHRvbihidXR0b25FbGVtZW50KSB7XG4gICAgICAgIGJ1dHRvbkVsZW1lbnQuY2xhc3NMaXN0LmFkZCh0aGlzLl9zZXR0aW5ncy5pbmFjdGl2ZUJ1dHRvbkNsYXNzKTtcbiAgICAgICAgYnV0dG9uRWxlbWVudC5kaXNhYmxlZCA9IHRydWU7XG4gICAgICB9XG4gICAgXG4gICAgX3RvZ2dsZUlucHV0RXJyb3IgKGZvcm0sIGlucHV0RWxlbWVudCkge1xuICAgICAgICBpZiAoIWlucHV0RWxlbWVudC52YWxpZGl0eS52YWxpZCkge1xuICAgICAgICAgIC8vIFRoZSBwYXJhbWV0ZXIgb2Ygc2hvd0lucHV0RXJyb3IoKSBpcyBub3cgYSBmb3JtLFxuICAgICAgICAgIC8vIHdoaWNoIGNvbnRhaW5zIGEgZmllbGQgdG8gYmUgY2hlY2tlZFxuICAgICAgICAgIHRoaXMuX3Nob3dJbnB1dEVycm9yKGZvcm0sIGlucHV0RWxlbWVudCwgaW5wdXRFbGVtZW50LnZhbGlkYXRpb25NZXNzYWdlKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAvLyBUaGUgc2FtZSBmb3IgaGlkZUlucHV0RXJyb3IoKSwgSXRzIHBhcmFtZXRlciBpcyBub3cgYSBmb3JtLFxuICAgICAgICAgIC8vIHdoaWNoIGNvbnRhaW5zIGEgZmllbGQgdG8gYmUgY2hlY2tlZFxuICAgICAgICAgIHRoaXMuX2hpZGVJbnB1dEVycm9yKGZvcm0sIGlucHV0RWxlbWVudCk7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgX3NldEV2ZW50TGlzdGVuZXJzKCkge1xuICAgIHRoaXMuX2Zvcm0uYWRkRXZlbnRMaXN0ZW5lcihcInN1Ym1pdFwiLCAoZXZ0KSA9PiB7XG4gICAgICAgIC8vIENhbmNlbCBkZWZhdWx0IGJlaGF2aW9yIGZvciB0aGUgZm9ybVxuICAgICAgICBldnQucHJldmVudERlZmF1bHQoKTtcbiAgICB9KTtcblxuICAgIHRoaXMuX2Zvcm0uYWRkRXZlbnRMaXN0ZW5lcihcInJlc2V0XCIsICgpID0+IHsgXG4gICAgICB0aGlzLl9kaXNhYmxlQnV0dG9uKHRoaXMuX2J1dHRvbkVsZW1lbnQpOyBcbiAgICAgIHRoaXMucmVzZXRWYWxpZGF0aW9uKCk7XG4gICAgfSk7IFxuICBcbiAgICAvLyBJdGVyYXRlIG92ZXIgdGhlIHJlc3VsdGluZyBhcnJheVxuICAgIHRoaXMuX2lucHV0TGlzdC5mb3JFYWNoKChpbnB1dEVsZW1lbnQpID0+IHtcbiAgICAgIC8vIGFkZCB0aGUgaW5wdXQgZXZlbnQgaGFuZGxlciB0byBlYWNoIGZpZWxkXG4gICAgICBpbnB1dEVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImlucHV0XCIsICgpID0+IHtcbiAgICAgICAgLy8gQ2FsbCB0aGUgdG9nZ2xlSW5wdXRFcnJvcigpIGZ1bmN0aW9uIGluc2lkZSB0aGUgY2FsbGJhY2ssXG4gICAgICAgIC8vIGFuZCBwYXNzIHRoZSBmb3JtIGFuZCB0aGUgZWxlbWVudCB0byBiZSBjaGVja2VkIHRvIGl0XG4gICAgICAgIHRoaXMuX3RvZ2dsZUlucHV0RXJyb3IodGhpcy5fZm9ybSwgaW5wdXRFbGVtZW50KTtcbiAgICAgICAgdGhpcy5fdG9nZ2xlQnV0dG9uU3RhdGUodGhpcy5faW5wdXRMaXN0LCB0aGlzLl9idXR0b25FbGVtZW50KTtcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gIH1cblxuICByZXNldFZhbGlkYXRpb24gKCl7IFxuICAgIHRoaXMuX2lucHV0TGlzdC5mb3JFYWNoKChpbnB1dEVsZW1lbnQpID0+IHsgXG4gICAgICAgIHRoaXMuX2hpZGVJbnB1dEVycm9yKHRoaXMuX2Zvcm0sIGlucHV0RWxlbWVudCk7IFxuICAgIH0pOyBcbiAgfTsgXG5cbiAgZW5hYmxlVmFsaWRhdGlvbigpIHtcbiAgICB0aGlzLl9zZXRFdmVudExpc3RlbmVycyh0aGlzLl9mb3JtKTtcbiAgfVxufSIsImV4cG9ydCBkZWZhdWx0IGNsYXNzIFBvcHVwIHtcbiAgICBjb25zdHJ1Y3Rvcihwb3B1cFNlbGVjdG9yKXtcbiAgICAgICAgdGhpcy5fcG9wdXAgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKHBvcHVwU2VsZWN0b3IpO1xuICAgICAgICB0aGlzLl9oYW5kbGVFc2NDbG9zZSA9IHRoaXMuX2hhbmRsZUVzY0Nsb3NlLmJpbmQodGhpcyk7XG4gICAgfVxuXG4gICAgb3BlbigpIHtcbiAgICAgICAgdGhpcy5fcG9wdXAuY2xhc3NMaXN0LmFkZCgncG9wdXBfb3BlbmVkJyk7XG4gICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJrZXlkb3duXCIsIHRoaXMuX2hhbmRsZUVzY0Nsb3NlKTtcbiAgICB9XG5cbiAgICBjbG9zZSgpIHtcbiAgICAgICAgdGhpcy5fcG9wdXAuY2xhc3NMaXN0LnJlbW92ZSgncG9wdXBfb3BlbmVkJyk7XG4gICAgICAgIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2tleWRvd24nLCB0aGlzLl9oYW5kbGVFc2NDbG9zZSk7XG4gICAgfVxuXG4gICAgX2hhbmRsZUVzY0Nsb3NlKGV2dCl7XG4gICAgICAgIGlmIChldnQua2V5ID09PVwiRXNjYXBlXCIpIHtcbiAgICAgICAgICAgIHRoaXMuY2xvc2UoKTtcbiAgICAgICAgICB9XG4gICAgfVxuICAgIFxuICAgIHNldEV2ZW50TGlzdGVuZXJzKCkge1xuICAgICAgICB0aGlzLl9wb3B1cC5xdWVyeVNlbGVjdG9yKCcucG9wdXBfX2Nsb3NlJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7XG4gICAgICAgICAgICB0aGlzLmNsb3NlKCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHRoaXMuX3BvcHVwLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoZXZ0KSA9PiB7XG4gICAgICAgICAgICBpZiAoZXZ0LnRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoJ3BvcHVwJykpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmNsb3NlKCk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICB9XG5cbn0iLCJpbXBvcnQgUG9wdXAgZnJvbSBcIi4vUG9wdXAuanNcIjtcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgUG9wdXBXaXRoRm9ybSBleHRlbmRzIFBvcHVwIHtcbiAgICBjb25zdHJ1Y3Rvcihwb3B1cFNlbGVjdG9yLCBoYW5kbGVGb3JtU3VibWl0KSB7XG4gICAgICAgIHN1cGVyKHBvcHVwU2VsZWN0b3IpO1xuICAgICAgICB0aGlzLl9oYW5kbGVGb3JtU3VibWl0ID0gaGFuZGxlRm9ybVN1Ym1pdDtcbiAgICAgICAgdGhpcy5faW5wdXRMaXN0ID0gdGhpcy5fcG9wdXAucXVlcnlTZWxlY3RvckFsbChcIi5wb3B1cF9faW5wdXRcIik7XG4gICAgICAgIHRoaXMuX2Zvcm0gPSB0aGlzLl9wb3B1cC5xdWVyeVNlbGVjdG9yKCcucG9wdXBfX2Zvcm0nKTtcbiAgICAgICAgdGhpcy5fc3VibWl0QnV0dG9uID0gdGhpcy5fcG9wdXAucXVlcnlTZWxlY3RvcignLnBvcHVwX19idXR0b24nKTtcbiAgICAgICAgdGhpcy5fc3VibWl0QnV0dG9uVGV4dCA9IHRoaXMuX3N1Ym1pdEJ1dHRvbi50ZXh0Q29udGVudDtcbiAgICB9XG5cbiAgICByZW5kZXJMb2FkaW5nKGlzTG9hZGluZywgbG9hZGluZ1RleHQ9J1NhdmluZy4uLicpIHtcbiAgICAgICAgaWYgKGlzTG9hZGluZykge1xuICAgICAgICAgIHRoaXMuX3N1Ym1pdEJ1dHRvbi50ZXh0Q29udGVudCA9IGxvYWRpbmdUZXh0O1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHRoaXMuX3N1Ym1pdEJ1dHRvbi50ZXh0Q29udGVudCA9IHRoaXMuX3N1Ym1pdEJ1dHRvblRleHQ7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBfZ2V0SW5wdXRWYWx1ZXMoKSB7XG4gICAgICAgIFxuXG4gICAgICAgIC8vIENyZWF0ZSBhbiBlbXB0eSBvYmplY3RcbiAgICAgICAgdGhpcy5fZm9ybVZhbHVlcyA9IHt9O1xuXG4gICAgICAgIC8vIEFkZCB0aGUgdmFsdWVzIG9mIHRoZSBmaWVsZHMgdG8gdGhpcyBvYmplY3RcbiAgICAgICAgdGhpcy5faW5wdXRMaXN0LmZvckVhY2goaW5wdXQgPT4ge1xuICAgICAgICAgICAgdGhpcy5fZm9ybVZhbHVlc1tpbnB1dC5uYW1lXSA9IGlucHV0LnZhbHVlO1xuICAgICAgICB9KTtcblxuICAgICAgICAvLyBSZXR1cm4gdGhlIHZhbHVlcyBvYmplY3RcbiAgICAgICAgcmV0dXJuIHRoaXMuX2Zvcm1WYWx1ZXM7XG4gICAgfSBcblxuICAgIGNsb3NlKCkge1xuICAgICAgICBzdXBlci5jbG9zZSgpO1xuICAgICAgICB0aGlzLl9mb3JtLnJlc2V0KCk7XG4gICAgfVxuXG5cbiAgICBzZXRFdmVudExpc3RlbmVycygpIHtcblxuICAgICAgICBzdXBlci5zZXRFdmVudExpc3RlbmVycygpO1xuICAgICAgICB0aGlzLl9mb3JtLmFkZEV2ZW50TGlzdGVuZXIoJ3N1Ym1pdCcsIChldnQpID0+IHtcbiAgICAgICAgICAgIGV2dC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgdGhpcy5faGFuZGxlRm9ybVN1Ym1pdCh0aGlzLl9nZXRJbnB1dFZhbHVlcygpKTtcbiAgICAgICAgfSk7XG5cbiAgICB9XG4gICAgXG5cbn07IiwiZXhwb3J0IGRlZmF1bHQgY2xhc3MgQ2FyZCB7XG5cbiAgICBjb25zdHJ1Y3RvcihkYXRhLCBjYXJkU2VsZWN0b3IsIGhhbmRsZUNhcmRDbGljaywgcG9wdXBDb25maXJtYXRpb24sIHRvZ2dsZUxpa2UpIHtcbiAgICAgICAgdGhpcy5fdGV4dCA9IGRhdGEudGV4dDtcbiAgICAgICAgdGhpcy5faW1hZ2VMaW5rID0gZGF0YS5pbWFnZUxpbms7XG4gICAgICAgIHRoaXMuX2xpa2VzID0gZGF0YS5saWtlcztcbiAgICAgICAgdGhpcy5fY2FyZFNlbGVjdG9yID0gY2FyZFNlbGVjdG9yO1xuICAgICAgICB0aGlzLl9oYW5kbGVDYXJkQ2xpY2sgPSBoYW5kbGVDYXJkQ2xpY2s7XG4gICAgICAgIHRoaXMuX3BvcHVwQ29uZmlybWF0aW9uID0gcG9wdXBDb25maXJtYXRpb247XG4gICAgICAgIHRoaXMuX293bmVySWQgPSBkYXRhLm93bmVyO1xuICAgICAgICB0aGlzLmlkID0gZGF0YS5faWQ7XG4gICAgICAgIHRoaXMuX3VzZXJJZCA9IGRhdGEuY3VycmVudElkO1xuICAgICAgICB0aGlzLl90b2dnbGVMaWtlID0gdG9nZ2xlTGlrZTtcbiAgICB9XG5cbiAgICBfZ2V0VGVtcGxhdGUoKXtcbiAgICAgICAgY29uc3QgY2FyZEVsZW1lbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKHRoaXMuX2NhcmRTZWxlY3RvcikuY29udGVudC5xdWVyeVNlbGVjdG9yKFwiLnBsYWNlc19fY2FyZFwiKS5jbG9uZU5vZGUodHJ1ZSk7XG5cbiAgICAgICAgcmV0dXJuIGNhcmRFbGVtZW50O1xuICAgIH1cblxuICAgIHJlbW92ZUNhcmQoKXtcbiAgICAgICAgdGhpcy5fZWxlbWVudC5yZW1vdmUoKTtcbiAgICAgICAgdGhpcy5fZWxlbWVudCA9IG51bGw7XG4gICAgfVxuXG5cbiAgICBfc2V0RXZlbnRMaXN0ZW5lcnMoKSB7XG4gICAgICAgIHRoaXMuX2hlYXJ0SWNvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5fdG9nZ2xlTGlrZSgpO1xuICAgICAgICB9KTtcbiAgICAgICAgICBpZih0aGlzLl90cmFzaEljb24peyBcbiAgICAgICAgICAgIHRoaXMuX3RyYXNoSWNvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgICAgICAgICAgICB0aGlzLl9wb3B1cENvbmZpcm1hdGlvbi5vcGVuKHRoaXMpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIHRoaXMuX3BpY3R1cmVFbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoZXZ0KSA9PiB7XG4gICAgICAgICAgICB0aGlzLl9oYW5kbGVDYXJkQ2xpY2soeyBsaW5rOiB0aGlzLl9pbWFnZUxpbmssIHRleHQ6IHRoaXMuX3RleHQgfSk7IFxuICAgICAgICAgIH0pO1xuICAgIH1cblxuICAgIGdlbmVyYXRlQ2FyZCgpIHtcbiAgICAgICAgdGhpcy5fZWxlbWVudCA9IHRoaXMuX2dldFRlbXBsYXRlKCk7XG4gICAgICAgIHRoaXMuX2hlYXJ0SWNvbiA9IHRoaXMuX2VsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5wbGFjZXNfX2NhcmQtYnV0dG9uXCIpO1xuICAgICAgICB0aGlzLl9saWtlQ291bnRlciA9IHRoaXMuX2VsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5wbGFjZXNfX2xpa2VzLWNvdW50ZXJcIik7XG4gICAgICAgIHRoaXMuX3BpY3R1cmVFbGVtZW50ID0gdGhpcy5fZWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLnBsYWNlc19fY2FyZC1pbWFnZVwiKTtcbiAgICAgICAgdGhpcy5fdHJhc2hJY29uID0gdGhpcy5fZWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLnBsYWNlc19fY2FyZC1kZWxldGUtaWNvblwiKTtcbiAgICAgICAgaWYodGhpcy5fbGlrZXMuc29tZShpdGVtID0+IGl0ZW0uX2lkID09PSB0aGlzLl91c2VySWQpKSB7XG4gICAgICAgICAgdGhpcy5faGVhcnRJY29uLmNsYXNzTGlzdC5hZGQoJ3BsYWNlc19fY2FyZC1idXR0b24tbGlrZWQnKTtcbiAgICAgICAgfVxuICAgICAgICBpZih0aGlzLl9vd25lcklkICE9PSB0aGlzLl91c2VySWQpIHtcbiAgICAgICAgICB0aGlzLl90cmFzaEljb24ucmVtb3ZlKCk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5fc2V0RXZlbnRMaXN0ZW5lcnMoKTsgXG4gICAgICAgIHRoaXMuX3BpY3R1cmVFbGVtZW50LnNyYyA9IHRoaXMuX2ltYWdlTGluaztcbiAgICAgICAgdGhpcy5fcGljdHVyZUVsZW1lbnQuYWx0ID0gdGhpcy5fdGV4dDtcbiAgICAgICAgdGhpcy5fZWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLnBsYWNlc19fY2FyZC10aXRsZVwiKS50ZXh0Q29udGVudCA9IHRoaXMuX3RleHQ7XG4gICAgICAgIHRoaXMuX2xpa2VDb3VudGVyLnRleHRDb250ZW50ID0gdGhpcy5fbGlrZXMubGVuZ3RoO1xuICAgICAgXG4gICAgICAgIHJldHVybiB0aGlzLl9lbGVtZW50O1xuICAgICAgfSBcblxufSIsImV4cG9ydCBkZWZhdWx0IGNsYXNzIFNlY3Rpb24ge1xuICAgIGNvbnN0cnVjdG9yKHtpdGVtcywgcmVuZGVyZXJ9LCBjb250YWluZXJTZWxlY3Rvcikge1xuICAgICAgICB0aGlzLl9pdGVtcyA9IGl0ZW1zO1xuICAgICAgICB0aGlzLl9yZW5kZXJlciA9IHJlbmRlcmVyO1xuICAgICAgICB0aGlzLl9jb250YWluZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGNvbnRhaW5lclNlbGVjdG9yKTtcbiAgICB9XG5cbiAgICByZW5kZXJJdGVtcygpIHtcbiAgICAgICAgdGhpcy5faXRlbXMuZm9yRWFjaChpdGVtID0+IHtcbiAgICAgICAgICB0aGlzLl9yZW5kZXJlcihpdGVtKTsgXG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIGFkZEl0ZW0oZWxlbWVudCkge1xuICAgICAgICB0aGlzLl9jb250YWluZXIucHJlcGVuZChlbGVtZW50KTtcbiAgICAgIH1cblxufSIsImV4cG9ydCBjb25zdCBlZGl0QnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnByb2ZpbGVfX2J1dHRvbi1uYW1lLWNoYW5nZScpO1xuZXhwb3J0IGNvbnN0IG5ld1BsYWNlQnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnByb2ZpbGVfX2J1dHRvbi1hZGQtcGxhY2UnKTtcbmV4cG9ydCBjb25zdCBuYW1lSW5wdXQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiW25hbWU9J3VzZXJOYW1lJ11cIik7IFxuZXhwb3J0IGNvbnN0IHRpdGxlSW5wdXQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiW25hbWU9J3VzZXJKb2InXVwiKTsgXG5leHBvcnQgY29uc3QgcG9wdXBQcm9maWxlU2VsZWN0b3IgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcucG9wdXAtcHJvZmlsZScpO1xuZXhwb3J0IGNvbnN0IHBvcHVwUGxhY2VTZWxlY3RvciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5wb3B1cC1wbGFjZScpO1xuZXhwb3J0IGNvbnN0IHBvcHVwUGljdHVyZVNlbGVjdG9yID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnBvcHVwLXByb2ZpbGUtcGljdHVyZScpO1xuZXhwb3J0IGNvbnN0IHByb2ZpbGVGb3JtID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnBvcHVwX19mb3JtLXByb2ZpbGUnKTtcbmV4cG9ydCBjb25zdCBwbGFjZUZvcm0gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcucG9wdXBfX2Zvcm0tcGxhY2UnKTtcbmV4cG9ydCBjb25zdCBwaWN0dXJlRm9ybSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5wb3B1cF9fZm9ybS1wcm9maWxlLXBpY3R1cmUnKTtcbmV4cG9ydCBjb25zdCBwcm9maWxlUGljdHVyZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5wcm9maWxlX19waWN0dXJlJyk7XG5leHBvcnQgY29uc3QgcHJvZmlsZVBpY3R1cmVCdXR0b24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcucHJvZmlsZV9fcGljdHVyZS1jb250YWluZXInKTtcbmV4cG9ydCBjb25zdCBwcm9maWxlQnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnBvcHVwX19idXR0b24tcHJvZmlsZScpO1xuZXhwb3J0IGNvbnN0IHBsYWNlQnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnBvcHVwX19idXR0b24tcGxhY2UnKTtcbmV4cG9ydCBjb25zdCBwaWN0dXJlQnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnBvcHVwX19idXR0b24tcGljdHVyZScpO1xuZXhwb3J0IGNvbnN0IHZhbGlkYXRpb25TZXR0aW5ncyA9IHtcbiAgICBpbnB1dFNlbGVjdG9yOiBcIi5wb3B1cF9faW5wdXRcIixcbiAgICBzdWJtaXRCdXR0b25TZWxlY3RvcjogXCIucG9wdXBfX2J1dHRvblwiLFxuICAgIGluYWN0aXZlQnV0dG9uQ2xhc3M6IFwicG9wdXBfX2J1dHRvbl9kaXNhYmxlZFwiLFxuICAgIGlucHV0RXJyb3JDbGFzczogXCJwb3B1cF9faW5wdXRfdHlwZV9lcnJvclwiLFxuICAgIGVycm9yQ2xhc3M6IFwicG9wdXBfX2Vycm9yX3Zpc2libGVcIlxuICB9OyIsImltcG9ydCBGb3JtVmFsaWRhdG9yIGZyb20gXCIuLi9jb21wb25lbnRzL0Zvcm1WYWxpZGF0b3IuanNcIjtcbmltcG9ydCBQb3B1cFdpdGhGb3JtIGZyb20gXCIuLi9jb21wb25lbnRzL1BvcHVwV2l0aEZvcm0uanNcIjtcbmltcG9ydCBBcGkgZnJvbSBcIi4uL2NvbXBvbmVudHMvQXBpLmpzXCI7XG5pbXBvcnQgQ2FyZCBmcm9tIFwiLi4vY29tcG9uZW50cy9DYXJkXCI7XG5pbXBvcnQgU2VjdGlvbiBmcm9tIFwiLi4vY29tcG9uZW50cy9TZWN0aW9uXCI7XG5pbXBvcnQgVXNlckluZm8gZnJvbSBcIi4uL2NvbXBvbmVudHMvVXNlckluZm9cIjtcbmltcG9ydCBQb3B1cENvbmZpcm1hdGlvbiBmcm9tIFwiLi4vY29tcG9uZW50cy9Qb3B1cENvbmZpcm1hdGlvblwiO1xuaW1wb3J0IFBvcHVwV2l0aEltYWdlIGZyb20gXCIuLi9jb21wb25lbnRzL1BvcHVwV2l0aEltYWdlXCI7XG5pbXBvcnQgeyB2YWxpZGF0aW9uU2V0dGluZ3MsIHByb2ZpbGVQaWN0dXJlLCBwcm9maWxlQnV0dG9uLCBwbGFjZUJ1dHRvbiwgcGljdHVyZUJ1dHRvbiwgbmV3UGxhY2VCdXR0b24sIGVkaXRCdXR0b24sIG5hbWVJbnB1dCwgdGl0bGVJbnB1dCwgcG9wdXBQcm9maWxlU2VsZWN0b3IsIHBvcHVwUGxhY2VTZWxlY3RvciwgcHJvZmlsZUZvcm0sIHBsYWNlRm9ybSwgcGljdHVyZUZvcm0sIHByb2ZpbGVQaWN0dXJlQnV0dG9uLCBwb3B1cFBpY3R1cmVTZWxlY3RvciB9IGZyb20gXCIuLi91dGlscy9jb25zdGFudHMuanNcIjtcbmltcG9ydCBcIi4vc3R5bGVzLmNzc1wiO1xuXG5cbi8vc2V0IGNvbnN0YW50c1xuXG5sZXQgc2VjdGlvbjtcbmxldCBjdXJyZW50SWQ7XG5cbi8vaW5pdGFsaXplIGFwaSBjbGFzc1xuZXhwb3J0IGNvbnN0IGFwaSA9IG5ldyBBcGkoe1xuICBiYXNlVXJsOiBcImh0dHBzOi8vYXJvdW5kLm5vbW9yZXBhcnRpZXMuY28vdjEvZ3JvdXAtMTJcIixcbiAgaGVhZGVyczoge1xuICAgIGF1dGhvcml6YXRpb246IFwiNWFkN2VmOTItZmYyZC00ZmJlLTllNDEtZjUwMzQ5MjZjNDM1XCIsXG4gICAgXCJDb250ZW50LVR5cGVcIjogXCJhcHBsaWNhdGlvbi9qc29uXCJcbiAgfVxufSk7IFxuXG4vL2luc3RhbnRpYXRlIHBvcHVwIGNvbmZpcm1hdGlvbiBjbGFzc1xuY29uc3QgcG9wdXBDb25maXJtYXRpb24gPSBuZXcgUG9wdXBDb25maXJtYXRpb24oXCIucG9wdXAtY29uZmlybVwiLCBoYW5kbGVDbGljayk7XG5wb3B1cENvbmZpcm1hdGlvbi5zZXRFdmVudExpc3RlbmVycygpO1xuXG4vL2hhbmRsZWNsaWNrIGZ1bmN0aW9uIGZvciBkZWxldGluZyBjYXJkXG5mdW5jdGlvbiBoYW5kbGVDbGljayhjYXJkKSB7XG4gIGFwaS5kZWxldGVDYXJkKGNhcmQuaWQpLnRoZW4ocmVzID0+IHtcbiAgICBwb3B1cENvbmZpcm1hdGlvbi5jbG9zZSgpO1xuICAgIGNhcmQucmVtb3ZlQ2FyZCgpO1xuICB9KVxuICAuY2F0Y2goKGVycikgPT4ge1xuICAgIGNvbnNvbGUubG9nKGVycik7IC8vIGxvZyB0aGUgZXJyb3IgdG8gdGhlIGNvbnNvbGVcbiAgfSk7XG59XG5cbi8vdG9nZ2xlTGlrZSBmdW5jdGlvblxuZnVuY3Rpb24gdG9nZ2xlTGlrZSgpIHtcbiAgbGV0IGlzTGlrZWQgPSB0aGlzLl9lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucGxhY2VzX19jYXJkLWJ1dHRvblwiKS5jbGFzc0xpc3QuY29udGFpbnMoXCJwbGFjZXNfX2NhcmQtYnV0dG9uLWxpa2VkXCIpO1xuICB0aGlzLl9oZWFydEljb24uY2xhc3NMaXN0LnRvZ2dsZSgncGxhY2VzX19jYXJkLWJ1dHRvbi1saWtlZCcpO1xuICBhcGkudG9nZ2xlTGlrZSh0aGlzLmlkLCBpc0xpa2VkKS50aGVuKChyZXN1bHQpID0+IHtcbiAgICAgIHRoaXMuX2xpa2VDb3VudGVyLnRleHRDb250ZW50ID0gcmVzdWx0Lmxpa2VzLmxlbmd0aDtcbiAgICAgIH0pXG4gICAgICAuY2F0Y2goKGVycikgPT4ge1xuICAgICAgICBjb25zb2xlLmxvZyhlcnIpOyAvLyBsb2cgdGhlIGVycm9yIHRvIHRoZSBjb25zb2xlXG4gICAgICB9KTtcbn1cblxuXG4vL2luc3RhbnRpYXRlIHBvcHVwaW1hZ2UgY2xhc3NcbmNvbnN0IHBvcHVwSW1hZ2UgPSBuZXcgUG9wdXBXaXRoSW1hZ2UoXCIucG9wdXAtcGljdHVyZVwiKTtcbnBvcHVwSW1hZ2Uuc2V0RXZlbnRMaXN0ZW5lcnMoKTtcblxuLy9pbnN0YW50aWF0ZSB1c2VyIGluZm8gY2xhc3NcbmV4cG9ydCBjb25zdCB1c2VySW5mbyA9IG5ldyBVc2VySW5mbyh7dXNlck5hbWVTZWxlY3RvcjogJy5wcm9maWxlX19uYW1lJywgdXNlckpvYlNlbGVjdG9yOiAnLnByb2ZpbGVfX2Z1bmN0aW9uJywgcGljdHVyZVNlbGVjdG9yOiAnLnByb2ZpbGVfX3BpY3R1cmUnfSk7XG5cblxuLy9mdW5jdGlvbiB0byBjcmVhdGUgYSBuZXcgY2FyZFxuZnVuY3Rpb24gY3JlYXRlQ2FyZChkYXRhLCB0ZW1wbGF0ZSwgY2FsbGJhY2ssIHBvcHVwQ29uZmlybWF0aW9uLCB0b2dnbGVMaWtlKSB7XG4gICAgY29uc3QgY2FyZCA9IG5ldyBDYXJkKGRhdGEsIHRlbXBsYXRlLCBjYWxsYmFjaywgcG9wdXBDb25maXJtYXRpb24sIHRvZ2dsZUxpa2UpO1xuICAgIHJldHVybiBjYXJkLmdlbmVyYXRlQ2FyZCgpO1xufVxuXG4vL2NyZWF0ZSBoYW5kbGVDYXJkQ2xpY2sgZnVuY3Rpb24gZm9yIGNhcmRzXG5leHBvcnQgZnVuY3Rpb24gaGFuZGxlQ2FyZENsaWNrKHsgbGluaywgdGV4dCB9KSB7XG4gIHBvcHVwSW1hZ2Uub3BlbihsaW5rLCB0ZXh0KTsgXG59O1xuXG5cblxuXG5hcGkuaW5pdGlhbGl6ZSgpLnRoZW4ocmVzID0+IHtcbiAgY29uc3QgW3VzZXIsIGRhdGFdID0gcmVzO1xuICBzZWN0aW9uID0gbmV3IFNlY3Rpb24oeyBcbiAgICBpdGVtczogZGF0YSwgXG4gICAgcmVuZGVyZXI6IChpdGVtKSA9PiB7XG4gICAgICBjdXJyZW50SWQgPSB1c2VyLl9pZDtcbiAgICAgIGNvbnN0IGVsZW1lbnQgPSBjcmVhdGVDYXJkKHt0ZXh0OiBpdGVtLm5hbWUsIGltYWdlTGluazogaXRlbS5saW5rLCBsaWtlczogaXRlbS5saWtlcywgb3duZXI6IGl0ZW0ub3duZXIuX2lkLCBfaWQ6IGl0ZW0uX2lkLCBjdXJyZW50SWR9LCBcIiNjYXJkLXRlbXBsYXRlXCIsIGhhbmRsZUNhcmRDbGljaywgcG9wdXBDb25maXJtYXRpb24sIHRvZ2dsZUxpa2UpO1xuICAgICAgc2VjdGlvbi5hZGRJdGVtKGVsZW1lbnQpO1xuICAgIH1cbiAgICB9LFxuICAgIFwiLnBsYWNlc1wiXG4gICk7XG4gIHNlY3Rpb24ucmVuZGVySXRlbXMoKTtcblxuICB1c2VySW5mby5zZXRVc2VySW5mbyh7dXNlck5hbWU6IHVzZXIubmFtZSwgdXNlckpvYjogdXNlci5hYm91dCwgdXNlckF2YXRhcjogdXNlci5hdmF0YXJ9KTtcblxuICB9KVxuICAuY2F0Y2goKGVycikgPT4ge1xuICAgIGNvbnNvbGUubG9nKGVycik7IC8vIGxvZyB0aGUgZXJyb3IgdG8gdGhlIGNvbnNvbGVcbiAgfSk7XG5cblxuLy9pbnN0YW50aWF0ZSBwb3B1cCBwbGFjZSBmb3JtXG5jb25zdCBwb3B1cFBsYWNlID0gbmV3IFBvcHVwV2l0aEZvcm0oXCIucG9wdXAtcGxhY2VcIiwgaGFuZGxlUGxhY2VTdWJtaXQpO1xucG9wdXBQbGFjZS5zZXRFdmVudExpc3RlbmVycygpO1xuXG4vL2luc3RhbnRpYXRlIHBvcHVwIHByb2ZpbGUgZm9ybVxuY29uc3QgcG9wdXBQcm9maWxlID0gbmV3IFBvcHVwV2l0aEZvcm0oXCIucG9wdXAtcHJvZmlsZVwiLCBoYW5kbGVQcm9maWxlU3VibWl0KTtcbnBvcHVwUHJvZmlsZS5zZXRFdmVudExpc3RlbmVycygpO1xuXG4vL2luc3RhbnRpYXRlIHBvcHVwIGZvciBwcm9maWxlIHBpY3R1cmVcbmNvbnN0IHBvcHVwUHJvZmlsZVBpY3R1cmUgPSBuZXcgUG9wdXBXaXRoRm9ybShcIi5wb3B1cC1wcm9maWxlLXBpY3R1cmVcIiwgaGFuZGxlUGljdHVyZVN1Ym1pdCk7XG5wb3B1cFByb2ZpbGVQaWN0dXJlLnNldEV2ZW50TGlzdGVuZXJzKCk7XG5cbi8vZW5hYmxlIGZvcm0gdmFsaWRhdGlvblxuY29uc3QgcHJvZmlsZVZhbGlkYXRvciA9IG5ldyBGb3JtVmFsaWRhdG9yKCB2YWxpZGF0aW9uU2V0dGluZ3MsIFwiLnBvcHVwX19mb3JtLXByb2ZpbGVcIik7XG5cbnByb2ZpbGVWYWxpZGF0b3IuZW5hYmxlVmFsaWRhdGlvbigpO1xuXG5jb25zdCBwbGFjZVZhbGlkYXRvciA9IG5ldyBGb3JtVmFsaWRhdG9yKCB2YWxpZGF0aW9uU2V0dGluZ3MsIFwiLnBvcHVwX19mb3JtLXBsYWNlXCIpO1xuXG5wbGFjZVZhbGlkYXRvci5lbmFibGVWYWxpZGF0aW9uKCk7XG5cbmNvbnN0IHBpY3R1cmVWYWxpZGF0b3IgPSBuZXcgRm9ybVZhbGlkYXRvciggdmFsaWRhdGlvblNldHRpbmdzLCBcIi5wb3B1cF9fZm9ybS1wcm9maWxlLXBpY3R1cmVcIik7XG5cbnBpY3R1cmVWYWxpZGF0b3IuZW5hYmxlVmFsaWRhdGlvbigpO1xuXG4vL2FkZCBldmVudCBsaXN0ZW5lciB0byBvcGVuIHRoZSBmb3JtIGZvciBhIG5ldyBwbGFjZSBjYXJkXG5uZXdQbGFjZUJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIG9wZW5QbGFjZUZvcm0pO1xuXG4vL2FkZCBldmVudCBsaXN0ZW5lciB0byBvcGVuIHRoZSBmb3JtIGZvciB0aGUgcHJvZmlsZVxuZWRpdEJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIG9wZW5Qcm9maWxlUG9wdXApO1xuXG4vL2FkZCBldmVudCBsaXN0ZW5lciB0byBvcGVuIHRoZSBmb3JtIHRvIGNoYW5nZSB0aGUgcHJvZmlsZSBwaWN0dXJlXG5wcm9maWxlUGljdHVyZUJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIG9wZW5Qcm9maWxlUGljdHVyZSk7XG5cbi8vZnVuY3Rpb24gdG8gb3BlbiBmb3JtIGZvciBwaWN0dXJlIGNoYW5nZVxuZnVuY3Rpb24gb3BlblByb2ZpbGVQaWN0dXJlICgpIHtcbiAgcGljdHVyZVZhbGlkYXRvci5yZXNldFZhbGlkYXRpb24ocG9wdXBQaWN0dXJlU2VsZWN0b3IpO1xuICBwb3B1cFByb2ZpbGVQaWN0dXJlLm9wZW4oKTtcbn1cblxuLy9mdW5jdGlvbiB0byBvcGVuIHByb2ZpbGVcbmZ1bmN0aW9uIG9wZW5Qcm9maWxlUG9wdXAgKCkge1xuICBwcm9maWxlVmFsaWRhdG9yLnJlc2V0VmFsaWRhdGlvbigpOyAgXG4gIGNvbnN0IHsgdXNlck5hbWUsIHVzZXJKb2IgfSA9IHVzZXJJbmZvLmdldFVzZXJJbmZvKCk7XG4gIG5hbWVJbnB1dC52YWx1ZSA9IHVzZXJOYW1lO1xuICB0aXRsZUlucHV0LnZhbHVlID0gdXNlckpvYjtcbiAgcG9wdXBQcm9maWxlLm9wZW4oKTtcbn1cblxuLy9mdW5jdGlvbiB0byBvcGVuIHBsYWNlIGZvcm1cbmZ1bmN0aW9uIG9wZW5QbGFjZUZvcm0gKCkge1xuICBwbGFjZVZhbGlkYXRvci5yZXNldFZhbGlkYXRpb24ocG9wdXBQbGFjZVNlbGVjdG9yKTtcbiAgcG9wdXBQbGFjZS5vcGVuKCk7XG59XG5cbi8vY3JlYXRlIGhhbmRsZSBzdWJtaXQgZnVuY3Rpb24gZm9yIGNoYW5naW5nIHByb2ZpbGVcbmZ1bmN0aW9uIGhhbmRsZVByb2ZpbGVTdWJtaXQoZGF0YSkge1xuICBwb3B1cFByb2ZpbGUucmVuZGVyTG9hZGluZyh0cnVlKTtcbiAgYXBpLnNldE5ld1VzZXIoZGF0YSkudGhlbihkYXRhID0+IHtcbiAgICB1c2VySW5mby5zZXRVc2VySW5mbyh7IHVzZXJOYW1lOiBkYXRhLm5hbWUsIHVzZXJKb2I6IGRhdGEuYWJvdXQsIHVzZXJBdmF0YXI6IGRhdGEuYXZhdGFyfSk7IFxuICAgIHBvcHVwUHJvZmlsZS5jbG9zZSgpO1xuICB9KVxuICAuY2F0Y2goKGVycikgPT4ge1xuICAgIGNvbnNvbGUubG9nKGVycik7IC8vIGxvZyB0aGUgZXJyb3IgdG8gdGhlIGNvbnNvbGVcbiAgfSlcbiAgLmZpbmFsbHkoKCkgPT4ge1xuICAgIHBvcHVwUHJvZmlsZS5yZW5kZXJMb2FkaW5nKGZhbHNlKTtcbiAgfSk7XG59XG5cbi8vY3JlYXRlIGhhbmRsZSBzdWJtaXQgZnVuY3Rpb24gZm9yIGFkZGluZyBuZXcgcGxhY2VzXG4gZnVuY3Rpb24gaGFuZGxlUGxhY2VTdWJtaXQoZGF0YSl7XG4gIHBvcHVwUGxhY2UucmVuZGVyTG9hZGluZyh0cnVlKTtcbiAgYXBpLmFkZENhcnQoZGF0YSkudGhlbigocmVzdWx0KSA9PiB7XG4gICAgY29uc3QgZWxlbWVudCA9IGNyZWF0ZUNhcmQoe3RleHQ6IHJlc3VsdC5uYW1lLCBpbWFnZUxpbms6IHJlc3VsdC5saW5rLCBsaWtlczogcmVzdWx0Lmxpa2VzLCBvd25lcjogY3VycmVudElkLCBfaWQ6IHJlc3VsdC5faWQsIGN1cnJlbnRJZH0sIFwiI2NhcmQtdGVtcGxhdGVcIiwgaGFuZGxlQ2FyZENsaWNrLCBwb3B1cENvbmZpcm1hdGlvbiwgdG9nZ2xlTGlrZSk7XG4gICAgc2VjdGlvbi5hZGRJdGVtKGVsZW1lbnQpO1xuICAgIHBvcHVwUGxhY2UuY2xvc2UoKTtcbiAgfSlcbiAgLmNhdGNoKChlcnIpID0+IHtcbiAgICBjb25zb2xlLmxvZyhlcnIpOyAvLyBsb2cgdGhlIGVycm9yIHRvIHRoZSBjb25zb2xlXG4gIH0pXG4gIC5maW5hbGx5KCgpID0+IHtcbiAgICBwb3B1cFBsYWNlLnJlbmRlckxvYWRpbmcoZmFsc2UpO1xuICB9KTtcbn1cblxuLy9jcmVhdGUgaGFuZGxlIHN1Ym1pdCBmb3IgbmV3IHByb2ZpbGUgcGljdHVyZVxuZnVuY3Rpb24gaGFuZGxlUGljdHVyZVN1Ym1pdChkYXRhKXtcbiAgcG9wdXBQcm9maWxlUGljdHVyZS5yZW5kZXJMb2FkaW5nKHRydWUpO1xuICBhcGkuY2hhbmdlUGljdHVyZShkYXRhKS50aGVuKChyZXN1bHQpID0+IHtcbiAgICB1c2VySW5mby5zZXRVc2VySW5mbyh7dXNlck5hbWU6IHJlc3VsdC5uYW1lLCB1c2VySm9iOiByZXN1bHQuYWJvdXQsIHVzZXJBdmF0YXI6IHJlc3VsdC5hdmF0YXJ9KTtcbiAgICBwb3B1cFByb2ZpbGVQaWN0dXJlLmNsb3NlKCk7XG4gIH0pXG4gIC5jYXRjaCgoZXJyKSA9PiB7XG4gICAgY29uc29sZS5sb2coZXJyKTsgLy8gbG9nIHRoZSBlcnJvciB0byB0aGUgY29uc29sZVxuICB9KVxuICAuZmluYWxseSgoKSA9PiB7XG4gICAgcG9wdXBQcm9maWxlUGljdHVyZS5yZW5kZXJMb2FkaW5nKGZhbHNlKTtcbiAgfSk7XG59XG5cblxuXG5cblxuXG5cblxuXG4iLCJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIEFwaSB7XG4gICAgY29uc3RydWN0b3IoeyBiYXNlVXJsLCBoZWFkZXJzfSkge1xuICAgICAgICB0aGlzLl9iYXNlVXJsID0gYmFzZVVybDtcbiAgICAgICAgdGhpcy5faGVhZGVycyA9IGhlYWRlcnM7XG4gICAgICAgIHRoaXMuX3NlY3Rpb24gPSBudWxsO1xuICAgICAgfVxuXG4gICAgICBfaGFuZGxlUmVzcG9uc2UocmVzKSB7XG4gICAgICAgIHJldHVybiByZXMub2sgPyByZXMuanNvbigpIDogUHJvbWlzZS5yZWplY3QoYEVycm9yOiAke3Jlcy5zdGF0dXN9YCk7XG4gICAgICB9XG5cbiAgICAgIGluaXRpYWxpemUoKSB7XG4gICAgICAgIHJldHVybiBQcm9taXNlLmFsbChbXG4gICAgICAgICAgdGhpcy5nZXRJbml0aWFsVXNlcigpLFxuICAgICAgICAgIHRoaXMuZ2V0SW5pdGlhbENhcmRzKClcbiAgICAgICAgXSk7XG4gICAgICB9XG4gICAgXG4gICAgICBnZXRJbml0aWFsQ2FyZHMoKSB7XG4gICAgICAgICAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vY2FyZHNgLCB7XG4gICAgICAgICAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnNcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAudGhlbihyZXMgPT4gdGhpcy5faGFuZGxlUmVzcG9uc2UocmVzKSk7IFxuICAgICAgfVxuXG4gICAgICBnZXRJbml0aWFsVXNlcigpIHtcbiAgICAgICAgICAgIHJldHVybiBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfS91c2Vycy9tZWAsIHtcbiAgICAgICAgICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVyc1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC50aGVuKHJlcyA9PiB0aGlzLl9oYW5kbGVSZXNwb25zZShyZXMpKTsgXG4gICAgICB9XG5cblxuICAgICAgYWRkQ2FydCh7dGl0bGUsIGxpbmt9KXtcbiAgICAgICAgcmV0dXJuIGZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L2NhcmRzYCwge1xuICAgICAgICAgIG1ldGhvZDogXCJQT1NUXCIsXG4gICAgICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcbiAgICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgICAgICBuYW1lOiB0aXRsZSxcbiAgICAgICAgICAgIGxpbmtcbiAgICAgICAgICB9KVxuICAgICAgICB9KVxuICAgICAgICAudGhlbihyZXMgPT4gdGhpcy5faGFuZGxlUmVzcG9uc2UocmVzKSk7IFxuICAgICB9XG5cblxuICAgICBkZWxldGVDYXJkKGlkKSB7XG4gICAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vY2FyZHMvJHtpZH1gLCB7XG4gICAgICAgIG1ldGhvZDogXCJERUxFVEVcIixcbiAgICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVyc1xuICAgICAgfSlcbiAgICAgIC50aGVuKHJlcyA9PiB0aGlzLl9oYW5kbGVSZXNwb25zZShyZXMpKTsgXG4gICAgIH1cblxuICAgICB0b2dnbGVMaWtlKGlkLCBpc0xpa2VkKSB7XG4gICAgICAgIHJldHVybiBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfS9jYXJkcy9saWtlcy8ke2lkfWAsIHtcbiAgICAgICAgICBtZXRob2Q6IGlzTGlrZWQgPyBcIkRFTEVURVwiIDogXCJQVVRcIixcbiAgICAgICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzXG4gICAgICAgIH0pXG4gICAgICAgIC50aGVuKHJlcyA9PiB0aGlzLl9oYW5kbGVSZXNwb25zZShyZXMpKTsgXG4gICAgIH1cblxuICAgICBjaGFuZ2VQaWN0dXJlKHthdmF0YXJ9KXtcbiAgICAgIHJldHVybiBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfS91c2Vycy9tZS9hdmF0YXJgLCB7XG4gICAgICAgICAgbWV0aG9kOiBcIlBBVENIXCIsXG4gICAgICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcbiAgICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgICAgICBhdmF0YXJcbiAgICAgICAgICB9KVxuICAgICAgICB9KVxuICAgICAgICAudGhlbihyZXMgPT4gdGhpcy5faGFuZGxlUmVzcG9uc2UocmVzKSk7IFxuICAgICAgfVxuXG4gICAgICBzZXROZXdVc2VyKHt1c2VyTmFtZSwgdXNlckpvYn0pIHsgXG4gICAgICAgIHJldHVybiBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfS91c2Vycy9tZWAsIHtcbiAgICAgICAgICAgIG1ldGhvZDogXCJQQVRDSFwiLFxuICAgICAgICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcbiAgICAgICAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHtcbiAgICAgICAgICAgICAgbmFtZTogdXNlck5hbWUsXG4gICAgICAgICAgICAgIGFib3V0OiB1c2VySm9iXG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC50aGVuKHJlcyA9PiB0aGlzLl9oYW5kbGVSZXNwb25zZShyZXMpKTsgXG4gICAgICB9XG4gICAgXG4gICAgXG5cbn07XG5cblxuXG5cbiIsImltcG9ydCBQb3B1cCBmcm9tIFwiLi9Qb3B1cC5qc1wiO1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBQb3B1cENvbmZpcm1hdGlvbiBleHRlbmRzIFBvcHVwIHtcbiAgICBjb25zdHJ1Y3Rvcihwb3B1cFNlbGVjdG9yLCBoYW5kbGVDbGljaykge1xuICAgICAgICBzdXBlcihwb3B1cFNlbGVjdG9yKTtcbiAgICAgICAgdGhpcy5faGFuZGxlQ2xpY2sgPSBoYW5kbGVDbGljaztcbiAgICAgICAgdGhpcy5fYnV0dG9uID0gdGhpcy5fcG9wdXAucXVlcnlTZWxlY3RvcignLnBvcHVwX19idXR0b24nKTtcbiAgICB9XG4gICAgXG4gICAgb3BlbihjYXJkKSB7XG4gICAgICAgIHN1cGVyLm9wZW4oKTtcbiAgICAgICAgdGhpcy5fY2FyZCA9IGNhcmQ7XG4gICAgfVxuXG4gICAgc2V0RXZlbnRMaXN0ZW5lcnMoKSB7XG4gICAgICAgIHN1cGVyLnNldEV2ZW50TGlzdGVuZXJzKCk7XG4gICAgICAgIHRoaXMuX2J1dHRvbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHtcbiAgICAgICAgICAgIHRoaXMuX2hhbmRsZUNsaWNrKHRoaXMuX2NhcmQpO1xuICAgICAgICB9KTtcbiAgICB9XG5cblxufSIsImltcG9ydCBQb3B1cCBmcm9tIFwiLi9Qb3B1cC5qc1wiO1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBQb3B1cFdpdGhJbWFnZSBleHRlbmRzIFBvcHVwIHtcblxuICAgIGNvbnN0cnVjdG9yKHBvcHVwU2VsZWN0b3IpIHtcbiAgICAgICAgc3VwZXIocG9wdXBTZWxlY3RvcilcbiAgICAgICAgdGhpcy5fcG9wdXBJbWFnZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5wb3B1cC1waWN0dXJlX19pbWFnZScpO1xuICAgICAgICB0aGlzLl9wb3B1cEltYWdlVGl0bGUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcucG9wdXAtcGljdHVyZV9fdGl0bGUnKTtcbiAgICB9XG5cbiAgICBvcGVuKGltYWdlTGluaywgaW1hZ2VOYW1lKXtcbiAgICAgICAgdGhpcy5fcG9wdXBJbWFnZS5zZXRBdHRyaWJ1dGUoJ3NyYycsIGltYWdlTGluayk7XG4gICAgICAgIHRoaXMuX3BvcHVwSW1hZ2Uuc2V0QXR0cmlidXRlKCdhbHQnLCBpbWFnZU5hbWUpOyAgICBcbiAgICAgICAgdGhpcy5fcG9wdXBJbWFnZVRpdGxlLnRleHRDb250ZW50ID0gaW1hZ2VOYW1lO1xuICAgICAgICBzdXBlci5vcGVuKCk7XG4gICAgfSBcblxufSIsImV4cG9ydCBkZWZhdWx0IGNsYXNzIFVzZXJJbmZvIHtcbiAgICBjb25zdHJ1Y3RvciAoe3VzZXJOYW1lU2VsZWN0b3IsIHVzZXJKb2JTZWxlY3RvciwgcGljdHVyZVNlbGVjdG9yfSl7XG4gICAgICAgIHRoaXMuX3Byb2ZpbGVOYW1lID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcih1c2VyTmFtZVNlbGVjdG9yKTtcbiAgICAgICAgdGhpcy5fcHJvZmlsZUZ1bmN0aW9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcih1c2VySm9iU2VsZWN0b3IpO1xuICAgICAgICB0aGlzLl9waWN0dXJlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihwaWN0dXJlU2VsZWN0b3IpO1xuICAgIH1cblxuICAgIGdldFVzZXJJbmZvKCkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgdXNlck5hbWU6IHRoaXMuX3Byb2ZpbGVOYW1lLnRleHRDb250ZW50LFxuICAgICAgICAgICAgdXNlckpvYjogdGhpcy5fcHJvZmlsZUZ1bmN0aW9uLnRleHRDb250ZW50XG4gICAgICAgIH07XG4gICAgfVxuXG4gICAgc2V0VXNlckluZm8oeyB1c2VyTmFtZSwgdXNlckpvYiwgdXNlckF2YXRhciB9KSB7XG4gICAgICAgIHRoaXMuX3Byb2ZpbGVOYW1lLnRleHRDb250ZW50ID0gdXNlck5hbWU7XG4gICAgICAgIHRoaXMuX3Byb2ZpbGVGdW5jdGlvbi50ZXh0Q29udGVudCA9IHVzZXJKb2I7XG4gICAgICAgIHRoaXMuX3BpY3R1cmUuc3JjID0gdXNlckF2YXRhcjtcbiAgICB9XG59OyJdLCJuYW1lcyI6WyJGb3JtVmFsaWRhdG9yIiwiY29uc3RydWN0b3IiLCJzZXR0aW5ncyIsImZvcm0iLCJ0aGlzIiwiX3NldHRpbmdzIiwiX2Zvcm0iLCJkb2N1bWVudCIsInF1ZXJ5U2VsZWN0b3IiLCJfYnV0dG9uRWxlbWVudCIsInN1Ym1pdEJ1dHRvblNlbGVjdG9yIiwiX2lucHV0TGlzdCIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJpbnB1dFNlbGVjdG9yIiwiX2hhc0ludmFsaWRJbnB1dCIsImlucHV0TGlzdCIsInNvbWUiLCJpbnB1dEVsZW1lbnQiLCJ2YWxpZGl0eSIsInZhbGlkIiwiX3Nob3dJbnB1dEVycm9yIiwiZXJyb3JNZXNzYWdlIiwiZXJyb3JFbGVtZW50IiwiaWQiLCJjbGFzc0xpc3QiLCJhZGQiLCJpbnB1dEVycm9yQ2xhc3MiLCJ0ZXh0Q29udGVudCIsImVycm9yQ2xhc3MiLCJfaGlkZUlucHV0RXJyb3IiLCJyZW1vdmUiLCJfdG9nZ2xlQnV0dG9uU3RhdGUiLCJidXR0b25FbGVtZW50IiwiX2Rpc2FibGVCdXR0b24iLCJpbmFjdGl2ZUJ1dHRvbkNsYXNzIiwiZGlzYWJsZWQiLCJfdG9nZ2xlSW5wdXRFcnJvciIsInZhbGlkYXRpb25NZXNzYWdlIiwiX3NldEV2ZW50TGlzdGVuZXJzIiwiYWRkRXZlbnRMaXN0ZW5lciIsImV2dCIsInByZXZlbnREZWZhdWx0IiwicmVzZXRWYWxpZGF0aW9uIiwiZm9yRWFjaCIsImVuYWJsZVZhbGlkYXRpb24iLCJQb3B1cCIsInBvcHVwU2VsZWN0b3IiLCJfcG9wdXAiLCJfaGFuZGxlRXNjQ2xvc2UiLCJiaW5kIiwib3BlbiIsImNsb3NlIiwicmVtb3ZlRXZlbnRMaXN0ZW5lciIsImtleSIsInNldEV2ZW50TGlzdGVuZXJzIiwidGFyZ2V0IiwiY29udGFpbnMiLCJQb3B1cFdpdGhGb3JtIiwiaGFuZGxlRm9ybVN1Ym1pdCIsInN1cGVyIiwiX2hhbmRsZUZvcm1TdWJtaXQiLCJfc3VibWl0QnV0dG9uIiwiX3N1Ym1pdEJ1dHRvblRleHQiLCJyZW5kZXJMb2FkaW5nIiwiaXNMb2FkaW5nIiwibG9hZGluZ1RleHQiLCJfZ2V0SW5wdXRWYWx1ZXMiLCJfZm9ybVZhbHVlcyIsImlucHV0IiwibmFtZSIsInZhbHVlIiwicmVzZXQiLCJDYXJkIiwiZGF0YSIsImNhcmRTZWxlY3RvciIsImhhbmRsZUNhcmRDbGljayIsInBvcHVwQ29uZmlybWF0aW9uIiwidG9nZ2xlTGlrZSIsIl90ZXh0IiwidGV4dCIsIl9pbWFnZUxpbmsiLCJpbWFnZUxpbmsiLCJfbGlrZXMiLCJsaWtlcyIsIl9jYXJkU2VsZWN0b3IiLCJfaGFuZGxlQ2FyZENsaWNrIiwiX3BvcHVwQ29uZmlybWF0aW9uIiwiX293bmVySWQiLCJvd25lciIsIl9pZCIsIl91c2VySWQiLCJjdXJyZW50SWQiLCJfdG9nZ2xlTGlrZSIsIl9nZXRUZW1wbGF0ZSIsImNvbnRlbnQiLCJjbG9uZU5vZGUiLCJyZW1vdmVDYXJkIiwiX2VsZW1lbnQiLCJfaGVhcnRJY29uIiwiX3RyYXNoSWNvbiIsIl9waWN0dXJlRWxlbWVudCIsImxpbmsiLCJnZW5lcmF0ZUNhcmQiLCJfbGlrZUNvdW50ZXIiLCJpdGVtIiwic3JjIiwiYWx0IiwibGVuZ3RoIiwiU2VjdGlvbiIsImNvbnRhaW5lclNlbGVjdG9yIiwiaXRlbXMiLCJyZW5kZXJlciIsIl9pdGVtcyIsIl9yZW5kZXJlciIsIl9jb250YWluZXIiLCJyZW5kZXJJdGVtcyIsImFkZEl0ZW0iLCJlbGVtZW50IiwicHJlcGVuZCIsImVkaXRCdXR0b24iLCJuZXdQbGFjZUJ1dHRvbiIsIm5hbWVJbnB1dCIsInRpdGxlSW5wdXQiLCJwb3B1cFBsYWNlU2VsZWN0b3IiLCJwb3B1cFBpY3R1cmVTZWxlY3RvciIsInByb2ZpbGVQaWN0dXJlQnV0dG9uIiwidmFsaWRhdGlvblNldHRpbmdzIiwic2VjdGlvbiIsImFwaSIsImJhc2VVcmwiLCJoZWFkZXJzIiwiX2Jhc2VVcmwiLCJfaGVhZGVycyIsIl9zZWN0aW9uIiwiX2hhbmRsZVJlc3BvbnNlIiwicmVzIiwib2siLCJqc29uIiwiUHJvbWlzZSIsInJlamVjdCIsInN0YXR1cyIsImluaXRpYWxpemUiLCJhbGwiLCJnZXRJbml0aWFsVXNlciIsImdldEluaXRpYWxDYXJkcyIsImZldGNoIiwidGhlbiIsImFkZENhcnQiLCJ0aXRsZSIsIm1ldGhvZCIsImJvZHkiLCJKU09OIiwic3RyaW5naWZ5IiwiZGVsZXRlQ2FyZCIsImlzTGlrZWQiLCJjaGFuZ2VQaWN0dXJlIiwiYXZhdGFyIiwic2V0TmV3VXNlciIsInVzZXJOYW1lIiwidXNlckpvYiIsImFib3V0IiwiYXV0aG9yaXphdGlvbiIsImhhbmRsZUNsaWNrIiwiX2hhbmRsZUNsaWNrIiwiX2J1dHRvbiIsImNhcmQiLCJfY2FyZCIsImNhdGNoIiwiZXJyIiwiY29uc29sZSIsImxvZyIsInRvZ2dsZSIsInJlc3VsdCIsInBvcHVwSW1hZ2UiLCJfcG9wdXBJbWFnZSIsIl9wb3B1cEltYWdlVGl0bGUiLCJpbWFnZU5hbWUiLCJzZXRBdHRyaWJ1dGUiLCJ1c2VySW5mbyIsInVzZXJOYW1lU2VsZWN0b3IiLCJ1c2VySm9iU2VsZWN0b3IiLCJwaWN0dXJlU2VsZWN0b3IiLCJfcHJvZmlsZU5hbWUiLCJfcHJvZmlsZUZ1bmN0aW9uIiwiX3BpY3R1cmUiLCJnZXRVc2VySW5mbyIsInNldFVzZXJJbmZvIiwidXNlckF2YXRhciIsImNyZWF0ZUNhcmQiLCJ0ZW1wbGF0ZSIsImNhbGxiYWNrIiwidXNlciIsInBvcHVwUGxhY2UiLCJmaW5hbGx5IiwicG9wdXBQcm9maWxlIiwicG9wdXBQcm9maWxlUGljdHVyZSIsInByb2ZpbGVWYWxpZGF0b3IiLCJwbGFjZVZhbGlkYXRvciIsInBpY3R1cmVWYWxpZGF0b3IiXSwic291cmNlUm9vdCI6IiJ9