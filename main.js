!function(){"use strict";class e{constructor(e,t){this._settings=e,this._form=document.querySelector(t),this._buttonElement=document.querySelector(t).querySelector(this._settings.submitButtonSelector),this._inputList=[...document.querySelector(t).querySelectorAll(this._settings.inputSelector)]}_hasInvalidInput(e){return e.some((e=>!e.validity.valid))}_showInputError(e,t,s){const r=e.querySelector(".".concat(t.id,"-error"));t.classList.add(this._settings.inputErrorClass),r.textContent=s,r.classList.add(this._settings.errorClass)}_hideInputError(e,t){const s=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(this._settings.inputErrorClass),s.classList.remove(this._settings.errorClass),s.textContent=""}_toggleButtonState(e,t){this._hasInvalidInput(e)?this._disableButton(t):(t.classList.remove(this._settings.inactiveButtonClass),t.disabled=!1)}_disableButton(e){e.classList.add(this._settings.inactiveButtonClass),e.disabled=!0}_toggleInputError(e,t){t.validity.valid?this._hideInputError(e,t):this._showInputError(e,t,t.validationMessage)}_setEventListeners(){this._form.addEventListener("submit",(e=>{e.preventDefault()})),this._form.addEventListener("reset",(()=>{this._disableButton(this._buttonElement),this.resetValidation()})),this._inputList.forEach((e=>{e.addEventListener("input",(()=>{this._toggleInputError(this._form,e),this._toggleButtonState(this._inputList,this._buttonElement)}))}))}resetValidation(){this._inputList.forEach((e=>{this._hideInputError(this._form,e)}))}enableValidation(){this._setEventListeners(this._form)}}class t{constructor(e){this._popup=document.querySelector(e),this._handleEscClose=this._handleEscClose.bind(this)}open(){this._popup.classList.add("popup_opened"),document.addEventListener("keydown",this._handleEscClose)}close(){this._popup.classList.remove("popup_opened"),document.removeEventListener("keydown",this._handleEscClose)}_handleEscClose(e){"Escape"===e.key&&this.close()}setEventListeners(){this._popup.querySelector(".popup__close").addEventListener("click",(()=>{this.close()})),this._popup.addEventListener("click",(e=>{e.target.classList.contains("popup")&&this.close()}))}}class s extends t{constructor(e,t){super(e),this._handleFormSubmit=t,this._inputList=this._popup.querySelectorAll(".popup__input"),this._form=this._popup.querySelector(".popup__form"),this._submitButton=this._popup.querySelector(".popup__button"),this._submitButtonText=this._submitButton.textContent}renderLoading(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Saving...";this._submitButton.textContent=e?t:this._submitButtonText}_getInputValues(){return this._formValues={},this._inputList.forEach((e=>{this._formValues[e.name]=e.value})),this._formValues}close(){super.close(),this._form.reset()}setEventListeners(){super.setEventListeners(),this._form.addEventListener("submit",(e=>{e.preventDefault(),this._handleFormSubmit(this._getInputValues())}))}}class r{constructor(e,t,s,r,n){this._text=e.text,this._imageLink=e.imageLink,this._likes=e.likes,this._cardSelector=t,this._handleCardClick=s,this._popupConfirmation=r,this._ownerId=e.owner,this.id=e._id,this._userId=e.currentId,this._toggleLike=n}_getTemplate(){return document.querySelector(this._cardSelector).content.querySelector(".places__card").cloneNode(!0)}removeCard(){this._element.remove(),this._element=null}_setEventListeners(){this._element.querySelector(".places__card-button").addEventListener("click",(()=>{this._toggleLike()})),this._element.querySelector(".places__card-delete-icon")&&this._element.querySelector(".places__card-delete-icon").addEventListener("click",(()=>{this._popupConfirmation.open(this)})),this._element.querySelector(".places__card-image").addEventListener("click",(e=>{this._handleCardClick({link:this._imageLink,text:this._text})}))}generateCard(){return this._element=this._getTemplate(),this._heartIcon=this._element.querySelector(".places__card-button"),this._likes.some((e=>e._id===this._userId))&&this._heartIcon.classList.add("places__card-button-liked"),this._ownerId!==this._userId&&this._element.querySelector(".places__card-delete-icon").remove(),this._setEventListeners(),this._element.querySelector(".places__card-image").src=this._imageLink,this._element.querySelector(".places__card-image").alt=this._text,this._element.querySelector(".places__card-title").textContent=this._text,this._element.querySelector(".places__likes-counter").textContent=this._likes.length,this._element}}class n{constructor(e,t){let{items:s,renderer:r}=e;this._items=s,this._renderer=r,this._container=document.querySelector(t)}renderItems(){this._items.forEach((e=>{this._renderer(e)}))}addItem(e){this._container.prepend(e)}}const i=document.querySelector(".profile__button-name-change"),o=document.querySelector(".profile__button-add-place"),a=document.querySelector("[name='userName']"),c=document.querySelector("[name='userJob']"),l=(document.querySelector(".popup-profile"),document.querySelector(".popup-place")),u=document.querySelector(".popup-profile-picture"),p=(document.querySelector(".popup__form-profile"),document.querySelector(".popup__form-place"),document.querySelector(".popup__form-profile-picture"),document.querySelector(".profile__picture"),document.querySelector(".profile__picture-container")),_=(document.querySelector(".popup__button-profile"),document.querySelector(".popup__button-place"),document.querySelector(".popup__button-picture"),{inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"});let h,d;const m=new class{constructor(e){let{baseUrl:t,headers:s}=e;this._baseUrl=t,this._headers=s,this._section=null}_handleResponse(e){return e.ok?e.json():Promise.reject("Error: ".concat(e.status))}initialize(){return Promise.all([this.getInitialUser(),this.getInitialCards()])}getInitialCards(){return fetch("".concat(this._baseUrl,"/cards"),{headers:this._headers}).then((e=>this._handleResponse(e)))}getInitialUser(){return fetch("".concat(this._baseUrl,"/users/me"),{headers:this._headers}).then((e=>this._handleResponse(e)))}addCart(e){let{title:t,link:s}=e;return fetch("".concat(this._baseUrl,"/cards"),{method:"POST",headers:this._headers,body:JSON.stringify({name:t,link:s})}).then((e=>this._handleResponse(e)))}deleteCard(e){return fetch("".concat(this._baseUrl,"/cards/").concat(e),{method:"DELETE",headers:this._headers}).then((e=>this._handleResponse(e)))}toggleLike(e,t){return fetch("".concat(this._baseUrl,"/cards/likes/").concat(e),{method:t?"DELETE":"PUT",headers:this._headers}).then((e=>this._handleResponse(e)))}changePicture(e){let{avatar:t}=e;return fetch("".concat(this._baseUrl,"/users/me/avatar"),{method:"PATCH",headers:this._headers,body:JSON.stringify({avatar:t})}).then((e=>this._handleResponse(e)))}setNewUser(e){let{userName:t,userJob:s}=e;return fetch("".concat(this._baseUrl,"/users/me"),{method:"PATCH",headers:this._headers,body:JSON.stringify({name:t,about:s})}).then((e=>this._handleResponse(e)))}}({baseUrl:"https://around.nomoreparties.co/v1/group-12",headers:{authorization:"5ad7ef92-ff2d-4fbe-9e41-f5034926c435","Content-Type":"application/json"}}),f=new class extends t{constructor(e,t){super(e),this._handleClick=t,this._button=this._popup.querySelector(".popup__button")}open(e){super.open(),this._card=e}setEventListeners(){super.setEventListeners(),this._button.addEventListener("click",(()=>{this._handleClick(this._card)}))}}(".popup-confirm",(function(e){m.deleteCard(e.id).then((t=>{f.close(),e.removeCard()})).catch((e=>{console.log(e)}))}));function g(){let e=this._element.querySelector(".places__card-button").classList.contains("places__card-button-liked");this._heartIcon.classList.toggle("places__card-button-liked"),m.toggleLike(this.id,e).then((e=>{this._element.querySelector(".places__likes-counter").innerHTML=e.likes.length})).catch((e=>{console.log(e)}))}f.setEventListeners();const b=new class extends t{constructor(e){super(e),this._popupImage=document.querySelector(".popup-picture__image"),this._popupImageTitle=document.querySelector(".popup-picture__title")}open(e,t){this._popupImage.setAttribute("src",e),this._popupImage.setAttribute("alt",t),this._popupImageTitle.textContent=t,super.open()}}(".popup-picture");b.setEventListeners();const v=new class{constructor(e){let{userNameSelector:t,userJobSelector:s,userAvatar:r}=e;this._profileName=document.querySelector(t),this._profileFunction=document.querySelector(s),this._picture=document.querySelector(".profile__picture")}getUserInfo(){return{userName:this._profileName.textContent,userJob:this._profileFunction.textContent}}setUserInfo(e){let{userName:t,userJob:s,userAvatar:r}=e;this._profileName.textContent=t,this._profileFunction.textContent=s,this._picture.src=r}}({userNameSelector:".profile__name",userJobSelector:".profile__function"});function L(e,t,s,n,i){return new r(e,t,s,n,i).generateCard()}function S(e){let{link:t,text:s}=e;b.open(t,s)}m.initialize().then((e=>{const[t,s]=e;h=new n({items:s,renderer:e=>{d=t._id;const s=L({text:e.name,imageLink:e.link,likes:e.likes,owner:e.owner._id,_id:e._id,currentId:d},"#card-template",S,f,g);h.addItem(s)}},".places"),h.renderItems(),v.setUserInfo({userName:t.name,userJob:t.about,userAvatar:t.avatar})})).catch((e=>{console.log(e)}));const y=new s(".popup-place",(function(e){y.renderLoading(!0),m.addCart(e).then((e=>{const t=L({text:e.name,imageLink:e.link,likes:e.likes,owner:d,_id:e._id,currentId:d},"#card-template",S,f,g);h.addItem(t),y.close()})).catch((e=>{console.log(e)})).finally((()=>{y.renderLoading(!1)}))}));y.setEventListeners();const E=new s(".popup-profile",(function(e){E.renderLoading(!0),m.setNewUser(e).then((e=>{v.setUserInfo({userName:e.name,userJob:e.about,userAvatar:e.avatar}),E.close()})).catch((e=>{console.log(e)})).finally((()=>{E.renderLoading(!1)}))}));E.setEventListeners();const k=new s(".popup-profile-picture",(function(e){k.renderLoading(!0),m.changePicture(e).then((e=>{v.setUserInfo({userName:e.name,userJob:e.about,userAvatar:e.avatar}),k.close()})).catch((e=>{console.log(e)})).finally((()=>{k.renderLoading(!1)}))}));k.setEventListeners();const q=new e(_,".popup__form-profile");q.enableValidation();const C=new e(_,".popup__form-place");C.enableValidation();const I=new e(_,".popup__form-profile-picture");I.enableValidation(),o.addEventListener("click",(function(){C.resetValidation(l),y.open()})),i.addEventListener("click",(function(){q.resetValidation();const{userName:e,userJob:t}=v.getUserInfo();a.value=e,c.value=t,E.open()})),p.addEventListener("click",(function(){I.resetValidation(u),k.open()}))}();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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ZndFLEVBQXFCbkYsaUJBQWlCLFNBR3RDLFdBQ0U0SixFQUFpQnpKLGdCQUFnQitFLEdBQ2pDdUUsRUFBb0I5SSxVIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vd2ViX3Byb2plY3RfNC8uL3NyYy9jb21wb25lbnRzL0Zvcm1WYWxpZGF0b3IuanMiLCJ3ZWJwYWNrOi8vd2ViX3Byb2plY3RfNC8uL3NyYy9jb21wb25lbnRzL1BvcHVwLmpzIiwid2VicGFjazovL3dlYl9wcm9qZWN0XzQvLi9zcmMvY29tcG9uZW50cy9Qb3B1cFdpdGhGb3JtLmpzIiwid2VicGFjazovL3dlYl9wcm9qZWN0XzQvLi9zcmMvY29tcG9uZW50cy9DYXJkLmpzIiwid2VicGFjazovL3dlYl9wcm9qZWN0XzQvLi9zcmMvY29tcG9uZW50cy9TZWN0aW9uLmpzIiwid2VicGFjazovL3dlYl9wcm9qZWN0XzQvLi9zcmMvdXRpbHMvY29uc3RhbnRzLmpzIiwid2VicGFjazovL3dlYl9wcm9qZWN0XzQvLi9zcmMvcGFnZXMvaW5kZXguanMiLCJ3ZWJwYWNrOi8vd2ViX3Byb2plY3RfNC8uL3NyYy9jb21wb25lbnRzL0FwaS5qcyIsIndlYnBhY2s6Ly93ZWJfcHJvamVjdF80Ly4vc3JjL2NvbXBvbmVudHMvUG9wdXBDb25maXJtYXRpb24uanMiLCJ3ZWJwYWNrOi8vd2ViX3Byb2plY3RfNC8uL3NyYy9jb21wb25lbnRzL1BvcHVwV2l0aEltYWdlLmpzIiwid2VicGFjazovL3dlYl9wcm9qZWN0XzQvLi9zcmMvY29tcG9uZW50cy9Vc2VySW5mby5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIEZvcm1WYWxpZGF0b3Ige1xuICAgIGNvbnN0cnVjdG9yKHNldHRpbmdzLCBmb3JtKSB7XG4gICAgICAgIHRoaXMuX3NldHRpbmdzID0gc2V0dGluZ3M7XG4gICAgICAgIHRoaXMuX2Zvcm0gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGZvcm0pO1xuICAgICAgICB0aGlzLl9idXR0b25FbGVtZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcihmb3JtKS5xdWVyeVNlbGVjdG9yKHRoaXMuX3NldHRpbmdzLnN1Ym1pdEJ1dHRvblNlbGVjdG9yKTtcbiAgICAgICAgdGhpcy5faW5wdXRMaXN0ID0gWy4uLmRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoZm9ybSkucXVlcnlTZWxlY3RvckFsbCh0aGlzLl9zZXR0aW5ncy5pbnB1dFNlbGVjdG9yKV07XG4gICAgfVxuICAgIFxuICAgIF9oYXNJbnZhbGlkSW5wdXQgKGlucHV0TGlzdCkge1xuICAgICAgICByZXR1cm4gaW5wdXRMaXN0LnNvbWUoKGlucHV0RWxlbWVudCkgPT4geyBcbiAgICBcbiAgICAgICAgICByZXR1cm4gIWlucHV0RWxlbWVudC52YWxpZGl0eS52YWxpZDsgXG4gICAgXG4gICAgICAgIH0pOyBcbiAgICAgIH1cblxuICAgIF9zaG93SW5wdXRFcnJvciAoZm9ybSwgaW5wdXRFbGVtZW50LCBlcnJvck1lc3NhZ2UgKSB7XG4gICAgICAgIC8vIEZpbmQgdGhlIGVycm9yIG1lc3NhZ2UgZWxlbWVudCBpbnNpZGUgdGhlIHZlcnkgZnVuY3Rpb25cbiAgICAgICAgY29uc3QgZXJyb3JFbGVtZW50ID0gZm9ybS5xdWVyeVNlbGVjdG9yKGAuJHtpbnB1dEVsZW1lbnQuaWR9LWVycm9yYCk7XG4gICAgICAgIC8vIFRoZSByZXN0IHJlbWFpbnMgdW5jaGFuZ2VkXG4gICAgICAgIGlucHV0RWxlbWVudC5jbGFzc0xpc3QuYWRkKHRoaXMuX3NldHRpbmdzLmlucHV0RXJyb3JDbGFzcyk7XG4gICAgICAgIGVycm9yRWxlbWVudC50ZXh0Q29udGVudCA9IGVycm9yTWVzc2FnZTtcbiAgICAgICAgZXJyb3JFbGVtZW50LmNsYXNzTGlzdC5hZGQodGhpcy5fc2V0dGluZ3MuZXJyb3JDbGFzcyk7XG4gICAgICB9XG4gICAgICBcbiAgICBfaGlkZUlucHV0RXJyb3IgKGZvcm0sIGlucHV0RWxlbWVudCApIHtcbiAgICAgICAgLy8gRmluZCB0aGUgZXJyb3IgbWVzc2FnZSBlbGVtZW50XG4gICAgICAgIGNvbnN0IGVycm9yRWxlbWVudCA9IGZvcm0ucXVlcnlTZWxlY3RvcihgLiR7aW5wdXRFbGVtZW50LmlkfS1lcnJvcmApO1xuICAgICAgICAvLyBUaGUgcmVzdCByZW1haW5zIHVuY2hhbmdlZFxuICAgICAgICBpbnB1dEVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZSh0aGlzLl9zZXR0aW5ncy5pbnB1dEVycm9yQ2xhc3MpO1xuICAgICAgICBlcnJvckVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZSh0aGlzLl9zZXR0aW5ncy5lcnJvckNsYXNzKTtcbiAgICAgICAgZXJyb3JFbGVtZW50LnRleHRDb250ZW50ID0gXCJcIjtcbiAgICAgIH1cblxuICAgIF90b2dnbGVCdXR0b25TdGF0ZSAoaW5wdXRMaXN0LCBidXR0b25FbGVtZW50KSB7XG4gICAgICAgIGlmICh0aGlzLl9oYXNJbnZhbGlkSW5wdXQoaW5wdXRMaXN0KSkge1xuICAgICAgICAgIHRoaXMuX2Rpc2FibGVCdXR0b24oYnV0dG9uRWxlbWVudCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgYnV0dG9uRWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKHRoaXMuX3NldHRpbmdzLmluYWN0aXZlQnV0dG9uQ2xhc3MpO1xuICAgICAgICAgIGJ1dHRvbkVsZW1lbnQuZGlzYWJsZWQgPSBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIFxuICAgICAgX2Rpc2FibGVCdXR0b24oYnV0dG9uRWxlbWVudCkge1xuICAgICAgICBidXR0b25FbGVtZW50LmNsYXNzTGlzdC5hZGQodGhpcy5fc2V0dGluZ3MuaW5hY3RpdmVCdXR0b25DbGFzcyk7XG4gICAgICAgIGJ1dHRvbkVsZW1lbnQuZGlzYWJsZWQgPSB0cnVlO1xuICAgICAgfVxuICAgIFxuICAgIF90b2dnbGVJbnB1dEVycm9yIChmb3JtLCBpbnB1dEVsZW1lbnQpIHtcbiAgICAgICAgaWYgKCFpbnB1dEVsZW1lbnQudmFsaWRpdHkudmFsaWQpIHtcbiAgICAgICAgICAvLyBUaGUgcGFyYW1ldGVyIG9mIHNob3dJbnB1dEVycm9yKCkgaXMgbm93IGEgZm9ybSxcbiAgICAgICAgICAvLyB3aGljaCBjb250YWlucyBhIGZpZWxkIHRvIGJlIGNoZWNrZWRcbiAgICAgICAgICB0aGlzLl9zaG93SW5wdXRFcnJvcihmb3JtLCBpbnB1dEVsZW1lbnQsIGlucHV0RWxlbWVudC52YWxpZGF0aW9uTWVzc2FnZSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgLy8gVGhlIHNhbWUgZm9yIGhpZGVJbnB1dEVycm9yKCksIEl0cyBwYXJhbWV0ZXIgaXMgbm93IGEgZm9ybSxcbiAgICAgICAgICAvLyB3aGljaCBjb250YWlucyBhIGZpZWxkIHRvIGJlIGNoZWNrZWRcbiAgICAgICAgICB0aGlzLl9oaWRlSW5wdXRFcnJvcihmb3JtLCBpbnB1dEVsZW1lbnQpO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgIF9zZXRFdmVudExpc3RlbmVycygpIHtcbiAgICB0aGlzLl9mb3JtLmFkZEV2ZW50TGlzdGVuZXIoXCJzdWJtaXRcIiwgKGV2dCkgPT4ge1xuICAgICAgICAvLyBDYW5jZWwgZGVmYXVsdCBiZWhhdmlvciBmb3IgdGhlIGZvcm1cbiAgICAgICAgZXZ0LnByZXZlbnREZWZhdWx0KCk7XG4gICAgfSk7XG5cbiAgICB0aGlzLl9mb3JtLmFkZEV2ZW50TGlzdGVuZXIoXCJyZXNldFwiLCAoKSA9PiB7IFxuICAgICAgdGhpcy5fZGlzYWJsZUJ1dHRvbih0aGlzLl9idXR0b25FbGVtZW50KTsgXG4gICAgICB0aGlzLnJlc2V0VmFsaWRhdGlvbigpO1xuICAgIH0pOyBcbiAgXG4gICAgLy8gSXRlcmF0ZSBvdmVyIHRoZSByZXN1bHRpbmcgYXJyYXlcbiAgICB0aGlzLl9pbnB1dExpc3QuZm9yRWFjaCgoaW5wdXRFbGVtZW50KSA9PiB7XG4gICAgICAvLyBhZGQgdGhlIGlucHV0IGV2ZW50IGhhbmRsZXIgdG8gZWFjaCBmaWVsZFxuICAgICAgaW5wdXRFbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJpbnB1dFwiLCAoKSA9PiB7XG4gICAgICAgIC8vIENhbGwgdGhlIHRvZ2dsZUlucHV0RXJyb3IoKSBmdW5jdGlvbiBpbnNpZGUgdGhlIGNhbGxiYWNrLFxuICAgICAgICAvLyBhbmQgcGFzcyB0aGUgZm9ybSBhbmQgdGhlIGVsZW1lbnQgdG8gYmUgY2hlY2tlZCB0byBpdFxuICAgICAgICB0aGlzLl90b2dnbGVJbnB1dEVycm9yKHRoaXMuX2Zvcm0sIGlucHV0RWxlbWVudCk7XG4gICAgICAgIHRoaXMuX3RvZ2dsZUJ1dHRvblN0YXRlKHRoaXMuX2lucHV0TGlzdCwgdGhpcy5fYnV0dG9uRWxlbWVudCk7XG4gICAgICB9KTtcbiAgICB9KTtcblxuICB9XG5cbiAgcmVzZXRWYWxpZGF0aW9uICgpeyBcbiAgIFxuXG4gICAgdGhpcy5faW5wdXRMaXN0LmZvckVhY2goKGlucHV0RWxlbWVudCkgPT4geyBcblxuICAgICAgICB0aGlzLl9oaWRlSW5wdXRFcnJvcih0aGlzLl9mb3JtLCBpbnB1dEVsZW1lbnQpOyBcblxuICAgIH0pOyBcblxuICB9OyBcblxuICAgZW5hYmxlVmFsaWRhdGlvbigpIHtcblxuICAgICAgICB0aGlzLl9zZXRFdmVudExpc3RlbmVycyh0aGlzLl9mb3JtKTtcbiAgfVxufSIsImV4cG9ydCBkZWZhdWx0IGNsYXNzIFBvcHVwIHtcbiAgICBjb25zdHJ1Y3Rvcihwb3B1cFNlbGVjdG9yKXtcbiAgICAgICAgdGhpcy5fcG9wdXAgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKHBvcHVwU2VsZWN0b3IpO1xuICAgICAgICB0aGlzLl9oYW5kbGVFc2NDbG9zZSA9IHRoaXMuX2hhbmRsZUVzY0Nsb3NlLmJpbmQodGhpcyk7XG4gICAgfVxuXG4gICAgb3BlbigpIHtcbiAgICAgICAgdGhpcy5fcG9wdXAuY2xhc3NMaXN0LmFkZCgncG9wdXBfb3BlbmVkJyk7XG4gICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJrZXlkb3duXCIsIHRoaXMuX2hhbmRsZUVzY0Nsb3NlKTtcbiAgICB9XG5cbiAgICBjbG9zZSgpIHtcbiAgICAgICAgdGhpcy5fcG9wdXAuY2xhc3NMaXN0LnJlbW92ZSgncG9wdXBfb3BlbmVkJyk7XG4gICAgICAgIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2tleWRvd24nLCB0aGlzLl9oYW5kbGVFc2NDbG9zZSk7XG4gICAgfVxuXG4gICAgX2hhbmRsZUVzY0Nsb3NlKGV2dCl7XG4gICAgICAgIGlmIChldnQua2V5ID09PVwiRXNjYXBlXCIpIHtcbiAgICAgICAgICAgIHRoaXMuY2xvc2UoKTtcbiAgICAgICAgICB9XG4gICAgfVxuICAgIFxuICAgIHNldEV2ZW50TGlzdGVuZXJzKCkge1xuICAgICAgICB0aGlzLl9wb3B1cC5xdWVyeVNlbGVjdG9yKCcucG9wdXBfX2Nsb3NlJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7XG4gICAgICAgICAgICB0aGlzLmNsb3NlKCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHRoaXMuX3BvcHVwLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoZXZ0KSA9PiB7XG4gICAgICAgICAgICBpZiAoZXZ0LnRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoJ3BvcHVwJykpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmNsb3NlKCk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICB9XG5cbn0iLCJpbXBvcnQgUG9wdXAgZnJvbSBcIi4vUG9wdXAuanNcIjtcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgUG9wdXBXaXRoRm9ybSBleHRlbmRzIFBvcHVwIHtcbiAgICBjb25zdHJ1Y3Rvcihwb3B1cFNlbGVjdG9yLCBoYW5kbGVGb3JtU3VibWl0KSB7XG4gICAgICAgIHN1cGVyKHBvcHVwU2VsZWN0b3IpO1xuICAgICAgICB0aGlzLl9oYW5kbGVGb3JtU3VibWl0ID0gaGFuZGxlRm9ybVN1Ym1pdDtcbiAgICAgICAgdGhpcy5faW5wdXRMaXN0ID0gdGhpcy5fcG9wdXAucXVlcnlTZWxlY3RvckFsbChcIi5wb3B1cF9faW5wdXRcIik7XG4gICAgICAgIHRoaXMuX2Zvcm0gPSB0aGlzLl9wb3B1cC5xdWVyeVNlbGVjdG9yKCcucG9wdXBfX2Zvcm0nKTtcbiAgICAgICAgdGhpcy5fc3VibWl0QnV0dG9uID0gdGhpcy5fcG9wdXAucXVlcnlTZWxlY3RvcignLnBvcHVwX19idXR0b24nKTtcbiAgICAgICAgdGhpcy5fc3VibWl0QnV0dG9uVGV4dCA9IHRoaXMuX3N1Ym1pdEJ1dHRvbi50ZXh0Q29udGVudDtcbiAgICB9XG5cbiAgICByZW5kZXJMb2FkaW5nKGlzTG9hZGluZywgbG9hZGluZ1RleHQ9J1NhdmluZy4uLicpIHtcbiAgICAgICAgaWYgKGlzTG9hZGluZykge1xuICAgICAgICAgIHRoaXMuX3N1Ym1pdEJ1dHRvbi50ZXh0Q29udGVudCA9IGxvYWRpbmdUZXh0O1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHRoaXMuX3N1Ym1pdEJ1dHRvbi50ZXh0Q29udGVudCA9IHRoaXMuX3N1Ym1pdEJ1dHRvblRleHQ7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBfZ2V0SW5wdXRWYWx1ZXMoKSB7XG4gICAgICAgIFxuXG4gICAgICAgIC8vIENyZWF0ZSBhbiBlbXB0eSBvYmplY3RcbiAgICAgICAgdGhpcy5fZm9ybVZhbHVlcyA9IHt9O1xuXG4gICAgICAgIC8vIEFkZCB0aGUgdmFsdWVzIG9mIHRoZSBmaWVsZHMgdG8gdGhpcyBvYmplY3RcbiAgICAgICAgdGhpcy5faW5wdXRMaXN0LmZvckVhY2goaW5wdXQgPT4ge1xuICAgICAgICAgICAgdGhpcy5fZm9ybVZhbHVlc1tpbnB1dC5uYW1lXSA9IGlucHV0LnZhbHVlO1xuICAgICAgICB9KTtcblxuICAgICAgICAvLyBSZXR1cm4gdGhlIHZhbHVlcyBvYmplY3RcbiAgICAgICAgcmV0dXJuIHRoaXMuX2Zvcm1WYWx1ZXM7XG4gICAgfSBcblxuICAgIGNsb3NlKCkge1xuICAgICAgICBzdXBlci5jbG9zZSgpO1xuICAgICAgICB0aGlzLl9mb3JtLnJlc2V0KCk7XG4gICAgfVxuXG5cbiAgICBzZXRFdmVudExpc3RlbmVycygpIHtcblxuICAgICAgICBzdXBlci5zZXRFdmVudExpc3RlbmVycygpO1xuICAgICAgICB0aGlzLl9mb3JtLmFkZEV2ZW50TGlzdGVuZXIoJ3N1Ym1pdCcsIChldnQpID0+IHtcbiAgICAgICAgICAgIGV2dC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgdGhpcy5faGFuZGxlRm9ybVN1Ym1pdCh0aGlzLl9nZXRJbnB1dFZhbHVlcygpKTtcbiAgICAgICAgfSk7XG5cbiAgICB9XG4gICAgXG5cbn07IiwiZXhwb3J0IGRlZmF1bHQgY2xhc3MgQ2FyZCB7XG5cbiAgICBjb25zdHJ1Y3RvcihkYXRhLCBjYXJkU2VsZWN0b3IsIGhhbmRsZUNhcmRDbGljaywgcG9wdXBDb25maXJtYXRpb24sIHRvZ2dsZUxpa2UpIHtcbiAgICAgICAgdGhpcy5fdGV4dCA9IGRhdGEudGV4dDtcbiAgICAgICAgdGhpcy5faW1hZ2VMaW5rID0gZGF0YS5pbWFnZUxpbms7XG4gICAgICAgIHRoaXMuX2xpa2VzID0gZGF0YS5saWtlcztcbiAgICAgICAgdGhpcy5fY2FyZFNlbGVjdG9yID0gY2FyZFNlbGVjdG9yO1xuICAgICAgICB0aGlzLl9oYW5kbGVDYXJkQ2xpY2sgPSBoYW5kbGVDYXJkQ2xpY2s7XG4gICAgICAgIHRoaXMuX3BvcHVwQ29uZmlybWF0aW9uID0gcG9wdXBDb25maXJtYXRpb247XG4gICAgICAgIHRoaXMuX293bmVySWQgPSBkYXRhLm93bmVyO1xuICAgICAgICB0aGlzLmlkID0gZGF0YS5faWQ7XG4gICAgICAgIHRoaXMuX3VzZXJJZCA9IGRhdGEuY3VycmVudElkO1xuICAgICAgICB0aGlzLl90b2dnbGVMaWtlID0gdG9nZ2xlTGlrZTtcbiAgICB9XG5cbiAgICBfZ2V0VGVtcGxhdGUoKXtcbiAgICAgICAgY29uc3QgY2FyZEVsZW1lbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKHRoaXMuX2NhcmRTZWxlY3RvcikuY29udGVudC5xdWVyeVNlbGVjdG9yKFwiLnBsYWNlc19fY2FyZFwiKS5jbG9uZU5vZGUodHJ1ZSk7XG5cbiAgICAgICAgcmV0dXJuIGNhcmRFbGVtZW50O1xuICAgIH1cblxuICAgIHJlbW92ZUNhcmQoKXtcbiAgICAgICAgdGhpcy5fZWxlbWVudC5yZW1vdmUoKTtcbiAgICAgICAgdGhpcy5fZWxlbWVudCA9IG51bGw7XG4gICAgfVxuXG5cbiAgICBfc2V0RXZlbnRMaXN0ZW5lcnMoKSB7XG4gICAgICAgIHRoaXMuX2VsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5wbGFjZXNfX2NhcmQtYnV0dG9uXCIpLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgICAgICAgICB0aGlzLl90b2dnbGVMaWtlKCk7XG4gICAgICAgIH0pO1xuICAgICAgICAgIGlmKHRoaXMuX2VsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5wbGFjZXNfX2NhcmQtZGVsZXRlLWljb25cIikpeyBcbiAgICAgICAgICAgIHRoaXMuX2VsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5wbGFjZXNfX2NhcmQtZGVsZXRlLWljb25cIikuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgICAgICAgICAgICAgdGhpcy5fcG9wdXBDb25maXJtYXRpb24ub3Blbih0aGlzKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH1cbiAgICAgICAgICB0aGlzLl9lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucGxhY2VzX19jYXJkLWltYWdlXCIpLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoZXZ0KSA9PiB7XG4gICAgICAgICAgICB0aGlzLl9oYW5kbGVDYXJkQ2xpY2soeyBsaW5rOiB0aGlzLl9pbWFnZUxpbmssIHRleHQ6IHRoaXMuX3RleHQgfSk7IFxuICAgICAgICAgIH0pO1xuICAgIH1cblxuICAgIGdlbmVyYXRlQ2FyZCgpIHtcbiAgICAgICAgdGhpcy5fZWxlbWVudCA9IHRoaXMuX2dldFRlbXBsYXRlKCk7XG4gICAgICAgIHRoaXMuX2hlYXJ0SWNvbiA9IHRoaXMuX2VsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5wbGFjZXNfX2NhcmQtYnV0dG9uXCIpO1xuICAgICAgICBpZih0aGlzLl9saWtlcy5zb21lKGl0ZW0gPT4gaXRlbS5faWQgPT09IHRoaXMuX3VzZXJJZCkpIHtcbiAgICAgICAgICB0aGlzLl9oZWFydEljb24uY2xhc3NMaXN0LmFkZCgncGxhY2VzX19jYXJkLWJ1dHRvbi1saWtlZCcpO1xuICAgICAgICB9XG4gICAgICAgIGlmKHRoaXMuX293bmVySWQgIT09IHRoaXMuX3VzZXJJZCkge1xuICAgICAgICAgIHRoaXMuX2VsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5wbGFjZXNfX2NhcmQtZGVsZXRlLWljb25cIikucmVtb3ZlKCk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5fc2V0RXZlbnRMaXN0ZW5lcnMoKTsgXG4gICAgICAgIHRoaXMuX2VsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5wbGFjZXNfX2NhcmQtaW1hZ2VcIikuc3JjID0gdGhpcy5faW1hZ2VMaW5rO1xuICAgICAgICB0aGlzLl9lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucGxhY2VzX19jYXJkLWltYWdlXCIpLmFsdCA9IHRoaXMuX3RleHQ7XG4gICAgICAgIHRoaXMuX2VsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5wbGFjZXNfX2NhcmQtdGl0bGVcIikudGV4dENvbnRlbnQgPSB0aGlzLl90ZXh0O1xuICAgICAgICB0aGlzLl9lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucGxhY2VzX19saWtlcy1jb3VudGVyXCIpLnRleHRDb250ZW50ID0gdGhpcy5fbGlrZXMubGVuZ3RoO1xuICAgICAgXG4gICAgICAgIHJldHVybiB0aGlzLl9lbGVtZW50O1xuICAgICAgfSBcblxufSIsImV4cG9ydCBkZWZhdWx0IGNsYXNzIFNlY3Rpb24ge1xuICAgIGNvbnN0cnVjdG9yKHtpdGVtcywgcmVuZGVyZXJ9LCBjb250YWluZXJTZWxlY3Rvcikge1xuICAgICAgICB0aGlzLl9pdGVtcyA9IGl0ZW1zO1xuICAgICAgICB0aGlzLl9yZW5kZXJlciA9IHJlbmRlcmVyO1xuICAgICAgICB0aGlzLl9jb250YWluZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGNvbnRhaW5lclNlbGVjdG9yKTtcbiAgICB9XG5cbiAgICByZW5kZXJJdGVtcygpIHtcbiAgICAgICAgdGhpcy5faXRlbXMuZm9yRWFjaChpdGVtID0+IHtcbiAgICAgICAgICB0aGlzLl9yZW5kZXJlcihpdGVtKTsgXG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIGFkZEl0ZW0oZWxlbWVudCkge1xuICAgICAgICB0aGlzLl9jb250YWluZXIucHJlcGVuZChlbGVtZW50KTtcbiAgICAgIH1cblxufSIsImV4cG9ydCBjb25zdCBlZGl0QnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnByb2ZpbGVfX2J1dHRvbi1uYW1lLWNoYW5nZScpO1xuZXhwb3J0IGNvbnN0IG5ld1BsYWNlQnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnByb2ZpbGVfX2J1dHRvbi1hZGQtcGxhY2UnKTtcbmV4cG9ydCBjb25zdCBuYW1lSW5wdXQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiW25hbWU9J3VzZXJOYW1lJ11cIik7IFxuZXhwb3J0IGNvbnN0IHRpdGxlSW5wdXQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiW25hbWU9J3VzZXJKb2InXVwiKTsgXG5leHBvcnQgY29uc3QgcG9wdXBQcm9maWxlU2VsZWN0b3IgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcucG9wdXAtcHJvZmlsZScpO1xuZXhwb3J0IGNvbnN0IHBvcHVwUGxhY2VTZWxlY3RvciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5wb3B1cC1wbGFjZScpO1xuZXhwb3J0IGNvbnN0IHBvcHVwUGljdHVyZVNlbGVjdG9yID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnBvcHVwLXByb2ZpbGUtcGljdHVyZScpO1xuZXhwb3J0IGNvbnN0IHByb2ZpbGVGb3JtID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnBvcHVwX19mb3JtLXByb2ZpbGUnKTtcbmV4cG9ydCBjb25zdCBwbGFjZUZvcm0gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcucG9wdXBfX2Zvcm0tcGxhY2UnKTtcbmV4cG9ydCBjb25zdCBwaWN0dXJlRm9ybSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5wb3B1cF9fZm9ybS1wcm9maWxlLXBpY3R1cmUnKTtcbmV4cG9ydCBjb25zdCBwcm9maWxlUGljdHVyZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5wcm9maWxlX19waWN0dXJlJyk7XG5leHBvcnQgY29uc3QgcHJvZmlsZVBpY3R1cmVCdXR0b24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcucHJvZmlsZV9fcGljdHVyZS1jb250YWluZXInKTtcbmV4cG9ydCBjb25zdCBwcm9maWxlQnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnBvcHVwX19idXR0b24tcHJvZmlsZScpO1xuZXhwb3J0IGNvbnN0IHBsYWNlQnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnBvcHVwX19idXR0b24tcGxhY2UnKTtcbmV4cG9ydCBjb25zdCBwaWN0dXJlQnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnBvcHVwX19idXR0b24tcGljdHVyZScpO1xuZXhwb3J0IGNvbnN0IHZhbGlkYXRpb25TZXR0aW5ncyA9IHtcbiAgICBpbnB1dFNlbGVjdG9yOiBcIi5wb3B1cF9faW5wdXRcIixcbiAgICBzdWJtaXRCdXR0b25TZWxlY3RvcjogXCIucG9wdXBfX2J1dHRvblwiLFxuICAgIGluYWN0aXZlQnV0dG9uQ2xhc3M6IFwicG9wdXBfX2J1dHRvbl9kaXNhYmxlZFwiLFxuICAgIGlucHV0RXJyb3JDbGFzczogXCJwb3B1cF9faW5wdXRfdHlwZV9lcnJvclwiLFxuICAgIGVycm9yQ2xhc3M6IFwicG9wdXBfX2Vycm9yX3Zpc2libGVcIlxuICB9OyIsImltcG9ydCBGb3JtVmFsaWRhdG9yIGZyb20gXCIuLi9jb21wb25lbnRzL0Zvcm1WYWxpZGF0b3IuanNcIjtcbmltcG9ydCBQb3B1cFdpdGhGb3JtIGZyb20gXCIuLi9jb21wb25lbnRzL1BvcHVwV2l0aEZvcm0uanNcIjtcbmltcG9ydCBBcGkgZnJvbSBcIi4uL2NvbXBvbmVudHMvQXBpLmpzXCI7XG5pbXBvcnQgQ2FyZCBmcm9tIFwiLi4vY29tcG9uZW50cy9DYXJkXCI7XG5pbXBvcnQgU2VjdGlvbiBmcm9tIFwiLi4vY29tcG9uZW50cy9TZWN0aW9uXCI7XG5pbXBvcnQgVXNlckluZm8gZnJvbSBcIi4uL2NvbXBvbmVudHMvVXNlckluZm9cIjtcbmltcG9ydCBQb3B1cENvbmZpcm1hdGlvbiBmcm9tIFwiLi4vY29tcG9uZW50cy9Qb3B1cENvbmZpcm1hdGlvblwiO1xuaW1wb3J0IFBvcHVwV2l0aEltYWdlIGZyb20gXCIuLi9jb21wb25lbnRzL1BvcHVwV2l0aEltYWdlXCI7XG5pbXBvcnQgeyB2YWxpZGF0aW9uU2V0dGluZ3MsIHByb2ZpbGVQaWN0dXJlLCBwcm9maWxlQnV0dG9uLCBwbGFjZUJ1dHRvbiwgcGljdHVyZUJ1dHRvbiwgbmV3UGxhY2VCdXR0b24sIGVkaXRCdXR0b24sIG5hbWVJbnB1dCwgdGl0bGVJbnB1dCwgcG9wdXBQcm9maWxlU2VsZWN0b3IsIHBvcHVwUGxhY2VTZWxlY3RvciwgcHJvZmlsZUZvcm0sIHBsYWNlRm9ybSwgcGljdHVyZUZvcm0sIHByb2ZpbGVQaWN0dXJlQnV0dG9uLCBwb3B1cFBpY3R1cmVTZWxlY3RvciB9IGZyb20gXCIuLi91dGlscy9jb25zdGFudHMuanNcIjtcbmltcG9ydCBcIi4vc3R5bGVzLmNzc1wiO1xuXG5cbi8vc2V0IGNvbnN0YW50c1xuXG5sZXQgc2VjdGlvbjtcbmxldCBjdXJyZW50SWQ7XG5cbi8vaW5pdGFsaXplIGFwaSBjbGFzc1xuZXhwb3J0IGNvbnN0IGFwaSA9IG5ldyBBcGkoe1xuICBiYXNlVXJsOiBcImh0dHBzOi8vYXJvdW5kLm5vbW9yZXBhcnRpZXMuY28vdjEvZ3JvdXAtMTJcIixcbiAgaGVhZGVyczoge1xuICAgIGF1dGhvcml6YXRpb246IFwiNWFkN2VmOTItZmYyZC00ZmJlLTllNDEtZjUwMzQ5MjZjNDM1XCIsXG4gICAgXCJDb250ZW50LVR5cGVcIjogXCJhcHBsaWNhdGlvbi9qc29uXCJcbiAgfVxufSk7IFxuXG4vL2luc3RhbnRpYXRlIHBvcHVwIGNvbmZpcm1hdGlvbiBjbGFzc1xuY29uc3QgcG9wdXBDb25maXJtYXRpb24gPSBuZXcgUG9wdXBDb25maXJtYXRpb24oXCIucG9wdXAtY29uZmlybVwiLCBoYW5kbGVDbGljayk7XG5wb3B1cENvbmZpcm1hdGlvbi5zZXRFdmVudExpc3RlbmVycygpO1xuXG4vL2hhbmRsZWNsaWNrIGZ1bmN0aW9uIGZvciBkZWxldGluZyBjYXJkXG5mdW5jdGlvbiBoYW5kbGVDbGljayhjYXJkKSB7XG4gIGFwaS5kZWxldGVDYXJkKGNhcmQuaWQpLnRoZW4ocmVzID0+IHtcbiAgICBwb3B1cENvbmZpcm1hdGlvbi5jbG9zZSgpO1xuICAgIGNhcmQucmVtb3ZlQ2FyZCgpO1xuICB9KVxuICAuY2F0Y2goKGVycikgPT4ge1xuICAgIGNvbnNvbGUubG9nKGVycik7IC8vIGxvZyB0aGUgZXJyb3IgdG8gdGhlIGNvbnNvbGVcbiAgfSk7XG59XG5cbi8vdG9nZ2xlTGlrZSBmdW5jdGlvblxuZnVuY3Rpb24gdG9nZ2xlTGlrZSgpIHtcbiAgbGV0IGlzTGlrZWQgPSB0aGlzLl9lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucGxhY2VzX19jYXJkLWJ1dHRvblwiKS5jbGFzc0xpc3QuY29udGFpbnMoXCJwbGFjZXNfX2NhcmQtYnV0dG9uLWxpa2VkXCIpO1xuICB0aGlzLl9oZWFydEljb24uY2xhc3NMaXN0LnRvZ2dsZSgncGxhY2VzX19jYXJkLWJ1dHRvbi1saWtlZCcpO1xuICBhcGkudG9nZ2xlTGlrZSh0aGlzLmlkLCBpc0xpa2VkKS50aGVuKChyZXN1bHQpID0+IHtcbiAgICAgICAgdGhpcy5fZWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLnBsYWNlc19fbGlrZXMtY291bnRlclwiKS5pbm5lckhUTUwgPSByZXN1bHQubGlrZXMubGVuZ3RoO1xuICAgICAgfSlcbiAgICAgIC5jYXRjaCgoZXJyKSA9PiB7XG4gICAgICAgIGNvbnNvbGUubG9nKGVycik7IC8vIGxvZyB0aGUgZXJyb3IgdG8gdGhlIGNvbnNvbGVcbiAgICAgIH0pO1xufVxuXG5cbi8vaW5zdGFudGlhdGUgcG9wdXBpbWFnZSBjbGFzc1xuY29uc3QgcG9wdXBJbWFnZSA9IG5ldyBQb3B1cFdpdGhJbWFnZShcIi5wb3B1cC1waWN0dXJlXCIpO1xucG9wdXBJbWFnZS5zZXRFdmVudExpc3RlbmVycygpO1xuXG4vL2luc3RhbnRpYXRlIHVzZXIgaW5mbyBjbGFzc1xuZXhwb3J0IGNvbnN0IHVzZXJJbmZvID0gbmV3IFVzZXJJbmZvKHt1c2VyTmFtZVNlbGVjdG9yOiAnLnByb2ZpbGVfX25hbWUnLCB1c2VySm9iU2VsZWN0b3I6ICcucHJvZmlsZV9fZnVuY3Rpb24nfSk7XG5cblxuLy9mdW5jdGlvbiB0byBjcmVhdGUgYSBuZXcgY2FyZFxuZnVuY3Rpb24gY3JlYXRlQ2FyZChkYXRhLCB0ZW1wbGF0ZSwgY2FsbGJhY2ssIHBvcHVwQ29uZmlybWF0aW9uLCB0b2dnbGVMaWtlKSB7XG4gICAgY29uc3QgY2FyZCA9IG5ldyBDYXJkKGRhdGEsIHRlbXBsYXRlLCBjYWxsYmFjaywgcG9wdXBDb25maXJtYXRpb24sIHRvZ2dsZUxpa2UpO1xuICAgIHJldHVybiBjYXJkLmdlbmVyYXRlQ2FyZCgpO1xufVxuXG4vL2NyZWF0ZSBoYW5kbGVDYXJkQ2xpY2sgZnVuY3Rpb24gZm9yIGNhcmRzXG5leHBvcnQgZnVuY3Rpb24gaGFuZGxlQ2FyZENsaWNrKHsgbGluaywgdGV4dCB9KSB7XG4gIHBvcHVwSW1hZ2Uub3BlbihsaW5rLCB0ZXh0KTsgXG59O1xuXG5cblxuXG5hcGkuaW5pdGlhbGl6ZSgpLnRoZW4ocmVzID0+IHtcbiAgY29uc3QgW3VzZXIsIGRhdGFdID0gcmVzO1xuICBzZWN0aW9uID0gbmV3IFNlY3Rpb24oeyBcbiAgICBpdGVtczogZGF0YSwgXG4gICAgcmVuZGVyZXI6IChpdGVtKSA9PiB7XG4gICAgICBjdXJyZW50SWQgPSB1c2VyLl9pZDtcbiAgICAgIGNvbnN0IGVsZW1lbnQgPSBjcmVhdGVDYXJkKHt0ZXh0OiBpdGVtLm5hbWUsIGltYWdlTGluazogaXRlbS5saW5rLCBsaWtlczogaXRlbS5saWtlcywgb3duZXI6IGl0ZW0ub3duZXIuX2lkLCBfaWQ6IGl0ZW0uX2lkLCBjdXJyZW50SWR9LCBcIiNjYXJkLXRlbXBsYXRlXCIsIGhhbmRsZUNhcmRDbGljaywgcG9wdXBDb25maXJtYXRpb24sIHRvZ2dsZUxpa2UpO1xuICAgICAgc2VjdGlvbi5hZGRJdGVtKGVsZW1lbnQpO1xuICAgIH1cbiAgICB9LFxuICAgIFwiLnBsYWNlc1wiXG4gICk7XG4gIHNlY3Rpb24ucmVuZGVySXRlbXMoKTtcblxuICB1c2VySW5mby5zZXRVc2VySW5mbyh7dXNlck5hbWU6IHVzZXIubmFtZSwgdXNlckpvYjogdXNlci5hYm91dCwgdXNlckF2YXRhcjogdXNlci5hdmF0YXJ9KTtcblxuICB9KVxuICAuY2F0Y2goKGVycikgPT4ge1xuICAgIGNvbnNvbGUubG9nKGVycik7IC8vIGxvZyB0aGUgZXJyb3IgdG8gdGhlIGNvbnNvbGVcbiAgfSk7XG5cblxuLy9pbnN0YW50aWF0ZSBwb3B1cCBwbGFjZSBmb3JtXG5jb25zdCBwb3B1cFBsYWNlID0gbmV3IFBvcHVwV2l0aEZvcm0oXCIucG9wdXAtcGxhY2VcIiwgaGFuZGxlUGxhY2VTdWJtaXQpO1xucG9wdXBQbGFjZS5zZXRFdmVudExpc3RlbmVycygpO1xuXG4vL2luc3RhbnRpYXRlIHBvcHVwIHByb2ZpbGUgZm9ybVxuY29uc3QgcG9wdXBQcm9maWxlID0gbmV3IFBvcHVwV2l0aEZvcm0oXCIucG9wdXAtcHJvZmlsZVwiLCBoYW5kbGVQcm9maWxlU3VibWl0KTtcbnBvcHVwUHJvZmlsZS5zZXRFdmVudExpc3RlbmVycygpO1xuXG4vL2luc3RhbnRpYXRlIHBvcHVwIGZvciBwcm9maWxlIHBpY3R1cmVcbmNvbnN0IHBvcHVwUHJvZmlsZVBpY3R1cmUgPSBuZXcgUG9wdXBXaXRoRm9ybShcIi5wb3B1cC1wcm9maWxlLXBpY3R1cmVcIiwgaGFuZGxlUGljdHVyZVN1Ym1pdCk7XG5wb3B1cFByb2ZpbGVQaWN0dXJlLnNldEV2ZW50TGlzdGVuZXJzKCk7XG5cbi8vZW5hYmxlIGZvcm0gdmFsaWRhdGlvblxuY29uc3QgcHJvZmlsZVZhbGlkYXRvciA9IG5ldyBGb3JtVmFsaWRhdG9yKCB2YWxpZGF0aW9uU2V0dGluZ3MsIFwiLnBvcHVwX19mb3JtLXByb2ZpbGVcIik7XG5cbnByb2ZpbGVWYWxpZGF0b3IuZW5hYmxlVmFsaWRhdGlvbigpO1xuXG5jb25zdCBwbGFjZVZhbGlkYXRvciA9IG5ldyBGb3JtVmFsaWRhdG9yKCB2YWxpZGF0aW9uU2V0dGluZ3MsIFwiLnBvcHVwX19mb3JtLXBsYWNlXCIpO1xuXG5wbGFjZVZhbGlkYXRvci5lbmFibGVWYWxpZGF0aW9uKCk7XG5cbmNvbnN0IHBpY3R1cmVWYWxpZGF0b3IgPSBuZXcgRm9ybVZhbGlkYXRvciggdmFsaWRhdGlvblNldHRpbmdzLCBcIi5wb3B1cF9fZm9ybS1wcm9maWxlLXBpY3R1cmVcIik7XG5cbnBpY3R1cmVWYWxpZGF0b3IuZW5hYmxlVmFsaWRhdGlvbigpO1xuXG4vL2FkZCBldmVudCBsaXN0ZW5lciB0byBvcGVuIHRoZSBmb3JtIGZvciBhIG5ldyBwbGFjZSBjYXJkXG5uZXdQbGFjZUJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIG9wZW5QbGFjZUZvcm0pO1xuXG4vL2FkZCBldmVudCBsaXN0ZW5lciB0byBvcGVuIHRoZSBmb3JtIGZvciB0aGUgcHJvZmlsZVxuZWRpdEJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIG9wZW5Qcm9maWxlUG9wdXApO1xuXG4vL2FkZCBldmVudCBsaXN0ZW5lciB0byBvcGVuIHRoZSBmb3JtIHRvIGNoYW5nZSB0aGUgcHJvZmlsZSBwaWN0dXJlXG5wcm9maWxlUGljdHVyZUJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIG9wZW5Qcm9maWxlUGljdHVyZSk7XG5cbi8vZnVuY3Rpb24gdG8gb3BlbiBmb3JtIGZvciBwaWN0dXJlIGNoYW5nZVxuZnVuY3Rpb24gb3BlblByb2ZpbGVQaWN0dXJlICgpIHtcbiAgcGljdHVyZVZhbGlkYXRvci5yZXNldFZhbGlkYXRpb24ocG9wdXBQaWN0dXJlU2VsZWN0b3IpO1xuICBwb3B1cFByb2ZpbGVQaWN0dXJlLm9wZW4oKTtcbn1cblxuLy9mdW5jdGlvbiB0byBvcGVuIHByb2ZpbGVcbmZ1bmN0aW9uIG9wZW5Qcm9maWxlUG9wdXAgKCkge1xuICBwcm9maWxlVmFsaWRhdG9yLnJlc2V0VmFsaWRhdGlvbigpOyAgXG4gIGNvbnN0IHsgdXNlck5hbWUsIHVzZXJKb2IgfSA9IHVzZXJJbmZvLmdldFVzZXJJbmZvKCk7XG4gIG5hbWVJbnB1dC52YWx1ZSA9IHVzZXJOYW1lO1xuICB0aXRsZUlucHV0LnZhbHVlID0gdXNlckpvYjtcbiAgcG9wdXBQcm9maWxlLm9wZW4oKTtcbn1cblxuLy9mdW5jdGlvbiB0byBvcGVuIHBsYWNlIGZvcm1cbmZ1bmN0aW9uIG9wZW5QbGFjZUZvcm0gKCkge1xuICBwbGFjZVZhbGlkYXRvci5yZXNldFZhbGlkYXRpb24ocG9wdXBQbGFjZVNlbGVjdG9yKTtcbiAgcG9wdXBQbGFjZS5vcGVuKCk7XG59XG5cbi8vY3JlYXRlIGhhbmRsZSBzdWJtaXQgZnVuY3Rpb24gZm9yIGNoYW5naW5nIHByb2ZpbGVcbmZ1bmN0aW9uIGhhbmRsZVByb2ZpbGVTdWJtaXQoZGF0YSkge1xuICBwb3B1cFByb2ZpbGUucmVuZGVyTG9hZGluZyh0cnVlKTtcbiAgYXBpLnNldE5ld1VzZXIoZGF0YSkudGhlbihkYXRhID0+IHtcbiAgICB1c2VySW5mby5zZXRVc2VySW5mbyh7IHVzZXJOYW1lOiBkYXRhLm5hbWUsIHVzZXJKb2I6IGRhdGEuYWJvdXQsIHVzZXJBdmF0YXI6IGRhdGEuYXZhdGFyfSk7IFxuICAgIHBvcHVwUHJvZmlsZS5jbG9zZSgpO1xuICB9KVxuICAuY2F0Y2goKGVycikgPT4ge1xuICAgIGNvbnNvbGUubG9nKGVycik7IC8vIGxvZyB0aGUgZXJyb3IgdG8gdGhlIGNvbnNvbGVcbiAgfSlcbiAgLmZpbmFsbHkoKCkgPT4ge1xuICAgIHBvcHVwUHJvZmlsZS5yZW5kZXJMb2FkaW5nKGZhbHNlKTtcbiAgfSk7XG59XG5cbi8vY3JlYXRlIGhhbmRsZSBzdWJtaXQgZnVuY3Rpb24gZm9yIGFkZGluZyBuZXcgcGxhY2VzXG4gZnVuY3Rpb24gaGFuZGxlUGxhY2VTdWJtaXQoZGF0YSl7XG4gIHBvcHVwUGxhY2UucmVuZGVyTG9hZGluZyh0cnVlKTtcbiAgYXBpLmFkZENhcnQoZGF0YSkudGhlbigocmVzdWx0KSA9PiB7XG4gICAgY29uc3QgZWxlbWVudCA9IGNyZWF0ZUNhcmQoe3RleHQ6IHJlc3VsdC5uYW1lLCBpbWFnZUxpbms6IHJlc3VsdC5saW5rLCBsaWtlczogcmVzdWx0Lmxpa2VzLCBvd25lcjogY3VycmVudElkLCBfaWQ6IHJlc3VsdC5faWQsIGN1cnJlbnRJZH0sIFwiI2NhcmQtdGVtcGxhdGVcIiwgaGFuZGxlQ2FyZENsaWNrLCBwb3B1cENvbmZpcm1hdGlvbiwgdG9nZ2xlTGlrZSk7XG4gICAgc2VjdGlvbi5hZGRJdGVtKGVsZW1lbnQpO1xuICAgIHBvcHVwUGxhY2UuY2xvc2UoKTtcbiAgfSlcbiAgLmNhdGNoKChlcnIpID0+IHtcbiAgICBjb25zb2xlLmxvZyhlcnIpOyAvLyBsb2cgdGhlIGVycm9yIHRvIHRoZSBjb25zb2xlXG4gIH0pXG4gIC5maW5hbGx5KCgpID0+IHtcbiAgICBwb3B1cFBsYWNlLnJlbmRlckxvYWRpbmcoZmFsc2UpO1xuICB9KTtcbn1cblxuLy9jcmVhdGUgaGFuZGxlIHN1Ym1pdCBmb3IgbmV3IHByb2ZpbGUgcGljdHVyZVxuZnVuY3Rpb24gaGFuZGxlUGljdHVyZVN1Ym1pdChkYXRhKXtcbiAgcG9wdXBQcm9maWxlUGljdHVyZS5yZW5kZXJMb2FkaW5nKHRydWUpO1xuICBhcGkuY2hhbmdlUGljdHVyZShkYXRhKS50aGVuKChyZXN1bHQpID0+IHtcbiAgICB1c2VySW5mby5zZXRVc2VySW5mbyh7dXNlck5hbWU6IHJlc3VsdC5uYW1lLCB1c2VySm9iOiByZXN1bHQuYWJvdXQsIHVzZXJBdmF0YXI6IHJlc3VsdC5hdmF0YXJ9KTtcbiAgICBwb3B1cFByb2ZpbGVQaWN0dXJlLmNsb3NlKCk7XG4gIH0pXG4gIC5jYXRjaCgoZXJyKSA9PiB7XG4gICAgY29uc29sZS5sb2coZXJyKTsgLy8gbG9nIHRoZSBlcnJvciB0byB0aGUgY29uc29sZVxuICB9KVxuICAuZmluYWxseSgoKSA9PiB7XG4gICAgcG9wdXBQcm9maWxlUGljdHVyZS5yZW5kZXJMb2FkaW5nKGZhbHNlKTtcbiAgfSk7XG59XG5cblxuXG5cblxuXG5cblxuXG4iLCJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIEFwaSB7XG4gICAgY29uc3RydWN0b3IoeyBiYXNlVXJsLCBoZWFkZXJzfSkge1xuICAgICAgICB0aGlzLl9iYXNlVXJsID0gYmFzZVVybDtcbiAgICAgICAgdGhpcy5faGVhZGVycyA9IGhlYWRlcnM7XG4gICAgICAgIHRoaXMuX3NlY3Rpb24gPSBudWxsO1xuICAgICAgfVxuXG4gICAgICBfaGFuZGxlUmVzcG9uc2UocmVzKSB7XG4gICAgICAgIHJldHVybiByZXMub2sgPyByZXMuanNvbigpIDogUHJvbWlzZS5yZWplY3QoYEVycm9yOiAke3Jlcy5zdGF0dXN9YCk7XG4gICAgICB9XG5cbiAgICAgIGluaXRpYWxpemUoKSB7XG4gICAgICAgIHJldHVybiBQcm9taXNlLmFsbChbXG4gICAgICAgICAgdGhpcy5nZXRJbml0aWFsVXNlcigpLFxuICAgICAgICAgIHRoaXMuZ2V0SW5pdGlhbENhcmRzKClcbiAgICAgICAgXSk7XG4gICAgICB9XG4gICAgXG4gICAgICBnZXRJbml0aWFsQ2FyZHMoKSB7XG4gICAgICAgICAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vY2FyZHNgLCB7XG4gICAgICAgICAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnNcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAudGhlbihyZXMgPT4gdGhpcy5faGFuZGxlUmVzcG9uc2UocmVzKSk7IFxuICAgICAgfVxuXG4gICAgICBnZXRJbml0aWFsVXNlcigpIHtcbiAgICAgICAgICAgIHJldHVybiBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfS91c2Vycy9tZWAsIHtcbiAgICAgICAgICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVyc1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC50aGVuKHJlcyA9PiB0aGlzLl9oYW5kbGVSZXNwb25zZShyZXMpKTsgXG4gICAgICB9XG5cblxuICAgICAgYWRkQ2FydCh7dGl0bGUsIGxpbmt9KXtcbiAgICAgICAgcmV0dXJuIGZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L2NhcmRzYCwge1xuICAgICAgICAgIG1ldGhvZDogXCJQT1NUXCIsXG4gICAgICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcbiAgICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgICAgICBuYW1lOiB0aXRsZSxcbiAgICAgICAgICAgIGxpbmtcbiAgICAgICAgICB9KVxuICAgICAgICB9KVxuICAgICAgICAudGhlbihyZXMgPT4gdGhpcy5faGFuZGxlUmVzcG9uc2UocmVzKSk7IFxuICAgICB9XG5cblxuICAgICBkZWxldGVDYXJkKGlkKSB7XG4gICAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vY2FyZHMvJHtpZH1gLCB7XG4gICAgICAgIG1ldGhvZDogXCJERUxFVEVcIixcbiAgICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVyc1xuICAgICAgfSlcbiAgICAgIC50aGVuKHJlcyA9PiB0aGlzLl9oYW5kbGVSZXNwb25zZShyZXMpKTsgXG4gICAgIH1cblxuICAgICB0b2dnbGVMaWtlKGlkLCBpc0xpa2VkKSB7XG4gICAgICAgIHJldHVybiBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfS9jYXJkcy9saWtlcy8ke2lkfWAsIHtcbiAgICAgICAgICBtZXRob2Q6IGlzTGlrZWQgPyBcIkRFTEVURVwiIDogXCJQVVRcIixcbiAgICAgICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzXG4gICAgICAgIH0pXG4gICAgICAgIC50aGVuKHJlcyA9PiB0aGlzLl9oYW5kbGVSZXNwb25zZShyZXMpKTsgXG4gICAgIH1cblxuICAgICBjaGFuZ2VQaWN0dXJlKHthdmF0YXJ9KXtcbiAgICAgIHJldHVybiBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfS91c2Vycy9tZS9hdmF0YXJgLCB7XG4gICAgICAgICAgbWV0aG9kOiBcIlBBVENIXCIsXG4gICAgICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcbiAgICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgICAgICBhdmF0YXJcbiAgICAgICAgICB9KVxuICAgICAgICB9KVxuICAgICAgICAudGhlbihyZXMgPT4gdGhpcy5faGFuZGxlUmVzcG9uc2UocmVzKSk7IFxuICAgICAgfVxuXG4gICAgICBzZXROZXdVc2VyKHt1c2VyTmFtZSwgdXNlckpvYn0pIHsgXG4gICAgICAgIHJldHVybiBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfS91c2Vycy9tZWAsIHtcbiAgICAgICAgICAgIG1ldGhvZDogXCJQQVRDSFwiLFxuICAgICAgICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcbiAgICAgICAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHtcbiAgICAgICAgICAgICAgbmFtZTogdXNlck5hbWUsXG4gICAgICAgICAgICAgIGFib3V0OiB1c2VySm9iXG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC50aGVuKHJlcyA9PiB0aGlzLl9oYW5kbGVSZXNwb25zZShyZXMpKTsgXG4gICAgICB9XG4gICAgXG4gICAgXG5cbn07XG5cblxuXG5cbiIsImltcG9ydCBQb3B1cCBmcm9tIFwiLi9Qb3B1cC5qc1wiO1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBQb3B1cENvbmZpcm1hdGlvbiBleHRlbmRzIFBvcHVwIHtcbiAgICBjb25zdHJ1Y3Rvcihwb3B1cFNlbGVjdG9yLCBoYW5kbGVDbGljaykge1xuICAgICAgICBzdXBlcihwb3B1cFNlbGVjdG9yKTtcbiAgICAgICAgdGhpcy5faGFuZGxlQ2xpY2sgPSBoYW5kbGVDbGljaztcbiAgICAgICAgdGhpcy5fYnV0dG9uID0gdGhpcy5fcG9wdXAucXVlcnlTZWxlY3RvcignLnBvcHVwX19idXR0b24nKTtcbiAgICB9XG4gICAgXG4gICAgb3BlbihjYXJkKSB7XG4gICAgICAgIHN1cGVyLm9wZW4oKTtcbiAgICAgICAgdGhpcy5fY2FyZCA9IGNhcmQ7XG4gICAgfVxuXG4gICAgc2V0RXZlbnRMaXN0ZW5lcnMoKSB7XG4gICAgICAgIHN1cGVyLnNldEV2ZW50TGlzdGVuZXJzKCk7XG4gICAgICAgIHRoaXMuX2J1dHRvbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHtcbiAgICAgICAgICAgIHRoaXMuX2hhbmRsZUNsaWNrKHRoaXMuX2NhcmQpO1xuICAgICAgICB9KTtcbiAgICB9XG5cblxufSIsImltcG9ydCBQb3B1cCBmcm9tIFwiLi9Qb3B1cC5qc1wiO1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBQb3B1cFdpdGhJbWFnZSBleHRlbmRzIFBvcHVwIHtcblxuICAgIGNvbnN0cnVjdG9yKHBvcHVwU2VsZWN0b3IpIHtcbiAgICAgICAgc3VwZXIocG9wdXBTZWxlY3RvcilcbiAgICAgICAgdGhpcy5fcG9wdXBJbWFnZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5wb3B1cC1waWN0dXJlX19pbWFnZScpO1xuICAgICAgICB0aGlzLl9wb3B1cEltYWdlVGl0bGUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcucG9wdXAtcGljdHVyZV9fdGl0bGUnKTtcbiAgICB9XG5cbiAgICBvcGVuKGltYWdlTGluaywgaW1hZ2VOYW1lKXtcbiAgICAgICAgdGhpcy5fcG9wdXBJbWFnZS5zZXRBdHRyaWJ1dGUoJ3NyYycsIGltYWdlTGluayk7XG4gICAgICAgIHRoaXMuX3BvcHVwSW1hZ2Uuc2V0QXR0cmlidXRlKCdhbHQnLCBpbWFnZU5hbWUpOyAgICBcbiAgICAgICAgdGhpcy5fcG9wdXBJbWFnZVRpdGxlLnRleHRDb250ZW50ID0gaW1hZ2VOYW1lO1xuICAgICAgICBzdXBlci5vcGVuKCk7XG4gICAgfSBcblxufSIsImV4cG9ydCBkZWZhdWx0IGNsYXNzIFVzZXJJbmZvIHtcbiAgICBjb25zdHJ1Y3RvciAoe3VzZXJOYW1lU2VsZWN0b3IsIHVzZXJKb2JTZWxlY3RvciwgdXNlckF2YXRhcn0pe1xuICAgICAgICB0aGlzLl9wcm9maWxlTmFtZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IodXNlck5hbWVTZWxlY3Rvcik7XG4gICAgICAgIHRoaXMuX3Byb2ZpbGVGdW5jdGlvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IodXNlckpvYlNlbGVjdG9yKTtcbiAgICAgICAgdGhpcy5fcGljdHVyZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5wcm9maWxlX19waWN0dXJlJyk7XG4gICAgfVxuXG4gICAgZ2V0VXNlckluZm8oKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICB1c2VyTmFtZTogdGhpcy5fcHJvZmlsZU5hbWUudGV4dENvbnRlbnQsXG4gICAgICAgICAgICB1c2VySm9iOiB0aGlzLl9wcm9maWxlRnVuY3Rpb24udGV4dENvbnRlbnRcbiAgICAgICAgfTtcbiAgICB9XG5cbiAgICBzZXRVc2VySW5mbyh7IHVzZXJOYW1lLCB1c2VySm9iLCB1c2VyQXZhdGFyIH0pIHtcbiAgICAgICAgdGhpcy5fcHJvZmlsZU5hbWUudGV4dENvbnRlbnQgPSB1c2VyTmFtZTtcbiAgICAgICAgdGhpcy5fcHJvZmlsZUZ1bmN0aW9uLnRleHRDb250ZW50ID0gdXNlckpvYjtcbiAgICAgICAgdGhpcy5fcGljdHVyZS5zcmMgPSB1c2VyQXZhdGFyO1xuICAgIH1cbn07Il0sIm5hbWVzIjpbIkZvcm1WYWxpZGF0b3IiLCJjb25zdHJ1Y3RvciIsInNldHRpbmdzIiwiZm9ybSIsInRoaXMiLCJfc2V0dGluZ3MiLCJfZm9ybSIsImRvY3VtZW50IiwicXVlcnlTZWxlY3RvciIsIl9idXR0b25FbGVtZW50Iiwic3VibWl0QnV0dG9uU2VsZWN0b3IiLCJfaW5wdXRMaXN0IiwicXVlcnlTZWxlY3RvckFsbCIsImlucHV0U2VsZWN0b3IiLCJfaGFzSW52YWxpZElucHV0IiwiaW5wdXRMaXN0Iiwic29tZSIsImlucHV0RWxlbWVudCIsInZhbGlkaXR5IiwidmFsaWQiLCJfc2hvd0lucHV0RXJyb3IiLCJlcnJvck1lc3NhZ2UiLCJlcnJvckVsZW1lbnQiLCJpZCIsImNsYXNzTGlzdCIsImFkZCIsImlucHV0RXJyb3JDbGFzcyIsInRleHRDb250ZW50IiwiZXJyb3JDbGFzcyIsIl9oaWRlSW5wdXRFcnJvciIsInJlbW92ZSIsIl90b2dnbGVCdXR0b25TdGF0ZSIsImJ1dHRvbkVsZW1lbnQiLCJfZGlzYWJsZUJ1dHRvbiIsImluYWN0aXZlQnV0dG9uQ2xhc3MiLCJkaXNhYmxlZCIsIl90b2dnbGVJbnB1dEVycm9yIiwidmFsaWRhdGlvbk1lc3NhZ2UiLCJfc2V0RXZlbnRMaXN0ZW5lcnMiLCJhZGRFdmVudExpc3RlbmVyIiwiZXZ0IiwicHJldmVudERlZmF1bHQiLCJyZXNldFZhbGlkYXRpb24iLCJmb3JFYWNoIiwiZW5hYmxlVmFsaWRhdGlvbiIsIlBvcHVwIiwicG9wdXBTZWxlY3RvciIsIl9wb3B1cCIsIl9oYW5kbGVFc2NDbG9zZSIsImJpbmQiLCJvcGVuIiwiY2xvc2UiLCJyZW1vdmVFdmVudExpc3RlbmVyIiwia2V5Iiwic2V0RXZlbnRMaXN0ZW5lcnMiLCJ0YXJnZXQiLCJjb250YWlucyIsIlBvcHVwV2l0aEZvcm0iLCJoYW5kbGVGb3JtU3VibWl0Iiwic3VwZXIiLCJfaGFuZGxlRm9ybVN1Ym1pdCIsIl9zdWJtaXRCdXR0b24iLCJfc3VibWl0QnV0dG9uVGV4dCIsInJlbmRlckxvYWRpbmciLCJpc0xvYWRpbmciLCJsb2FkaW5nVGV4dCIsIl9nZXRJbnB1dFZhbHVlcyIsIl9mb3JtVmFsdWVzIiwiaW5wdXQiLCJuYW1lIiwidmFsdWUiLCJyZXNldCIsIkNhcmQiLCJkYXRhIiwiY2FyZFNlbGVjdG9yIiwiaGFuZGxlQ2FyZENsaWNrIiwicG9wdXBDb25maXJtYXRpb24iLCJ0b2dnbGVMaWtlIiwiX3RleHQiLCJ0ZXh0IiwiX2ltYWdlTGluayIsImltYWdlTGluayIsIl9saWtlcyIsImxpa2VzIiwiX2NhcmRTZWxlY3RvciIsIl9oYW5kbGVDYXJkQ2xpY2siLCJfcG9wdXBDb25maXJtYXRpb24iLCJfb3duZXJJZCIsIm93bmVyIiwiX2lkIiwiX3VzZXJJZCIsImN1cnJlbnRJZCIsIl90b2dnbGVMaWtlIiwiX2dldFRlbXBsYXRlIiwiY29udGVudCIsImNsb25lTm9kZSIsInJlbW92ZUNhcmQiLCJfZWxlbWVudCIsImxpbmsiLCJnZW5lcmF0ZUNhcmQiLCJfaGVhcnRJY29uIiwiaXRlbSIsInNyYyIsImFsdCIsImxlbmd0aCIsIlNlY3Rpb24iLCJjb250YWluZXJTZWxlY3RvciIsIml0ZW1zIiwicmVuZGVyZXIiLCJfaXRlbXMiLCJfcmVuZGVyZXIiLCJfY29udGFpbmVyIiwicmVuZGVySXRlbXMiLCJhZGRJdGVtIiwiZWxlbWVudCIsInByZXBlbmQiLCJlZGl0QnV0dG9uIiwibmV3UGxhY2VCdXR0b24iLCJuYW1lSW5wdXQiLCJ0aXRsZUlucHV0IiwicG9wdXBQbGFjZVNlbGVjdG9yIiwicG9wdXBQaWN0dXJlU2VsZWN0b3IiLCJwcm9maWxlUGljdHVyZUJ1dHRvbiIsInZhbGlkYXRpb25TZXR0aW5ncyIsInNlY3Rpb24iLCJhcGkiLCJiYXNlVXJsIiwiaGVhZGVycyIsIl9iYXNlVXJsIiwiX2hlYWRlcnMiLCJfc2VjdGlvbiIsIl9oYW5kbGVSZXNwb25zZSIsInJlcyIsIm9rIiwianNvbiIsIlByb21pc2UiLCJyZWplY3QiLCJzdGF0dXMiLCJpbml0aWFsaXplIiwiYWxsIiwiZ2V0SW5pdGlhbFVzZXIiLCJnZXRJbml0aWFsQ2FyZHMiLCJmZXRjaCIsInRoZW4iLCJhZGRDYXJ0IiwidGl0bGUiLCJtZXRob2QiLCJib2R5IiwiSlNPTiIsInN0cmluZ2lmeSIsImRlbGV0ZUNhcmQiLCJpc0xpa2VkIiwiY2hhbmdlUGljdHVyZSIsImF2YXRhciIsInNldE5ld1VzZXIiLCJ1c2VyTmFtZSIsInVzZXJKb2IiLCJhYm91dCIsImF1dGhvcml6YXRpb24iLCJoYW5kbGVDbGljayIsIl9oYW5kbGVDbGljayIsIl9idXR0b24iLCJjYXJkIiwiX2NhcmQiLCJjYXRjaCIsImVyciIsImNvbnNvbGUiLCJsb2ciLCJ0b2dnbGUiLCJyZXN1bHQiLCJpbm5lckhUTUwiLCJwb3B1cEltYWdlIiwiX3BvcHVwSW1hZ2UiLCJfcG9wdXBJbWFnZVRpdGxlIiwiaW1hZ2VOYW1lIiwic2V0QXR0cmlidXRlIiwidXNlckluZm8iLCJ1c2VyTmFtZVNlbGVjdG9yIiwidXNlckpvYlNlbGVjdG9yIiwidXNlckF2YXRhciIsIl9wcm9maWxlTmFtZSIsIl9wcm9maWxlRnVuY3Rpb24iLCJfcGljdHVyZSIsImdldFVzZXJJbmZvIiwic2V0VXNlckluZm8iLCJjcmVhdGVDYXJkIiwidGVtcGxhdGUiLCJjYWxsYmFjayIsInVzZXIiLCJwb3B1cFBsYWNlIiwiZmluYWxseSIsInBvcHVwUHJvZmlsZSIsInBvcHVwUHJvZmlsZVBpY3R1cmUiLCJwcm9maWxlVmFsaWRhdG9yIiwicGxhY2VWYWxpZGF0b3IiLCJwaWN0dXJlVmFsaWRhdG9yIl0sInNvdXJjZVJvb3QiOiIifQ==